{"version":3,"sources":["webpack:///./src/SmartComponents/ReportDetails/ReportDetails.js"],"names":["QUERY","gql","ReportDetails","chartColorScale","policyName","legendData","compliancePercentage","pageTitle","route","policyId","useParams","report_id","useQuery","variables","data","error","loading","donutValues","donutId","profile","policy","name","compliantHostCount","testResultHostCount","replace","x","y","black300","blue300","blue200","pluralize","fixedPercentage","Math","floor","useTitleEntity","stateValues","stateKey","Breadcrumb","ouiaId","to","BreadcrumbItem","isActive","Grid","hasGutter","GridItem","sm","md","lg","xl","title","policyType","className","state","id","Button","variant","isInline","identifier","subTitle","themeVariant","ChartThemeVariant","colorScale","style","fontSize","constrainToVisibleArea","innerRadius","width","legendPosition","legendOrientation","padding","bottom","left","right","top","unsupportedHostCount","Text","showHelpIcon","span","showOsMinorVersionFilter","majorOsVersion","columns","Columns","showLink","showOsInfo","query","GET_SYSTEMS","showOnlySystemsWithTestResults","compliantFilter","defaultFilter","propTypes"],"mappings":"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","file":"js/ReportDetails.aab5fbc1ba1fe975bc39.js","sourcesContent":["/* eslint-disable react/display-name */\nimport React from 'react';\nimport black300 from '@patternfly/react-tokens/dist/esm/global_palette_black_300';\nimport blue200 from '@patternfly/react-tokens/dist/esm/chart_color_blue_200';\nimport blue300 from '@patternfly/react-tokens/dist/esm/chart_color_blue_300';\nimport propTypes from 'prop-types';\nimport { useParams } from 'react-router-dom';\nimport { useQuery } from '@apollo/client';\nimport gql from 'graphql-tag';\nimport { ChartDonut, ChartThemeVariant } from '@patternfly/react-charts';\nimport { Breadcrumb, BreadcrumbItem, Button, Grid, GridItem, Text } from '@patternfly/react-core';\nimport PageHeader, { PageHeaderTitle } from '@redhat-cloud-services/frontend-components/PageHeader';\nimport Main from '@redhat-cloud-services/frontend-components/Main';\nimport EmptyTable from '@redhat-cloud-services/frontend-components/EmptyTable';\nimport Spinner from '@redhat-cloud-services/frontend-components/Spinner';\nimport { fixedPercentage, pluralize } from 'Utilities/TextHelper';\nimport {\n    BackgroundLink, BreadcrumbLinkItem, ReportDetailsContentLoader, ReportDetailsDescription,\n    StateViewWithError, StateViewPart, UnsupportedSSGVersion, SubPageTitle\n} from 'PresentationalComponents';\nimport { useTitleEntity } from 'Utilities/hooks/useDocumentTitle';\nimport { InventoryTable } from 'SmartComponents';\nimport '@/Charts.scss';\nimport './ReportDetails.scss';\nimport { GET_SYSTEMS } from '../SystemsTable/constants';\nimport * as Columns from '../SystemsTable/Columns';\n\nexport const QUERY = gql`\nquery Profile($policyId: String!){\n    profile(id: $policyId) {\n        id\n        name\n        refId\n        testResultHostCount\n        compliantHostCount\n        unsupportedHostCount\n        complianceThreshold\n        majorOsVersion\n        lastScanned\n        policyType\n        policy {\n            id\n            name\n        }\n        benchmark {\n            id\n            version\n        }\n        businessObjective {\n            id\n            title\n        }\n    }\n}\n`;\n\nexport const ReportDetails = ({ route }) => {\n    const { report_id: policyId } = useParams();\n    const { data, error, loading } = useQuery(QUERY, {\n        variables: { policyId }\n    });\n    let donutValues = [];\n    let donutId = 'loading-donut';\n    let chartColorScale;\n    let profile = {};\n    let policyName;\n    let legendData;\n    let compliancePercentage;\n    let pageTitle;\n\n    if (!loading && data) {\n        profile = data.profile;\n        policyName = profile.policy.name;\n        pageTitle = `Report: ${ policyName }`;\n        const compliantHostCount = profile.compliantHostCount;\n        const testResultHostCount = profile.testResultHostCount;\n        donutId = profile.name.replace(/ /g, '');\n        donutValues = [\n            { x: 'Compliant', y: testResultHostCount ? compliantHostCount : '0' },\n            { x: 'Non-compliant', y: testResultHostCount - compliantHostCount }\n        ];\n        chartColorScale = testResultHostCount === 0 && [black300.value] ||\n            [blue300.value, blue200.value];\n        legendData = [\n            { name: donutValues[0].y + ' ' + pluralize(donutValues[0].y, 'system') + ' compliant' },\n            { name: donutValues[1].y + ' ' + pluralize(donutValues[1].y, 'system') + ' non-compliant' }\n        ];\n        compliancePercentage = testResultHostCount ? fixedPercentage(Math.floor(100 *\n                (donutValues[0].y / (donutValues[0].y + donutValues[1].y)))) : 0;\n    }\n\n    useTitleEntity(route, policyName);\n\n    return <StateViewWithError stateValues={ { error, data, loading } }>\n        <StateViewPart stateKey='loading'>\n            <PageHeader><ReportDetailsContentLoader/></PageHeader>\n            <Main><EmptyTable><Spinner/></EmptyTable></Main>\n        </StateViewPart>\n        <StateViewPart stateKey='data'>\n            <PageHeader>\n                <Breadcrumb ouiaId=\"ReportDetailsPathBreadcrumb\">\n                    <BreadcrumbLinkItem to='/'>\n                        Compliance\n                    </BreadcrumbLinkItem>\n                    <BreadcrumbLinkItem to='/reports'>\n                        Reports\n                    </BreadcrumbLinkItem>\n                    <BreadcrumbItem isActive>{ pageTitle }</BreadcrumbItem>\n                </Breadcrumb>\n                <Grid hasGutter>\n                    <GridItem sm={9} md={9} lg={9} xl={9}>\n                        <PageHeaderTitle title={ pageTitle } />\n                        <SubPageTitle>\n                            { profile.policyType }\n                        </SubPageTitle>\n                    </GridItem>\n                    <GridItem className='report-details-button' sm={3} md={3} lg={3} xl={3}>\n                        <BackgroundLink\n                            state={ { profile } }\n                            to={ `/reports/${ profile.id }/delete` }>\n                            <Button variant='link' ouiaId=\"ReportDetailsDeleteReportLink\" isInline>Delete report</Button>\n                        </BackgroundLink>\n                    </GridItem>\n                </Grid>\n                <Grid hasGutter>\n                    <GridItem sm={12} md={12} lg={12} xl={6}>\n                        <div className='chart-inline'>\n                            <div className='chart-container'>\n                                <ChartDonut data={donutValues}\n                                    identifier={donutId}\n                                    title={compliancePercentage}\n                                    subTitle=\"Compliant\"\n                                    themeVariant={ChartThemeVariant.light}\n                                    colorScale={chartColorScale}\n                                    style={{ fontSize: 20 }}\n                                    constrainToVisibleArea={ true }\n                                    innerRadius={88}\n                                    width={462}\n                                    legendPosition='right'\n                                    legendData={legendData}\n                                    legendOrientation='vertical'\n                                    padding={{\n                                        bottom: 20,\n                                        left: 0,\n                                        right: 250,\n                                        top: 20\n                                    }}\n                                />\n                            </div>\n                        </div>\n                        {  profile.unsupportedHostCount > 0 && <Text>\n                            <UnsupportedSSGVersion showHelpIcon>\n                                <strong className='ins-c-warning-text'>\n                                    { profile.unsupportedHostCount } systems not supported\n                                </strong>\n                            </UnsupportedSSGVersion>\n                        </Text> }\n                    </GridItem>\n                    <GridItem sm={12} md={12} lg={12} xl={6}>\n                        <ReportDetailsDescription profile={profile} />\n                    </GridItem>\n                </Grid>\n            </PageHeader>\n            <Main>\n                <Grid hasGutter>\n                    <GridItem span={12}>\n                        <InventoryTable\n                            showOsMinorVersionFilter={ [profile.majorOsVersion] }\n                            columns={[\n                                Columns.customName({\n                                    showLink: true,\n                                    showOsInfo: true\n                                }),\n                                Columns.inventoryColumn('tags'),\n                                Columns.SsgVersion,\n                                Columns.FailedRules,\n                                Columns.ComplianceScore,\n                                Columns.LastScanned\n                            ]}\n                            query={GET_SYSTEMS}\n                            showOnlySystemsWithTestResults\n                            compliantFilter\n                            defaultFilter={`with_results_for_policy_id = ${profile.id}`}\n                            policyId={profile.id} />\n                    </GridItem>\n                </Grid>\n            </Main>\n        </StateViewPart>\n    </StateViewWithError>;\n};\n\nReportDetails.propTypes = {\n    route: propTypes.object\n};\n\nexport default ReportDetails;\n"],"sourceRoot":""}