(self.webpackChunkcompliance_frontend=self.webpackChunkcompliance_frontend||[]).push([[72],{79641:(e,t,n)=>{"use strict";n.r(t),n.d(t,{QUERY:()=>k,ReportDetails:()=>D,default:()=>Z});var r,o=n(32465),i=n(92950),a=n.n(i),l=n(91346),s=n(55490),c=n(34925),u=n(45697),p=n.n(u),m=n(334),d=n(46829),f=n(33121),y=n(73581),b=n(52067),g=n(80708),h=n(48716),v=n(39173),E=n(86350),O=n(92223),P=n(28873),C=n(11443),S=n(99577),w=n(7648),j=n(77346),I=n(33179),x=n(27803),R=n(31499),k=(0,f.ZP)(r||(r=(0,o.Z)(["\n  query Profile($policyId: String!) {\n    profile(id: $policyId) {\n      id\n      name\n      refId\n      testResultHostCount\n      compliantHostCount\n      unsupportedHostCount\n      complianceThreshold\n      majorOsVersion\n      lastScanned\n      policyType\n      policy {\n        id\n        name\n      }\n      benchmark {\n        id\n        version\n      }\n      businessObjective {\n        id\n        title\n      }\n    }\n  }\n"]))),D=function(e){var t,n,r,o,i,u=e.route,p=(0,m.useParams)().report_id,f=(0,j.ZP)("pdfReport"),D=(0,d.useQuery)(k,{variables:{policyId:p},fetchPolicy:"no-cache"}),Z=D.data,T=D.error,F=D.loading,N=[],$="loading-donut",H={};if(!F&&Z){n=(H=Z.profile).policy.name,i="Report: ".concat(n);var G=H.compliantHostCount,B=H.testResultHostCount;$=H.name.replace(/ /g,""),N=[{x:"Compliant",y:B?G:"0"},{x:"Non-compliant",y:B-G}],t=0===B&&[l.Z.value]||[c.Z.value,s.Z.value],r=[{name:N[0].y+" "+(0,C._6)(N[0].y,"system")+" compliant"},{name:N[1].y+" "+(0,C._6)(N[1].y,"system")+" non-compliant"}],o=B?(0,C.P0)(Math.floor(N[0].y/(N[0].y+N[1].y)*100)):0}return(0,w.a)(u,n),a().createElement(S.tC,{stateValues:{error:T,data:Z,loading:F}},a().createElement(S.K7,{stateKey:"loading"},a().createElement(h.Z,null,a().createElement(S.Tq,null)),a().createElement(E.Z,null,a().createElement(O.Z,null,a().createElement(P.Z,null)))),a().createElement(S.K7,{stateKey:"data"},a().createElement(h.Z,null,a().createElement(g.Breadcrumb,{ouiaId:"ReportDetailsPathBreadcrumb"},a().createElement(S.MU,{to:"/"},"Compliance"),a().createElement(S.MU,{to:"/reports"},"Reports"),a().createElement(g.BreadcrumbItem,{isActive:!0},i)),a().createElement(g.Grid,{hasGutter:!0},a().createElement(g.GridItem,{sm:9,md:9,lg:9,xl:9},a().createElement(v.Z,{title:i}),a().createElement(S.Zr,null,H.policyType)),a().createElement(g.GridItem,{className:"report-details-button",sm:3,md:3,lg:3,xl:3},f&&a().createElement(S.mR,{state:{profile:H},to:"/reports/".concat(H.id,"/pdf")},a().createElement(g.Button,{ouiaId:"ReportDetailsDownloadReportPDFLink",variant:"primary",className:"pf-u-mr-md"},"Download PDF")),a().createElement(S.mR,{state:{profile:H},to:"/reports/".concat(H.id,"/delete")},a().createElement(g.Button,{variant:"link",ouiaId:"ReportDetailsDeleteReportLink",isInline:!0},"Delete report")))),a().createElement(g.Grid,{hasGutter:!0},a().createElement(g.GridItem,{sm:12,md:12,lg:12,xl:6},a().createElement("div",{className:"chart-inline"},a().createElement("div",{className:"chart-container"},a().createElement(y.HS,{data:N,identifier:$,title:o,subTitle:"Compliant",themeVariant:b.py.light,colorScale:t,style:{fontSize:20},constrainToVisibleArea:!0,innerRadius:88,width:462,legendPosition:"right",legendData:r,legendOrientation:"vertical",padding:{bottom:20,left:0,right:250,top:20}}))),H.unsupportedHostCount>0&&a().createElement(g.Text,null,a().createElement(S.cT,{showHelpIcon:!0},a().createElement("strong",{className:"ins-c-warning-text"},H.unsupportedHostCount," systems not supported")))),a().createElement(g.GridItem,{sm:12,md:12,lg:12,xl:6},a().createElement(S.vu,{profile:H})))),a().createElement(E.Z,null,a().createElement(g.Grid,{hasGutter:!0},a().createElement(g.GridItem,{span:12},a().createElement(I.e_,{showOsMinorVersionFilter:[H.majorOsVersion],columns:[R.Zw({showLink:!0,showOsInfo:!0}),R.MO("tags"),R.hN,R.ll,R.OF,R.Hc],query:x.Ep,showOnlySystemsWithTestResults:!0,compliantFilter:!0,defaultFilter:"with_results_for_policy_id = ".concat(H.id),policyId:H.id}))))))};D.propTypes={route:p().object};const Z=D},62888:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ReportDownload:()=>W,default:()=>Y});var r=n(96156),o=n(28481),i=n(92950),a=n.n(i),l=n(80708),s=n(334),c=n(46829),u=n(99577),p=n(52710),m=n(45697),d=n.n(m),f=function(e){var t=e.policy,n=e.setExportSetting,r=e.exportSettings;return a().createElement(l.Form,null,a().createElement(l.FormGroup,{isInline:!0,fieldId:"simple-form-checkbox-group",label:"Policy"},a().createElement(l.Text,null,t.name)),a().createElement(l.FormGroup,{fieldId:"simple-form-checkbox-group",label:"System data to include"},a().createElement(l.Checkbox,{label:"Non-compliant systems",id:"non-compliant-systems-export-setting","aria-label":"Non-compliant systems",onChange:n("nonCompliantSystems"),isChecked:r.nonCompliantSystems}),a().createElement(l.Checkbox,{label:"Systems with unsupported configuration",id:"unsupported-systems-export-setting","aria-label":"Systems with unsupported configuration",onChange:n("unsupportedSystems"),isChecked:r.unsupportedSystems}),a().createElement(l.Checkbox,{id:"compliant-systems-export-setting",onChange:n("compliantSystems"),isChecked:r.compliantSystems,label:"Compliant systems","aria-label":"Compliant systems"})),a().createElement(l.FormGroup,{label:"Rule data to include",fieldId:"checkbox01"},a().createElement(l.Checkbox,{id:"failed-rules-export-setting",label:"Top failed rules (Up to 10)","aria-label":"Rule data to include",onChange:n("topTenFailedRules"),isChecked:r.topTenFailedRules})),a().createElement(l.FormGroup,{label:"User notes (optional)",fieldId:"checkbox01"},a().createElement(l.TextArea,{"aria-label":"User notes (optional)",onChange:n("userNotes"),value:r.userNotes})))};f.propTypes={policy:d().object,exportSettings:d().object,setExportSetting:d().func};const y=f;var b,g,h=n(92137),v=n(87757),E=n.n(v),O=n(65811),P=n(85061),C=n(32465),S=n(33121),w={compliantSystems:!1,nonCompliantSystems:!0,unsupportedSystems:!0,topTenFailedRules:!0,userNotes:void 0},j=(0,S.ZP)(b||(b=(0,C.Z)(["\n  query getSystems(\n    $filter: String!\n    $policyId: ID\n    $perPage: Int\n    $page: Int\n    $sortBy: [String!]\n    $tags: [String!]\n  ) {\n    systems(\n      search: $filter\n      limit: $perPage\n      offset: $page\n      sortBy: $sortBy\n      tags: $tags\n    ) {\n      totalCount\n      edges {\n        node {\n          id\n          name\n          osMajorVersion\n          osMinorVersion\n          testResultProfiles(policyId: $policyId) {\n            id\n            name\n            refId\n            lastScanned\n            compliant\n            external\n            score\n            supported\n            ssgVersion\n            majorOsVersion\n            rules {\n              refId\n              title\n              compliant\n              remediationAvailable\n            }\n          }\n          policies(policyId: $policyId) {\n            id\n            name\n          }\n          tags {\n            namespace\n            key\n            value\n          }\n        }\n      }\n    }\n  }\n"]))),I=(0,S.ZP)(g||(g=(0,C.Z)(["\n  query Profile($policyId: String!) {\n    profile(id: $policyId) {\n      id\n      name\n      refId\n      testResultHostCount\n      compliantHostCount\n      unsupportedHostCount\n      complianceThreshold\n      majorOsVersion\n      lastScanned\n      policyType\n      totalHostCount\n      policy {\n        id\n        name\n      }\n      benchmark {\n        id\n        version\n      }\n      businessObjective {\n        id\n        title\n      }\n    }\n  }\n"]))),x=n(79886),R=n(99373);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var D=function(e){return(null==e?void 0:e.filter((function(e){return"Never"!=e.lastScanned})))||[]},Z=function(e){var t=e.testResultProfiles;return D(t).length>0},T=function(e){return Z(e)&&D(e.testResultProfiles).every((function(e){return e.supported}))},F=function(e){return e.filter((function(e){return T(e)&&function(e){var t=D(e.testResultProfiles).length>0,n=D(e.testResultProfiles).every((function(e){return e.compliant}));return t&&n}(e)}))},N=function(e){return e.filter((function(e){return T(e)&&function(e){var t=D(e.testResultProfiles).length>0,n=D(e.testResultProfiles).filter((function(e){return!e.compliant})).length>0;return t&&n}(e)}))},$=function(e){return e.filter((function(e){return function(e){return Z(e)&&D(e.testResultProfiles).every((function(e){return!e.supported}))}(e)}))},H=function(e){var t={};return function(e){return e.filter((function(e){return T(e)}))}(e).forEach((function(e){e.testResultProfiles.forEach((function(e){e.rules.forEach((function(e){return function(e){e.compliant||(t[e.refId]?t[e.refId].systemCount++:t[e.refId]=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({systemCount:1},e))}(e)}))}))})),t},G=function(e){return t=H(e),(10===(r=(n=Object.values(t)).sort((function(e){return e.systemCount})).slice(0,10)).filter((function(e){return 1===e.systemCount})).length?(0,x.qk)(n,"severity",R.FT,"asc").slice(0,10):void 0)||r;var t,n,r};function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var q=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r=Math.ceil(t/n)||1;return Promise.all((0,P.Z)(new Array(r)).map((function(t,r){return e(n,r+1)})))};var M=n(22122);const _=function(e,t){var n=function(e,t){var n=t.id,r=t.totalHostCount,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{onComplete:function(){},onError:function(){}},i=o.onComplete,a=o.onError,l=(0,c.useApolloClient)(),s=function(t){return V(V(V(V(V({},e.compliantSystems&&{compliantSystems:F(t)}),e.nonCompliantSystems&&{nonCompliantSystems:N(t)}),e.unsupportedSystems&&{unsupportedSystems:$(t)}),e.topTenFailedRules&&{topTenFailedRules:G(t)}),e.userNotes&&{userNotes:e.userNotes})},u=function(e,t){return l.query({query:j,fetchResults:!0,fetchPolicy:"no-cache",variables:{perPage:e,page:t,filter:"",policyId:n}})};return function(){return q(u,r).then((function(e){return e.flatMap((function(e){return e.data.systems.edges.map((function(e){return e.node}))}))})).then((function(e){var t=s(e);return i&&i(t),t})).catch((function(e){if(a)return a(e),[];throw e}))}}(e,t,{onError:function(){(0,O.q)({variant:"danger",title:"Couldn’t download export",description:"Reinitiate this export to try again."})},onComplete:function(){(0,O.q)({variant:"success",title:"Downloading export"})}}),r=function(e){return Promise.resolve([a().createElement("div",(0,M.Z)({key:"pdfreport"},e))])};return function(){var e=(0,h.Z)(E().mark((function e(){var t,o;return E().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,O.q)({variant:"info",title:"Preparing export",description:"Once complete, your download will start automatically."}),e.next=3,n();case 3:return t=e.sent,console.log("DATA:",t),e.next=7,r(t);case 7:return o=e.sent,e.abrupt("return",o);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()};var A=n(81253),K=["asyncFunction","label","buttonProps"],U=function(e){var t=e.asyncFunction,n=e.label,r=e.buttonProps,o=(0,A.Z)(e,K);return a().createElement(l.Button,(0,M.Z)({},r,o,{variant:"primary",onClick:function(){return t()}}),n)};U.propTypes={asyncFunction:d().func,label:d().label,buttonProps:d().object};const L=U;function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var W=function(){var e=(0,s.useParams)().report_id,t=(0,p.C3)("/reports/"+e),n=(0,c.useQuery)(I,{variables:{policyId:e}}),m=n.data,d=n.loading,f=n.error,b=null==m?void 0:m.profile,g=(0,i.useState)(w),h=(0,o.Z)(g,2),v=h[0],E=h[1],O=b?_(v,b):function(){return Promise.resolve([])},P="compliance-report--".concat((new Date).toISOString().split("T")[0]),C=[a().createElement(L,{groupName:"Red Hat Insights",key:"export",label:"Export report",fileName:P,asyncFunction:function(){return console.log(O()),Promise.resolve([])},buttonProps:{ouiaId:"ExportReportButton",variant:"primary"}}),a().createElement(l.Button,{variant:"secondary",key:"cancel",ouiaId:"ExportReportCancelButton",onClick:function(e){e.preventDefault(),window.history.back()}},"Cancel")];return a().createElement(l.Modal,{isOpen:!0,width:"440px",ouiaId:"DownloadReportModal",title:"Compliance report",onClose:t,actions:C},a().createElement(u.tC,{stateValues:{error:f,data:m,loading:d}},a().createElement(u.K7,{stateKey:"loading"},a().createElement(l.Spinner,null)),a().createElement(u.K7,{stateKey:"data"},a().createElement(y,{policy:b,setExportSetting:function(e){return function(t){E(z(z({},v),{},(0,r.Z)({},e,t)))}},exportSettings:v}))))};const Y=W}}]);
//# sourceMappingURL=../sourcemaps/ReportDetails.bc3cb79ead6a98ed70d71f97a60f8707.js.map