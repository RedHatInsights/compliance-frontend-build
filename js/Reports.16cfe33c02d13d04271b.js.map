{"version":3,"sources":["webpack://compliance-frontend/./src/SmartComponents/Reports/Reports.js"],"names":["QUERY","gql","LoadingView","showTableView","colSize","rowSize","propTypes","ReportsHeader","title","Reports","profiles","showView","location","useLocation","useFeature","View","ReportsTable","ReportCardGrid","useQuery","variables","filter","data","error","loading","refetch","useEffect","undefined","edges","map","profile","node","profilesFromEdges","length","stateValues","stateKey"],"mappings":"yUAaMA,EAAQC,IAAH,k8BA8CLC,EAAc,SAAC,GAAD,SAAGC,cACH,kBAAC,IAAD,CAAeC,QAAU,EAAIC,QAAU,KAAU,kBAAC,KAAD,OAGrEH,EAAYI,UAAY,CACpBH,cAAeG,UAGnB,IAAMC,EAAgB,kBAClB,kBAAC,IAAD,KACI,kBAAC,IAAD,CAAiBC,MAAM,cAIlBC,EAAU,WACnB,IAAIC,EAAW,GACXC,GAAW,EACTC,GAAWC,mBACXV,GAAgBW,QAAW,oBAC3BC,EAAOZ,EAAgBa,KAAeC,KALnB,GASeC,cAASlB,EAAO,CACpDmB,UAAW,CAAEC,OAJF,oIAGTC,EATmB,EASnBA,KAAMC,EATa,EASbA,MAAOC,EATM,EASNA,QAASC,EATH,EASGA,QAe5B,OAXAC,gBAAU,WACND,MACD,CAACZ,EAAUY,IAEVH,IAEAC,OAAQI,EACRH,OAAUG,EACVf,GAHAD,EAtCkB,SAACW,GAAD,cACrBA,SAAA,UAAAA,EAAMX,gBAAN,eAAgBiB,QAAS,IAAIC,KAAI,SAACC,GAAD,OAC9BA,EAAQC,QAoCGC,CAAkBV,KAGNX,EAASsB,OAAS,GAGtC,kBAAC,KAAD,CAAoBC,YAAc,CAAEX,QAAOD,OAAME,YACpD,kBAAC,KAAD,CAAeW,SAAS,WACpB,kBAAC3B,EAAD,MACA,kBAAC,IAAD,KACI,kBAACL,EAAD,CAAoBC,oBAG5B,kBAAC,KAAD,CAAe+B,SAAS,QACpB,kBAAC3B,EAAD,MACA,kBAAC,IAAD,KACMI,EAAW,kBAACI,EAAD,CAAaL,aAAkB,kBAAC,KAAD,UAM5D","file":"js/Reports.16cfe33c02d13d04271b.js","sourcesContent":["import React, { useEffect } from 'react';\nimport propTypes from 'prop-types';\nimport { useLocation } from 'react-router-dom';\nimport { useQuery } from '@apollo/react-hooks';\nimport gql from 'graphql-tag';\nimport PageHeader, { PageHeaderTitle } from '@redhat-cloud-services/frontend-components/PageHeader';\nimport Main from '@redhat-cloud-services/frontend-components/Main';\nimport SkeletonTable from '@redhat-cloud-services/frontend-components/SkeletonTable';\nimport {\n    ReportCardGrid, ReportsTable, StateViewPart, StateViewWithError, ReportsEmptyState, LoadingComplianceCards\n} from 'PresentationalComponents';\nimport useFeature from 'Utilities/hooks/useFeature';\n\nconst QUERY = gql`\nquery Profiles($filter: String!) {\n    profiles(search: $filter, limit: 1000){\n        edges {\n            node {\n                id\n                name\n                refId\n                description\n                policyType\n                totalHostCount\n                testResultHostCount\n                compliantHostCount\n                unsupportedHostCount\n                majorOsVersion\n                ssgVersion\n                complianceThreshold\n                businessObjective {\n                    id\n                    title\n                }\n                policy {\n                    id\n                    name\n                    benchmark {\n                        id\n                        version\n                    }\n                }\n                benchmark {\n                    id\n                    version\n                }\n            }\n        }\n\n    }\n}\n`;\n\nconst profilesFromEdges = (data) => (\n    (data?.profiles?.edges || []).map((profile) => (\n        profile.node\n    ))\n);\n\nconst LoadingView = ({ showTableView }) => (\n    showTableView ? <SkeletonTable colSize={ 3 } rowSize={ 10 } /> : <LoadingComplianceCards />\n);\n\nLoadingView.propTypes = {\n    showTableView: propTypes.bool\n};\n\nconst ReportsHeader = () => (\n    <PageHeader>\n        <PageHeaderTitle title=\"Reports\" />\n    </PageHeader>\n);\n\nexport const Reports = () => {\n    let profiles = [];\n    let showView = false;\n    const location = useLocation();\n    const showTableView = useFeature('reportsTableView');\n    const View = showTableView ? ReportsTable : ReportCardGrid;\n    const filter = `(has_policy_test_results = true AND external = false)\n                    OR (has_policy = false AND has_test_results = true)`;\n\n    let { data, error, loading, refetch } = useQuery(QUERY, {\n        variables: { filter }\n    });\n\n    useEffect(() => {\n        refetch();\n    }, [location, refetch]);\n\n    if (data) {\n        profiles = profilesFromEdges(data);\n        error = undefined;\n        loading = undefined;\n        showView = profiles && profiles.length > 0;\n    }\n\n    return <StateViewWithError stateValues={ { error, data, loading } }>\n        <StateViewPart stateKey='loading'>\n            <ReportsHeader />\n            <Main>\n                <LoadingView { ...{ showTableView } } />\n            </Main>\n        </StateViewPart>\n        <StateViewPart stateKey='data'>\n            <ReportsHeader />\n            <Main>\n                { showView ? <View { ...{ profiles } } /> : <ReportsEmptyState /> }\n            </Main>\n        </StateViewPart>\n    </StateViewWithError>;\n};\n\nexport default Reports;\n"],"sourceRoot":""}