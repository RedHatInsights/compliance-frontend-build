(self.webpackChunkcompliance_frontend=self.webpackChunkcompliance_frontend||[]).push([[402],{82813:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ComplianceSystems:()=>S,default:()=>T});var r,i=n(94949),o=n(91454),s=n(77865),a=n.n(s),c=n(61084),l=n(44119),u=n.n(l),d=n(46829),p=n(48716),m=n(39173),f=n(86350),y=n(37311),h=n(93188),b=n(55186),v=n(49690),E=n(42564);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var I=u()(r||(r=(0,o.Z)(['\n{\n    profiles(search: "external = false and canonical = false") {\n        edges {\n            node {\n                id\n                name\n                refId\n                majorOsVersion\n            }\n        }\n    }\n}\n']))),S=function(){var e,t=(0,E.ZP)("newInventory"),n=(0,d.useQuery)(I),r=n.data,i=n.error,o=n.loading,l=(0,c.useDispatch)(),u=[O({key:"facts.compliance.display_name",title:"Name",props:{width:40,isStatic:!0}},t&&{key:"display_name",renderFunc:v.B3}),O({key:"facts.compliance.policies",title:"Policies",props:{width:40,isStatic:!0}},t&&{key:"policyNames",renderFunc:function(e){return((0,v.ek)({policyNames:e})||{title:""}).title}}),O({key:"facts.compliance.details_link",title:"",props:{width:20,isStatic:!0}},t&&{key:"testResultProfiles",renderFunc:function(e,t){return((0,v.rI)({testResultProfiles:e,id:t})||{title:""}).title}})],g=null==r||null===(e=r.profiles)||void 0===e?void 0:e.edges.map((function(e){return e.node}));(0,s.useLayoutEffect)((function(){l({type:"SELECT_ENTITIES",payload:{ids:[]}})}),[]);var S=t?h.e_:h.r0;return a().createElement(a().Fragment,null,a().createElement(p.Z,{className:"page-header"},a().createElement(m.Z,{title:"Systems"})),a().createElement(f.Z,null,a().createElement(y.tC,{stateValues:{error:i,data:r,loading:o}},a().createElement(y.K7,{stateKey:"data"},g&&a().createElement(S,{query:b.Ep,defaultFilter:"has_test_results = true or has_policy = true",systemProps:{isFullView:!0},showOsFilter:!0,showComplianceSystemsInfo:!0,enableEditPolicy:!1,remediationsEnabled:!1,columns:u,policies:g})))))};const T=S},92428:(e,t,n)=>{"use strict";n.r(t),n.d(t,{CreatePolicy:()=>ve,default:()=>ge});var r,i=n(11102),o=n(77865),s=n.n(o),a=n(334),c=n(33766),l=n(61084),u=n(45697),d=n.n(u),p=n(36801),m=n(94949),f=n(91454),y=n(42065),h=n(37311),b=n(44119),v=n.n(b),E=n(46829),g=n(6023),O=n(15113),I=n(46314),S=n(35592);function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){(0,m.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var j=v()(r||(r=(0,f.Z)(['\nquery benchmarksAndProfiles {\n    latestBenchmarks {\n        id\n        title\n        refId\n        version\n        osMajorVersion\n        profiles {\n            id\n            name\n            refId\n            description\n            complianceThreshold\n        }\n    }\n    profiles(search: "external = false and canonical = false") {\n        edges {\n            node {\n                id\n                refId\n                benchmark {\n                    refId\n                }\n            }\n        }\n    }\n}\n']))),w=function(e){var t=e.change,n=e.selectedBenchmarkId,r=(0,E.useQuery)(j,{fetchPolicy:"no-cache"}),i=r.data,o=r.error,a=r.loading;if(o)return o;if(a)return s().createElement(g.Z,null);var c,l,u,d,m=i.latestBenchmarks;if(n){c=m.find((function(e){return e.id===n}));var f=(u=i.profiles.edges,d=c,u.filter((function(e){return d.refId===e.node.benchmark.refId})).map((function(e){return e.node.refId})));l=c.profiles.map((function(e){return P(P({},e),{},{disabled:f.includes(e.refId)})}))}return s().createElement(s().Fragment,null,s().createElement(p.TextContent,null,s().createElement(p.Text,{component:p.TextVariants.h1},"Create SCAP policy"),s().createElement(p.Text,{component:p.TextVariants.h4},"Select the operating system and policy type")),s().createElement(p.Form,null,s().createElement(p.FormGroup,{label:"Operating system",isRequired:!0,fieldId:"benchmark"},s().createElement("br",null),m&&m.sort((function(e,t){return e.refId.localeCompare(t.refId)})).map((function(e){var r=e.id,i=e.osMajorVersion;return s().createElement(p.Button,{key:r,onClick:function(){return function(e){var n=e.id,r=e.osMajorVersion;t("benchmark",n),t("osMajorVersion",r)}(e)},className:"wizard-os-button ".concat(n===r?"active-wizard-os-button":""),variant:"tertiary"},"RHEL ".concat(i))}))),c&&s().createElement(p.Text,{component:p.TextVariants.small},"SCAP Security Guide (SSG): ",c.title," - ",c.version,s().createElement(p.Tooltip,{position:p.TooltipPosition.right,content:"Policies configured in the Compliance services use\n                                                                        the latest version of the SSG packaged with RHEL."},s().createElement("span",null," ",s().createElement(y.ZP,{className:"grey-icon"})))),s().createElement(p.FormGroup,{label:"Policy type",isRequired:!0,fieldId:"policy-type"},s().createElement(h.yL,{profiles:c&&l,onClick:function(){t("selectedRuleRefIds",null)}}))))};w.propTypes={selectedBenchmarkId:d().string,change:O.ZP.change};var Z=(0,c.Z)("policyForm");const x=(0,S.compose)((0,l.connect)((function(e){return{selectedBenchmarkId:Z(e,"benchmark")}})),(0,I.Z)({form:"policyForm",destroyOnUnmount:!1,forceUnregisterOnUnmount:!0}))(w);var R,k=n(2707),F=n(92223),C=v()(R||(R=(0,f.Z)(["\nquery benchmarkAndProfile($benchmarkId: String!, $profileId: String!){\n    benchmark(id: $benchmarkId) {\n        id\n        rules {\n            id\n            title\n            severity\n            rationale\n            refId\n            description\n            remediationAvailable\n            identifier\n        }\n    }\n    profile(id: $profileId) {\n        id\n        name\n        refId\n        rules {\n            id\n            refId\n        }\n    }\n}\n"]))),V=function(e){var t,n,r=e.profileId,a=e.benchmarkId,c=e.selectedRuleRefIds,l=e.change,u=(0,k.eo)(["Name","Severity","Ansible"]),d=(0,E.useQuery)(C,{variables:{profileId:r,benchmarkId:a}}),m=d.data,f=d.error,y=d.loading,b=(0,o.useState)(null),v=(0,i.Z)(b,2),O=v[0],I=v[1],S=m&&[{profile:{refId:m.profile.refId,name:m.profile.name},rules:m.benchmark.rules}];return(0,o.useEffect)((function(){if(m){var e=m.profile.rules.map((function(e){return e.refId}));I(e),c||l("selectedRuleRefIds",e)}}),[m,l,c]),s().createElement(h.tC,{stateValues:{error:f,data:m,loading:y}},s().createElement(h.K7,{stateKey:"loading"},s().createElement(F.Z,null,s().createElement(g.Z,null))),s().createElement(h.K7,{stateKey:"data"},s().createElement(p.TextContent,null,s().createElement(p.Text,{component:p.TextVariants.h1},"Rules")),s().createElement(p.TextContent,null,s().createElement(p.Text,null,"Edit your policy by including and excluding rules."),s().createElement(p.Text,null,"Selected policy type ",s().createElement("strong",null,null==m?void 0:m.profile.name)," has ",null==O?void 0:O.length," rules. ",c&&(n=null==(t=c)?void 0:t.filter((function(e){return null==O?void 0:O.includes(e)})),!(t&&O&&n.length===O.length))&&s().createElement(p.Button,{variant:"link",isInline:!0,onClick:function(){return l("selectedRuleRefIds",O)}},"Reset to default selection"))),s().createElement(k.ZP,{remediationsEnabled:!1,tailoringEnabled:!0,selectedFilter:!0,columns:u,loading:y,handleSelect:function(e){return l("selectedRuleRefIds",e)},profileRules:S,selectedRefIds:c||[]})))};V.propTypes={profileId:d().string,benchmarkId:d().string,change:O.ZP.change,selectedRuleRefIds:d().array};var _=(0,c.Z)("policyForm");const D=(0,S.compose)((0,l.connect)((function(e){return{benchmarkId:_(e,"benchmark"),profileId:JSON.parse(_(e,"profile")).id,selectedRuleRefIds:_(e,"selectedRuleRefIds")}})),(0,I.Z)({form:"policyForm",destroyOnUnmount:!1,forceUnregisterOnUnmount:!0}))(V);var L=n(93188),N=n(55186),A=n(42564),M=n(49690);function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){(0,m.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var B=function(e){var t=e.change,n=e.osMajorVersion,r=e.selectedSystemIds,i=(0,A.ZP)("newInventory"),a=[q({key:"facts.compliance.display_name",title:"Name",props:{width:40,isStatic:!0}},i&&{key:"display_name",renderFunc:M.B3}),q({key:"facts.compliance.policies",title:"Policies",props:{width:40,isStatic:!0}},i&&{key:"policies"})];(0,o.useEffect)((function(){r&&t("systems",r)}),[r,t]);var c=i?L.e_:L.r0;return s().createElement(s().Fragment,null,s().createElement(p.TextContent,{className:"pf-u-mb-md"},s().createElement(p.Text,{component:p.TextVariants.h1},"Systems"),s().createElement(p.Text,null,"Select which of your ",s().createElement("b",null,"RHEL ",n)," systems should be included in this policy.",s().createElement("br",null),"Systems can be added or removed at any time.")),s().createElement(p.Form,null,s().createElement(p.FormGroup,null,s().createElement(c,{columns:a,remediationsEnabled:!1,compact:!0,showActions:!1,query:N.Y0,defaultFilter:n&&"os_major_version = ".concat(n),enableExport:!1}))))};B.propTypes={osMajorVersion:d().string,selectedSystemIds:d().array,change:O.ZP.change},B.defaultProps={selectedSystemIds:[]};var U=(0,c.Z)("policyForm");const G=(0,S.compose)((0,l.connect)((function(e){var t;return{osMajorVersion:U(e,"osMajorVersion"),selectedSystemIds:((null===(t=e.entities)||void 0===t?void 0:t.selectedEntities)||[]).map((function(e){return e.id}))}})),(0,I.Z)({form:"policyForm",destroyOnUnmount:!1,forceUnregisterOnUnmount:!0}))(B);var z=n(6455),J=n(53426),K=function(e){var t=e.profile;return s().createElement(s().Fragment,null,s().createElement(p.TextContent,null,s().createElement(p.Text,{component:p.TextVariants.h1},"Details")),s().createElement("br",null),s().createElement(p.Form,{id:"editpolicydetails"},s().createElement(p.FormGroup,{label:"Policy name",isRequired:!0,fieldId:"name"},s().createElement(z.Z,{component:J._c,type:"text",isRequired:!0,id:"name",name:"name","aria-describedby":"name"})),s().createElement(p.FormGroup,{label:"Reference ID",isRequired:!0,fieldId:"refId"},s().createElement(z.Z,{type:"text",component:J._c,isDisabled:!0,id:"refId",name:"refId","aria-describedby":"refId"})),s().createElement(p.FormGroup,{label:"Description",fieldId:"description"},s().createElement(z.Z,{type:"text",component:J.do,id:"description",name:"description","aria-describedby":"description"})),s().createElement(p.FormGroup,{label:"Business objective",fieldId:"businessObjective"},s().createElement(z.Z,{type:"text",component:J._c,id:"businessObjective",name:"businessObjective","aria-describedby":"businessObjective",defaultValue:t.businessObjective})),s().createElement(h._z,{showTitle:!1,previousThreshold:t.complianceThreshold})))},W=(0,c.Z)("policyForm");K.propTypes={profile:d().object,dispatch:d().func};const Y=(0,S.compose)((0,l.connect)((function(e){return{profile:JSON.parse(W(e,"profile")),initialValues:{name:"".concat(JSON.parse(W(e,"profile")).name),refId:"".concat(JSON.parse(W(e,"profile")).refId),description:"".concat(JSON.parse(W(e,"profile")).description),benchmark:W(e,"benchmark"),osMajorVersion:W(e,"osMajorVersion"),profile:W(e,"profile")}}})),(0,I.Z)({form:"policyForm",destroyOnUnmount:!1,forceUnregisterOnUnmount:!0}))(K);var H,Q=v()(H||(H=(0,f.Z)(["\nquery review($benchmarkId: String!) {\n    benchmark(id: $benchmarkId) {\n        id\n        title\n        refId\n        osMajorVersion\n        version\n    }\n}\n"]))),X=function(e){var t=e.benchmarkId,n=e.name,r=e.refId,i=e.businessObjective,o=e.systemsCount,a=e.rulesCount,c=e.complianceThreshold,l=e.parentProfileName,u=(0,E.useQuery)(Q,{variables:{benchmarkId:t}}),d=u.data,m=u.error,f=u.loading;if(m)return m;if(f)return s().createElement(g.Z,null);var y=d.benchmark;return s().createElement(p.TextContent,null,s().createElement(p.Text,{component:p.TextVariants.h1},"Review"),s().createElement(p.Text,{component:p.TextVariants.h4},"Review your policy before finishing."),s().createElement(p.TextList,{component:p.TextListVariants.dl},s().createElement(p.TextListItem,{component:p.TextListItemVariants.dt},"Operating system"),s().createElement(p.TextListItem,{component:p.TextListItemVariants.dd},"RHEL ".concat(y.osMajorVersion)),s().createElement(p.TextListItem,{component:p.TextListItemVariants.dt},"Security guide"),s().createElement(p.TextListItem,{component:p.TextListItemVariants.dd}," ".concat(y.title," - ").concat(y.version)),s().createElement(p.TextListItem,{component:p.TextListItemVariants.dt},"Policy type"),s().createElement(p.TextListItem,{component:p.TextListItemVariants.dd},l),s().createElement(p.TextListItem,{component:p.TextListItemVariants.dt},"Policy name"),s().createElement(p.TextListItem,{component:p.TextListItemVariants.dd},n),s().createElement(p.TextListItem,{component:p.TextListItemVariants.dt},"Reference ID"),s().createElement(p.TextListItem,{component:p.TextListItemVariants.dd},r),s().createElement(p.TextListItem,{component:p.TextListItemVariants.dt},"Compliance threshold"),s().createElement(p.TextListItem,{component:p.TextListItemVariants.dd},c,"%"),i&&s().createElement(s().Fragment,null,s().createElement(p.TextListItem,{component:p.TextListItemVariants.dt},"Business objective"),s().createElement(p.TextListItem,{component:p.TextListItemVariants.dd},i)),s().createElement(p.TextListItem,{component:p.TextListItemVariants.dt},"No. of rules"),s().createElement(p.TextListItem,{component:p.TextListItemVariants.dd},a),s().createElement(p.TextListItem,{component:p.TextListItemVariants.dt},"No. of systems"),s().createElement(p.TextListItem,{component:p.TextListItemVariants.dd},o>0?o:s().createElement(h.UN,{variant:"compact",count:o}))))};X.propTypes={benchmarkId:d().string,refId:d().string,name:d().string,businessObjective:d().string,systemsCount:d().number,rulesCount:d().number,complianceThreshold:d().number,parentProfileName:d().string};var ee=(0,c.Z)("policyForm");const te=(0,l.connect)((function(e){return{benchmarkId:ee(e,"benchmark"),refId:ee(e,"refId"),name:ee(e,"name"),businessObjective:ee(e,"businessObjective"),systemsCount:ee(e,"systems").length,complianceThreshold:parseFloat(ee(e,"complianceThreshold"))||100,parentProfileName:JSON.parse(ee(e,"profile")).name,rulesCount:ee(e,"selectedRuleRefIds").length}}))(X);var ne=n(80043),re=n(68670),ie=n(83816),oe=n(36678),se=n(13180),ae=n(26086),ce=n(4656),le=n(87757),ue=n.n(le),de=n(5913),pe=n(98467),me=n(13173);var fe=function(e){(0,se.Z)(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,ce.Z)(t);if(n){var i=(0,ce.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,ae.Z)(this,e)});function i(){var e;(0,re.Z)(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),(0,m.Z)((0,oe.Z)(e),"state",{percent:0,message:"This usually takes a minute or two.",errors:null,failed:!1}),(0,m.Z)((0,oe.Z)(e),"createProfile",(0,ne.Z)(ue().mark((function t(){var n,r,i,o,s,a,c,l,u,d,p,m;return ue().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.props,r=n.businessObjective,i=n.benchmarkId,o=n.cloneFromProfileId,s=n.refId,a=n.name,c=n.description,l=n.complianceThreshold,u=n.selectedRuleRefIds,d=n.client,p={benchmarkId:i,cloneFromProfileId:o,complianceThreshold:l,description:c,name:a,refId:s,selectedRuleRefIds:u},!r){t.next=7;break}return t.next=5,d.mutate({mutation:me.Jd,variables:{input:{title:r}}});case 5:m=t.sent,p.businessObjectiveId=m.data.createBusinessObjective.businessObjective.id;case 7:return t.abrupt("return",d.mutate({mutation:me.nT,variables:{input:p}}));case 8:case"end":return t.stop()}}),t)})))),(0,m.Z)((0,oe.Z)(e),"associateSystems",(function(){var t=e.props,n=t.systemIds,r=t.client,i=e.state.profileId;return r.mutate({mutation:me.oI,variables:{input:{id:i,systemIds:n}}}).then((function(){e.setState((function(e){return{percent:e.percent+50,message:""}}))})).catch((function(t){e.setState({message:t.networkError.message,errors:t.networkError.result.errors,failed:!0})}))})),e}return(0,ie.Z)(i,[{key:"componentDidMount",value:function(){var e=this;this.createProfile().then((function(t){e.setState((function(e){return{percent:e.percent+50,profileId:t.data.createProfile.profile.id}}),e.associateSystems)})).catch((function(t){e.setState({message:t.networkError.message,errors:t.networkError.result.errors,failed:!0})}))}},{key:"render",value:function(){var e,t=this.state,n=t.percent,r=t.message,i=t.failed,o=t.errors,a=this.props.onWizardFinish;return o&&Array.isArray(o)&&o.length>0&&(e=o.map((function(e){return s().createElement(p.ListItem,{key:e},e)}))),s().createElement(p.Bullseye,null,s().createElement(p.EmptyState,{variant:p.EmptyStateVariant.full},s().createElement(p.EmptyStateIcon,{icon:de.ZP}),s().createElement("br",null),s().createElement(p.Title,{headingLevel:"h1",size:"lg"},"Creating policy"),s().createElement(p.EmptyStateBody,null,s().createElement(h.ko,{percent:n,failed:i})),s().createElement(p.EmptyStateBody,{className:i&&"wizard-failed-message"},r),e&&s().createElement(p.EmptyStateBody,{className:"wizard-failed-errors"},s().createElement(p.List,null,e)),s().createElement(p.EmptyStateSecondaryActions,null,100===n?s().createElement(p.Button,{variant:"primary",onClick:function(){a()}},"Return to application"):"")))}}]),i}(s().Component);fe.propTypes={benchmarkId:d().string.isRequired,client:d().object.isRequired,businessObjective:d().object,cloneFromProfileId:d().string.isRequired,refId:d().string.isRequired,name:d().string.isRequired,description:d().string,systemIds:d().array,complianceThreshold:d().number,onWizardFinish:d().func,selectedRuleRefIds:d().arrayOf(d().string).isRequired};var ye=(0,c.Z)("policyForm");const he=(0,S.compose)((0,l.connect)((function(e){return{benchmarkId:ye(e,"benchmark"),businessObjective:ye(e,"businessObjective"),cloneFromProfileId:JSON.parse(ye(e,"profile")).id,refId:ye(e,"refId"),name:ye(e,"name"),description:ye(e,"description"),complianceThreshold:parseFloat(ye(e,"complianceThreshold"))||100,systemIds:ye(e,"systems"),selectedRuleRefIds:ye(e,"selectedRuleRefIds")}})),(0,I.Z)({form:"policyForm",destroyOnUnmount:!0,forceUnregisterOnUnmount:!0}),pe.withApollo)(fe);var be=n(62560),ve=function(e){var t=e.benchmark,n=e.osMajorVersion,r=e.complianceThreshold,c=e.name,l=e.profile,u=e.refId,d=e.selectedRuleRefIds,m=(0,a.useHistory)(),f=(0,o.useState)(1),y=(0,i.Z)(f,2),h=y[0],b=y[1],v=function(){m.push("/scappolicies")},E=[{id:1,name:"Create SCAP policy",component:s().createElement(x,null),enableNext:(0,be.$H)(t,n,l)},{id:2,name:"Details",component:s().createElement(Y,null),canJumpTo:h>=2,enableNext:(0,be.Ay)(c,u,r)},{id:3,name:"Systems",component:s().createElement(G,null),canJumpTo:h>=3},{id:4,name:"Rules",component:s().createElement(D,null),canJumpTo:h>=4,enableNext:(0,be.hT)(d)},{id:5,name:"Review",component:s().createElement(te,null),nextButtonText:"Finish",canJumpTo:h>=5},{id:6,name:"Finished",component:s().createElement(he,{onWizardFinish:v}),isFinishedStep:!0,canJumpTo:h>=6}];return s().createElement(s().Fragment,null,s().createElement(p.Wizard,{isOpen:!0,onClose:v,title:"Create SCAP policy",description:"Create a new policy for managing SCAP compliance",steps:E,onNext:function(e){var t=e.id;b(h<t?t:h)}}))};ve.propTypes={benchmark:d().string,osMajorVersion:d().string,complianceThreshold:d().string,businessObjective:d().object,dispatch:d().func,isOpen:d().bool,name:d().string,onWizardFinish:d().func,profile:d().string,refId:d().string,selectedRuleRefIds:d().arrayOf(d().string)},ve.defaultProps={isOpen:!1};var Ee=(0,c.Z)("policyForm");const ge=(0,l.connect)((function(e){return{benchmark:Ee(e,"benchmark"),osMajorVersion:Ee(e,"osMajorVersion"),businessObjective:Ee(e,"businessObjective"),complianceThreshold:Ee(e,"complianceThreshold")||100,name:Ee(e,"name"),profile:Ee(e,"profile"),refId:Ee(e,"refId"),selectedRuleRefIds:Ee(e,"selectedRuleRefIds")}}))(ve)},59354:(e,t,n)=>{"use strict";n.r(t),n.d(t,{EditPolicy:()=>k,default:()=>F});var r=n(94949),i=n(11102),o=n(77865),s=n.n(o),a=n(45697),c=n.n(a),l=n(334),u=n(61084),d=n(36801),p=n(37311),m=n(93188),f=n(50437),y=n(52998),h=n(62560);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var E=function(e){var t,n=e.policy,r=e.setUpdatedPolicy,a=function(){var e=(0,o.useState)(!0),t=(0,i.Z)(e,2),n=t[0],r=t[1];return[n,function(e){var t=(0,h.KJ)(e);return r(t),t}]}(),c=(0,i.Z)(a,2),l=c[0],u=c[1];return s().createElement(s().Fragment,null,s().createElement(d.FormGroup,{label:"Policy description",isRequired:!0,fieldId:"description"},s().createElement(d.TextArea,{style:{width:800,height:110},isRequired:!0,type:"text",id:"description",name:"description","aria-describedby":"description",defaultValue:n.description,onChange:function(e){r((function(t){return v(v({},t),{},{description:e})}))}})),s().createElement(d.FormGroup,{label:"Business objective",fieldId:"business-objective"},s().createElement(d.TextInput,{type:"text",style:{width:300},id:"business-objective",name:"business-objective","aria-describedby":"business-objective",defaultValue:null==n||null===(t=n.businessObjective)||void 0===t?void 0:t.title,onChange:function(e){r((function(t){return v(v({},t),{},{businessObjective:v(v({},t.businessObjective),{},{title:e})})}))}})),s().createElement(d.FormGroup,{validated:l?"default":"error",label:"Compliance threshold (%)",fieldId:"policy-threshold",helperTextInvalid:"Threshold has to be a number between 0 and 100",helperText:"A value of 95% or higher is recommended"},s().createElement(d.TextInput,{type:"number",style:{width:150},name:"compliance-threshold",id:"compliance-threshold",defaultValue:n.complianceThreshold,"aria-describedby":"policy-threshold",onChange:function(e){r((function(t){return v(v({},t),{},{complianceThreshold:e,complianceThresholdValid:u(e)})}))}})))};E.propTypes={policy:c().shape({description:c().string,businessObjective:c().object,complianceThreshold:c().oneOfType([c().string,c().number])}),setUpdatedPolicy:c().func};const g=E;var O=n(80043),I=n(87757),S=n.n(I),T=n(46829),P=n(13173);var j=n(42564),w=n(49690),Z=n(55186);function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var k=function(e){var t,n,r,a,c,h,b,v,E=e.route,I=(0,j.ZP)("newInventory"),x=(0,l.useLocation)(),k=(0,u.useDispatch)(),F=null==x||null===(t=x.state)||void 0===t?void 0:t.policy,C=(0,f.Wb)(),V=(0,o.useState)(null),_=(0,i.Z)(V,2),D=_[0],L=_[1],N=(n=(0,T.useMutation)(P.Jd),r=(0,i.Z)(n,1)[0],a=function(){var e=(0,O.Z)(S().mark((function e(t,n){var i,o,s;return S().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((null==t||null===(i=t.businessObjective)||void 0===i?void 0:i.title)!==(null==n?void 0:n.title)){e.next=4;break}return e.abrupt("return",null==t||null===(o=t.businessObjective)||void 0===o?void 0:o.id);case 4:if(""!==(null==n?void 0:n.title)){e.next=8;break}return e.abrupt("return",null);case 8:return e.next=10,r({variables:{input:{title:n.title}}});case 10:return s=e.sent,e.abrupt("return",s.data.createBusinessObjective.businessObjective.id);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),c=(0,T.useMutation)(P.r0),h=(0,i.Z)(c,1)[0],b=(0,T.useMutation)(P.oI),v=(0,i.Z)(b,1)[0],function(){var e=(0,O.Z)(S().mark((function e(t,n){var r;return S().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.id,e.t1=n.name,e.t2=n.description,e.t3=parseFloat(n.complianceThreshold),e.next=6,a(t,null==n?void 0:n.businessObjective);case 6:return e.t4=e.sent,r={id:e.t0,name:e.t1,description:e.t2,complianceThreshold:e.t3,businessObjectiveId:e.t4},v({variables:{input:{id:t.id,systemIds:n.hosts.map((function(e){return e.id}))}}}),e.next=11,h({variables:{input:r}});case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),A=(0,f.C3)("/scappolicies"),M=(0,u.useSelector)((function(e){var t;return null==e||null===(t=e.entities)||void 0===t?void 0:t.selectedEntities})),$=D&&!D.complianceThresholdValid,q=function(){I&&k({type:"SELECT_ENTITIES",payload:{ids:[]}}),A({hash:C})},B=[s().createElement(d.Button,{isDisabled:$,key:"save",variant:"primary",onClick:function(){return N(F,D).then((function(){return q()}))}},"Save"),s().createElement(d.Button,{key:"cancel",variant:"secondary",onClick:function(){return q()}},"Cancel")];(0,o.useEffect)((function(){L(R(R({},D),{},{hosts:M||[]}))}),[M]),(0,o.useEffect)((function(){var e,t=F.complianceThreshold<101&&F.complianceThreshold>0;L(R(R({},F),{},{complianceThresholdValid:t})),k({type:"SELECT_ENTITIES",payload:{ids:(null==F||null===(e=F.hosts)||void 0===e?void 0:e.map((function(e){return{id:e.id}})))||[]}})}),[F]);var U=I?m.e_:m.r0;return(0,y.a)(E,null==F?void 0:F.name),F&&s().createElement(d.Modal,{isOpen:!0,style:{height:"400px"},width:1e3,title:"Edit ".concat(F.name),onClose:function(){return q()},actions:B},s().createElement(d.Form,null,s().createElement(p.tn,{defaultTab:"details"},s().createElement(d.Tab,{eventKey:"details",title:s().createElement(d.TabTitleText,null,"Details")},s().createElement(g,{policy:F,setUpdatedPolicy:L})),s().createElement(d.Tab,{eventKey:"rules",title:s().createElement(d.TabTitleText,null,"Rules")},"Rule editing coming soon"),s().createElement(d.Tab,{eventKey:"systems",title:s().createElement(d.TabTitleText,null,"Systems")},s().createElement(U,{compact:!0,showActions:!1,enableExport:!1,remediationsEnabled:!1,policyId:F.id,defaultFilter:"os_major_version = ".concat(F.majorOsVersion),query:Z.Y0,columns:[R({key:"facts.compliance.display_name",title:"Name",props:{width:40,isStatic:!0}},I&&{key:"display_name",renderFunc:function(e,t,n){return null!=n&&n.lastScanned?(0,w.B3)(e,t,n):e}})],preselectedSystems:(null==F?void 0:F.hosts.map((function(e){return{id:e.id}})))||[]})))))};k.propTypes={route:c().object};const F=k},21157:(e,t,n)=>{"use strict";n.d(t,{n1:()=>L,ZP:()=>H});var r=n(94786),i=n(60515),o=n(68670),s=n(83816),a=n(36678),c=n(13180),l=n(26086),u=n(4656),d=n(94949),p=n(67301),m=n(91454),f=n(35937),y=n.n(f),h=n(77865),b=n.n(h),v=n(45697),E=n.n(v),g=n(98467),O=n(61084),I=n(44119),S=n.n(I),T=n(75959),P=n(22642),j=n(67336),w=n(37311),Z=n(59088),x=n(33660),R=n(16703),k=n(49690),F=n(31222),C=n(51851),V=n(36801),_=n(33739),D=function(e){var t=e.supported,n=e.ssgVersion;return n||(n="Not available"),t?n:b().createElement(w.cT,{messageVariant:"singular"},n)};D.propTypes={supported:E().bool,ssgVersion:E().string};const L={SSGVersion:D};var N,A,M;function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){(0,d.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var B=S()(N||(N=(0,m.Z)(["\nquery getSystems($filter: String!, $policyId: ID, $perPage: Int, $page: Int) {\n    systems(search: $filter, limit: $perPage, offset: $page) {\n        totalCount\n        edges {\n            node {\n                id\n                name\n                osMajorVersion\n                osMinorVersion\n                testResultProfiles(policyId: $policyId) {\n                    id\n                    name\n                    refId\n                    lastScanned\n                    compliant\n                    external\n                    score\n                    supported\n                    ssgVersion\n                    rules {\n                        refId\n                        title\n                        compliant\n                        remediationAvailable\n                    }\n                }\n                policies(policyId: $policyId) {\n                    id\n                    name\n                }\n            }\n        }\n    }\n}\n"]))),U=S()(A||(A=(0,m.Z)(["\nquery getSystems($filter: String!, $policyId: ID, $perPage: Int, $page: Int) {\n    systems(search: $filter, limit: $perPage, offset: $page) {\n        totalCount\n        edges {\n            node {\n                id\n                name\n                osMajorVersion\n                osMinorVersion\n                testResultProfiles(policyId: $policyId) {\n                    id\n                    name\n                    lastScanned\n                    external\n                    compliant\n                    score\n                    supported\n                    ssgVersion\n                    policy {\n                        id\n                    }\n                }\n                policies(policyId: $policyId) {\n                    id\n                    name\n                }\n            }\n        }\n    }\n}\n"]))),G=function(e){return y()(e.initialDefaultState(),(function(e){return!!e}))},z={page:1},J=function(e,t){return[].concat((0,p.Z)((0,F.RM)(e)),(0,p.Z)(t?(0,F.iz)(e):[]))},K=(0,j.ZP)()(M=function(e){(0,c.Z)(f,e);var t,n,m=(t=f,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,u.Z)(t);if(n){var i=(0,u.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,l.Z)(this,e)});function f(){var e;(0,o.Z)(this,f);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=m.call.apply(m,[this].concat(n)),(0,d.Z)((0,a.Z)(e),"inventory",b().createRef()),(0,d.Z)((0,a.Z)(e),"filterConfig",new R.CN([].concat((0,p.Z)(F.qo),(0,p.Z)(e.props.compliantFilter?F.rN:[]),(0,p.Z)(e.props.policies&&e.props.policies.length>0?J(e.props.policies,e.props.showOsFilter):[])))),(0,d.Z)((0,a.Z)(e),"chipBuilder",e.filterConfig.getChipBuilder()),(0,d.Z)((0,a.Z)(e),"filterBuilder",e.filterConfig.getFilterBuilder()),(0,d.Z)((0,a.Z)(e),"state",q(q({},z),{},{policyId:e.props.policyId,perPage:50,totalCount:0,activeFilters:G(e.filterConfig)})),(0,d.Z)((0,a.Z)(e),"componentDidMount",(function(){var t=e.props,n=t.clearAll,r=t.selectedEntities;r&&r.length>0&&n(),(e.props.preselectedSystems?Promise.resolve(e.props.selectEntities(e.props.preselectedSystems)):Promise.resolve()).then((function(){e.updateSystems()}))})),(0,d.Z)((0,a.Z)(e),"componentDidUpdate",(function(t){t.complianceThreshold!==e.props.complianceThreshold&&e.updateSystems()})),(0,d.Z)((0,a.Z)(e),"onRefresh",(function(t){var n=t.page,r=t.per_page,o=(0,i.Z)(t,["page","per_page"]);e.props.showAllSystems&&e.inventory&&e.inventory.current?e.setState({page:n,perPage:r},(function(){e.inventory.current.onRefreshData(q(q({page:n,perPage:r},o),{},{per_page:r}))})):e.setState({page:n,perPage:r},(function(){return e.updateSystems().then((function(){e.inventory&&e.inventory.current&&e.inventory.current.onRefreshData(q(q({page:n,perPage:r},o),{},{per_page:r}))}))}))})),(0,d.Z)((0,a.Z)(e),"fetchSystems",(function(){var t=e.props,n=t.defaultFilter,r=t.client,i=t.showOnlySystemsWithTestResults,o=t.remediationsEnabled,s=e.state,a=s.policyId,c=s.perPage,l=s.page,u=s.activeFilters,d={filter:[n,i&&"has_test_results = true",e.filterBuilder.buildFilterString(u)].filter((function(e){return!!e})).join(" and "),perPage:c,page:l,policyId:a};return r.query({query:o?B:U,fetchResults:!0,fetchPolicy:"no-cache",variables:d})})),(0,d.Z)((0,a.Z)(e),"updateSystems",(function(){var t=e.props.systems.map((function(e){return e.node.id})).sort();return e.fetchSystems().then((function(t){return e.props.updateSystems({systems:t.data.systems.edges,systemsCount:t.data.systems.totalCount})})).then((function(){var n=e.props.systems.map((function(e){return e.node.id})).sort();JSON.stringify(n)===JSON.stringify(t)&&e.props.updateRows()})).catch((function(t){e.setState((function(e){return q(q({},e),{},{error:t})}))}))})),(0,d.Z)((0,a.Z)(e),"onExportSelect",(function(t,n){return e.props.exportFromState(n)})),(0,d.Z)((0,a.Z)(e),"onFilterUpdate",(function(t,n){e.props.updateSystems({systems:[],systemsCount:0}),e.setState(q(q({},z),{},{activeFilters:q(q({},e.state.activeFilters),{},(0,d.Z)({},t,n))}),e.updateSystems)})),(0,d.Z)((0,a.Z)(e),"deleteFilter",(function(t){var n=e.filterConfig.removeFilterWithChip(t,e.state.activeFilters);e.setState(q(q({},z),{},{activeFilters:n}),e.updateSystems)})),(0,d.Z)((0,a.Z)(e),"clearAllFilter",(function(){e.setState(q(q({},z),{},{activeFilters:G(e.filterConfig)}),e.updateSystems)})),(0,d.Z)((0,a.Z)(e),"onFilterDelete",(function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r?e.clearAllFilter():e.deleteFilter(n[0])})),(0,d.Z)((0,a.Z)(e),"onBulkSelect",(function(){var t=e.props,n=t.selectedEntities,r=t.selectAll,i=t.clearSelection,o=t.allSelectedOnPage;0===n.length||n.length>0&&!o?r():i()})),(0,d.Z)((0,a.Z)(e),"isExportDisabled",(function(){var t=e.props,n=t.total,r=t.selectedEntities;return 0===(n||0)&&0===r.length})),e}return(0,s.Z)(f,[{key:"render",value:function(){var e,t=this,n=this.props,i=n.remediationsEnabled,o=n.compact,s=n.enableExport,a=n.showAllSystems,c=n.showActions,l=n.showComplianceSystemsInfo,u=n.selectedEntities,d=n.selectedEntitiesIds,p=n.systems,m=n.total,f=n.policyId,y=n.systemProps,h=n.columns,v=this.state,E=v.page,g=v.perPage,O=v.activeFilters,I=v.error,S=this.filterConfig.buildConfiguration(this.onFilterUpdate,O,{hideLabel:!0}),j=this.chipBuilder.chipsFor(this.state.activeFilters),Z=s?{isDisabled:this.isExportDisabled(),onSelect:this.onExportSelect}:{},R=q(q({},y),{},{onRefresh:this.onRefresh,ref:this.inventory,page:E,perPage:g,exportConfig:Z,tableProps:{canSelectAll:!1},bulkSelect:{checked:u.length>0&&(!!this.props.allSelectedOnPage||null),onSelect:this.onBulkSelect,count:u.length,label:u.length>0?"".concat(u.length," Selected"):void 0}});return c&&(R.actions=[{title:"View in inventory",onClick:function(e,t,n){var r=n.id,i="beta"===window.location.pathname.split("/")[1];window.location.href="".concat(window.location.origin).concat(i?"/beta":"","/insights/inventory/").concat(r)}}]),a||(R.total=m,R.items=p.map((function(e){return e.node.id})),R.filterConfig=S,R.activeFiltersConfig={filters:j,onDelete:this.onFilterDelete}),o&&(R.variant=C.TableVariant.compact),void 0===I&&(e=!0),f&&0===m&&0===Object.keys(O).length&&(R.tableProps.rows=[{cells:[{title:b().createElement(w.zT,null)}]}],R.tableProps.columns=[],R.hasItems=!1,R.hasCheckbox=!1),!a&&i&&(R.dedicatedAction=b().createElement(P.Z,{allSystems:(0,x.qN)(p.filter((function(e){return d.includes(e.node.id)})).map((function(e){return e.node}))),selectedRules:[]})),b().createElement(w.Se,{stateValues:{error:I,noError:e}},b().createElement(w.K7,{stateKey:"error"},b().createElement(w.mf,{error:I})),b().createElement(w.K7,{stateKey:"noError"},l&&b().createElement(V.Alert,{isInline:!0,variant:"info",title:"The list of systems in this view is different than those that appear in the Inventory. Only systems previously or currently associated with compliance policies are displayed."}),b().createElement(_.Z,(0,r.Z)({},R,{fallback:b().createElement(T.Z,{colSize:2,rowSize:15}),onLoad:function(e){var n=e.INVENTORY_ACTION_TYPES,r=e.mergeWithEntities;t.getRegistry().register(q({},r((0,k.zw)(n,h,a))))}}))))}}]),f}(b().Component))||M;K.propTypes={allSelectedOnPage:E().bool,clearAll:E().func,clearInventoryFilter:E().func,clearSelection:E().func,client:E().object,columns:E().array,compact:E().bool,complianceThreshold:E().number,compliantFilter:E().bool,enableExport:E().bool,error:E().object,exportFromState:E().func,policies:E().array,policyId:E().string,defaultFilter:E().string,preselectedSystems:E().array,remediationsEnabled:E().bool,selectAll:E().func,selectEntities:E().func,selectedEntities:E().array,selectedEntitiesIds:E().array,showActions:E().bool,showAllSystems:E().bool,showOnlySystemsWithTestResults:E().bool,showOsFilter:E().bool,systems:E().array,total:E().number,updateRows:E().func,updateSystems:E().func,systemProps:E().shape({isFullView:E().bool}),showComplianceSystemsInfo:E().bool},K.defaultProps={remediationsEnabled:!0,compact:!1,enableExport:!0,showAllSystems:!1,complianceThreshold:0,showOnlySystemsWithTestResults:!1,showActions:!0,compliantFilter:!1,selectedEntities:[],selectedEntitiesIds:[],systems:[],clearAll:function(){return{}},exportFromState:function(){return{}},systemProps:{},showComplianceSystemsInfo:!1};var W=(0,h.memo)((function(e){return b().createElement(K,e)})),Y=(0,g.withApollo)(W);const H=(0,O.connect)((function(e){return void 0===e.entities||void 0===e.entities.rows?{selectedEntities:[],systems:[]}:{allSelectedOnPage:0===e.entities.rows.filter((function(t){return!(e.entities.selectedEntities||[]).map((function(e){return e.id})).includes(t.id)})).length,selectedEntities:e.entities.selectedEntities,selectedEntitiesIds:(e.entities.selectedEntities||[]).map((function(e){return e.id})),systems:e.entities.systems,total:e.entities.total}}),(function(e){return{clearInventoryFilter:function(){return e({type:"CLEAR_FILTERS"})},exportFromState:function(t){return e((0,Z.k6)(t))},updateSystems:function(t){e(q({type:"UPDATE_SYSTEMS"},t))},updateRows:function(){return e({type:"UPDATE_ROWS"})},selectAll:function(){return e((0,Z.td)())},clearSelection:function(){return e((0,Z.MO)())},clearAll:function(){return e({type:Z.pr,payload:{clearAll:!0}})},selectEntities:function(t){return e({type:"SELECT_ENTITIES",payload:{ids:t}})}}}))(Y)},55186:(e,t,n)=>{"use strict";n.d(t,{Ep:()=>u,Y0:()=>d,UD:()=>p});var r,i,o=n(67301),s=n(91454),a=n(44119),c=n.n(a),l=(n(35937),n(31222)),u=c()(r||(r=(0,s.Z)(["\nquery getSystems($filter: String!, $policyId: ID, $perPage: Int, $page: Int) {\n    systems(search: $filter, limit: $perPage, offset: $page) {\n        totalCount\n        edges {\n            node {\n                id\n                name\n                osMajorVersion\n                osMinorVersion\n                testResultProfiles(policyId: $policyId) {\n                    id\n                    name\n                    refId\n                    lastScanned\n                    compliant\n                    external\n                    score\n                    supported\n                    ssgVersion\n                    majorOsVersion\n                    rules {\n                        refId\n                        title\n                        compliant\n                        remediationAvailable\n                    }\n                }\n                policies(policyId: $policyId) {\n                    id\n                    name\n                }\n            }\n        }\n    }\n}\n"]))),d=c()(i||(i=(0,s.Z)(["\nquery getSystems($filter: String!, $policyId: ID, $perPage: Int, $page: Int) {\n    systems(search: $filter, limit: $perPage, offset: $page) {\n        totalCount\n        edges {\n            node {\n                id\n                name\n                osMajorVersion\n                osMinorVersion\n                testResultProfiles(policyId: $policyId) {\n                    id\n                    name\n                    lastScanned\n                    external\n                    compliant\n                    score\n                    supported\n                    ssgVersion\n                    policy {\n                        id\n                    }\n                }\n                policies(policyId: $policyId) {\n                    id\n                    name\n                }\n            }\n        }\n    }\n}\n"]))),p=function(e,t){return[].concat((0,o.Z)((0,l.RM)(e)),(0,o.Z)(t?(0,l.iz)(e):[]))}},93188:(e,t,n)=>{"use strict";n.d(t,{Ey:()=>g,e_:()=>G,r0:()=>O.ZP}),n(82813);var r,i=n(94949),o=n(68670),s=n(83816),a=n(13180),c=n(26086),l=n(4656),u=n(77865),d=n.n(u),p=n(45697),m=n.n(p),f=n(56455),y=n(67336),h=n(38775),b=n(6363);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var E=(0,y.gu)()(r=function(e){(0,a.Z)(u,e);var t,n,r=(t=u,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,l.Z)(t);if(n){var i=(0,l.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,c.Z)(this,e)});function u(e){return(0,o.Z)(this,u),r.call(this,e)}return(0,s.Z)(u,[{key:"render",value:function(){var e=this;return d().createElement(h.Z,{onLoad:function(t){var n=t.mergeWithDetail;return e.getRegistry().register(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n()))}},d().createElement(b.Z,{fallback:d().createElement(f.Z,{size:f.i.md}),hideBack:!0}))}}]),u}(d().Component))||r;E.propTypes={entity:m().object};const g=function(e){return d().createElement(E,e)};var O=n(21157),I=(n(92428),n(5499),n(59354),n(62103),n(94786)),S=n(67301),T=n(11102),P=n(98467),j=n(61084),w=n(75959),Z=n(55186),x=n(49690),R=n(59088),k=n(83194),F=n(31222),C=n(23279),V=n.n(C),_=n(37311),D=n(36801),L=n(51851),N=n(22642),A=n(33660),M=n(39303),$=n(33739);function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var U=function(e){var t=e.columns,n=e.showAllSystems,r=e.policyId,i=e.query,o=e.client,s=e.showActions,a=e.enableExport,c=e.compliantFilter,l=e.policies,p=e.showOnlySystemsWithTestResults,m=e.showOsFilter,f=e.error,h=e.showComplianceSystemsInfo,b=e.compact,v=e.remediationsEnabled,E=e.systemProps,g=e.defaultFilter,O=(0,j.useStore)(),P=(0,j.useDispatch)(),C=(0,u.useRef)(null),q=(0,u.useState)({perPage:50,page:1}),U=(0,T.Z)(q,2),G=U[0],z=U[1],J=(0,u.useState)(!1),K=(0,T.Z)(J,2),W=K[0],Y=K[1],H=(0,M.Z)([].concat((0,S.Z)(F.qo),(0,S.Z)(c?F.rN:[]),(0,S.Z)((null==l?void 0:l.length)>0?(0,Z.UD)(l,m):[]))),Q=H.conditionalFilter,X=H.activeFilters,ee=H.buildFilterString,te=(0,j.useSelector)((function(e){var t=e.entities;return null==t?void 0:t.systemsCount}))||0,ne=(0,j.useSelector)((function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.entities;return(null==n||null===(e=n.systems)||void 0===e?void 0:e.map((function(e){var t;return null==e||null===(t=e.node)||void 0===t?void 0:t.id})))||[]}),j.shallowEqual),re=(0,j.useSelector)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.entities;return(null==t?void 0:t.selectedEntities)||[]}),j.shallowEqual),ie=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;Y(!1);var n=ee(),s=[].concat((0,S.Z)(p?["has_test_results = true"]:[]),(0,S.Z)((null==n?void 0:n.length)>0?[n]:[])).join(" and "),a=g?"(".concat(g,") and (").concat(s,")"):s;return P({type:"GET_SYSTEMS_PENDING"}),o.query({query:i,fetchResults:!0,fetchPolicy:"no-cache",variables:B({filter:a,perPage:e,page:t},r&&{policyId:r})}).then((function(n){var r=n.data,i=n.loading;return P({type:"GET_SYSTEMS_FULFILLED",systems:r.systems.edges,systemsCount:r.systems.totalCount}),Y(!0),z((function(){return{page:t,perPage:e}})),{data:r,loading:i}}))},oe=(0,u.useCallback)(V()(ie,800),[Q.activeFiltersConfig.filters]);return(0,u.useEffect)((function(){Q.activeFiltersConfig.filters&&oe(G.perPage,1)}),[X]),d().createElement(_.Se,{stateValues:{error:f,noError:void 0===f}},d().createElement(_.K7,{stateKey:"error"},d().createElement(_.mf,{error:f})),d().createElement(_.K7,{stateKey:"noError"},h&&d().createElement(D.Alert,{isInline:!0,variant:"info",title:"The list of systems in this view is different than those that appear in the Inventory. Only systems currently associated with or reporting against compliance policies are displayed."}),d().createElement($.Z,(0,I.Z)({},E,{onLoad:function(e){var i=e.INVENTORY_ACTION_TYPES,o=e.mergeWithEntities;(0,y.JH)().register(B({},o((0,x.Q_)(i,t,n,r))))},fallback:d().createElement(w.Z,{colSize:2,rowSize:15}),tableProps:{canSelectAll:!1},variant:b?L.TableVariant.compact:"",ref:C,onRefresh:function(e,t){i&&ie(e.per_page,e.page),!t&&C&&C.current?C.current.onRefreshData(e):t&&t(e)},bulkSelect:{checked:re.length>0&&(!(null==ne||!ne.every((function(e){return null==re?void 0:re.find((function(t){return(null==t?void 0:t.id)===e}))})))||null),onSelect:function(e){return P(e?(0,R.td)():(0,R.MO)())},count:re.length,label:re.length>0?"".concat(re.length," Selected"):void 0}},!n&&B(B(B({},G),{},{isLoaded:W,items:ne,total:te},Q),v&&{dedicatedAction:d().createElement(N.Z,{allSystems:(0,A.qN)(re),selectedRules:[]})}),a&&{exportConfig:{isDisabled:0===te&&0===re.length,onSelect:function(e,t){var n;return(0,k.k6)(null===(n=O.getState())||void 0===n?void 0:n.entities,t)}}},s&&{actions:[{title:"View in inventory",onClick:function(e,t,n){var r=n.id,i="beta"===window.location.pathname.split("/")[1];window.location.href="".concat(window.location.origin).concat(i?"/beta":"","/insights/inventory/").concat(r)}}]}))))};U.propTypes={columns:m().arrayOf(m().shape({})),policies:m().arrayOf(m().shape({})),client:m().object,showAllSystems:m().bool,policyId:m().string,query:m().string,showActions:m().bool,enableExport:m().bool,compliantFilter:m().bool,showOnlySystemsWithTestResults:m().bool,showOsFilter:m().bool,showComplianceSystemsInfo:m().bool,error:m().object,compact:m().bool,remediationsEnabled:m().bool,defaultFilter:m().string,systemProps:m().shape({isFullView:m().bool})},U.defaultProps={policyId:"",showActions:!0,enableExport:!0,compliantFilter:!1,showOnlySystemsWithTestResults:!1,showComplianceSystemsInfo:!1,compact:!1,remediationsEnabled:!0};const G=(0,P.withApollo)(U)},83194:(e,t,n)=>{"use strict";n.d(t,{k6:()=>s});var r=n(18719),i=function(e,t){return t.split(".").reduce((function(e,t){return e&&"undefined"!==e[t]?e[t]:void 0}),e)},o=function(e,t){var n=i(e,t);return n.exportValue&&(n=n.exportValue),"object"===(0,r.Z)(n)&&(n=i(e,t+"_text")),"string"==typeof n&&n.includes(",")&&(n='"'+n+'"'),n},s=function(e,t){var n;"csv"===t?n=function(e){var t=e.rows,n=e.columns,r=e.selectedEntities;if(t){var i=[n.map((function(e){return e.title})).join(",")];return i=i.concat((r||t).map((function(t){return e.columns.map((function(e){return e.noExport?"":o(t,e.key)})).join(",")}))),encodeURI("data:text/csv;charset=utf-8,"+i.join("\n"))}}(e):"json"===t&&(n=function(e){var t,n=e.rows,r=e.columns,i=e.selectedEntities;if(n)return t=(i||n).map((function(e){var t={};return r.forEach((function(n){var r=n.key.split("."),i=r[r.length-1];t[i]=o(e,n.key)})),t})),encodeURI("data:application/json;charset=utf-8,"+JSON.stringify(t))}(e)),function(e,t){if(e){var n=document.createElement("a");n.setAttribute("href",e),n.setAttribute("download",t),n.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}))}}(n,function(e){return"compliance-export-"+(new Date).toISOString()+"."+e}(t))}},33660:(e,t,n)=>{"use strict";n.d(t,{T4:()=>s,TU:()=>a,qN:()=>l});var r=n(94949);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var s=function(e){return e.flatMap((function(e){return e.rules&&e.rules.filter((function(e){return!e.compliant}))}))},a=function(e){return e.flatMap((function(e){return e.rules&&e.rules.filter((function(e){return e.compliant}))}))},c=function(e){return e.testResultProfiles?s(e.testResultProfiles):[]},l=function(e){return e.map((function(e){return o(o({},e),{},{ruleObjectsFailed:c(e),profiles:e.testResultProfiles})}))}},59088:(e,t,n)=>{"use strict";n.d(t,{xM:()=>r,pr:()=>i,k6:()=>o,td:()=>s,MO:()=>a});var r="@@COMPLIANCE/EXPORT",i="SELECT_ENTITY",o=function(e){return{type:r,payload:{format:e}}},s=function(){return{type:i,payload:{id:0,selected:!0}}},a=function(){return{type:i,payload:{id:0,selected:!1}}}},49690:(e,t,n)=>{"use strict";n.d(t,{ek:()=>T,rI:()=>P,B3:()=>Z,Q_:()=>A,zw:()=>M});var r=n(94949),i=n(67301),o=n(77865),s=n.n(o),a=n(18546),c=n(62410),l=n(334),u=n(59088),d=n(83194),p=n(37311),m=n(36801),f=n(33660),y=n(50500);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var v="Never",E=function(e){var t=e.testResultProfiles,n=(void 0===t?[]:t).map((function(e){return new Date(e.lastScanned)})),r=new Date(Math.max.apply(null,n.filter((function(e){return isFinite(e)}))));return r instanceof Date&&isFinite(r)?r:v},g=function(e){var t=e.testResultProfiles;return(void 0===t?[]:t).every((function(e){return e.lastScanned===v||!0===e.compliant}))},O=function(e){var t=e.testResultProfiles,n=void 0===t?[]:t,r=n.reduce((function(e,t){return e+t.score}),0),i=n.reduce((function(e,t){return(0,f.TU)([t]).length+(0,f.T4)([t]).length>0?e+1:e}),0);return i?r/i:0},I=function(e){var t=e.testResultProfiles;return(void 0===t?[]:t).reduce((function(e,t){return e&&t.supported}),!0)},S=function(e){if(e==={})return"";var t=e.policies.map((function(e){return e.name})),n=e.testResultProfiles.filter((function(e){return!e.policy})).map((function(e){var t=e.name;return"(External) ".concat(t)}));return[].concat((0,i.Z)(t),(0,i.Z)(n)).join(", ")},T=function(e){var t=e.policyNames;return{title:t?s().createElement(m.Tooltip,{content:t},s().createElement(y.Z,{lines:2,width:540},t)):s().createElement(m.Text,{className:"grey-icon"},"No policies"),exportValue:t}},P=function(e){if(e.testResultProfiles&&e.testResultProfiles.length>0)return{title:s().createElement(l.Link,{to:{pathname:"/systems/".concat(e.id)}},"View report")}},j=function(e){return void 0!==e.osMajorVersion&&void 0!==e.osMinorVersion&&null!==e.osMajorVersion&&null!==e.osMinorVersion&&!(0===e.osMajorVersion&&0===e.osMinorVersion)},w=function(e,t){return{title:s().createElement(m.TextContent,null,t.name?s().createElement(l.Link,{to:{pathname:"/systems/".concat(t.id)}},t.name):e.display_name,j(t)&&s().createElement(m.Text,{component:m.TextVariants.small},"RHEL ",t.osMajorVersion,".",t.osMinorVersion)),exportValue:e.display_name||t.name}},Z=function(e,t,n){var r=n.osMajorVersion,i=n.osMinorVersion,o=n.name;return s().createElement(m.TextContent,null,s().createElement(l.Link,{to:{pathname:"/systems/".concat(t)}},e||o),j({osMajorVersion:r,osMinorVersion:i})&&s().createElement(m.Text,{component:m.TextVariants.small},"RHEL ",r,".",i))},x=function(e,t){return!!(t||[]).find((function(t){return t.id===e}))},R=function(e){var t=e.testResultProfiles;return(void 0===t?[]:t).map((function(e){return e.ssgVersion})).filter((function(e){return!!e})).join(", ")},k=function(e,t,n,r){return t.map((function(t){void 0===t.facts&&(t.facts={});var i=e.map((function(e){return e.node})).find((function(e){return t.id===e.id}));if(void 0===i){if(!n)return;i={testResultProfiles:[],policies:[]}}return i.policyNames=S(i),i.rulesPassed=(0,f.TU)(i.testResultProfiles).length,i.rulesFailed=(0,f.T4)(i.testResultProfiles).length,i.lastScanned=E(i),i.compliant=g(i),i.score=O(i),i.supported=I(i),{id:t.id,selected:x(t.id,r),account:t.account,bios_uuid:t.bios_uuid,created:t.created,display_name:t.display_name||i.name,fqdn:t.fqdn,insights_id:t.insights_id,ip_addresses:t.ip_addresses,mac_addresses:t.mac_addresses,rhel_machine_id:t.rhel_machine_id,satellite_id:t.satellite_id,subscription_manager_id:t.subscription_manager_id,tags:t.tags,updated:t.updated,facts:{inventory:{hostname:void 0!==t.facts.inventory?t.facts.inventory.hostname:t.facts.hostname,machine_id:void 0!==t.facts.inventory?t.facts.inventory.machine_id:t.facts.machine_id,release:void 0!==t.facts.inventory?t.facts.inventory.release:t.facts.release},compliance:{display_name:w(t,i),policies:T(i),details_link:P(i),rules_passed:i.rulesPassed,rules_failed:{title:s().createElement(l.Link,{to:{pathname:"/systems/".concat(i.id),query:{hidePassed:!0}}},i.rulesFailed)},rules_failed_text:i.rulesFailed,compliance_score:(0,p.OF)(i),compliance_score_text:(0,p.Oq)(i),last_scanned:i.lastScanned instanceof Date?{title:s().createElement(c.Z,{date:Date.parse(i.lastScanned),type:"relative"})}:i.lastScanned,last_scanned_text:i.lastScanned,ssg_version:R(i),supported:i.supported}}}})).filter((function(e){return!!e}))},F=function(e){return e.map((function(e){var t=e.node;return b(b({},t),{},{policyNames:S({policies:null==t?void 0:t.policies,testResultProfiles:[]}),rulesPassed:(0,f.TU)(t.testResultProfiles).length,rulesFailed:(0,f.T4)(t.testResultProfiles).length,lastScanned:E(t),compliant:g(t),display_name:t.name,score:O(t),supported:I(t),ssgVersion:R(t),detailsLink:P(t)})}))},C=function(e,t){var n=e.rows.filter((function(n){return t.includes(n.id)&&!(e.selectedEntities||[]).map((function(e){return e.id})).includes(n.id)}));return b(b({},e),{},{selectedEntities:(e.selectedEntities||[]).concat(n)})},V=function(e,t){return b(b({},e),{},{selectedEntities:(e.selectedEntities||[]).filter((function(e){return!t.includes(e.id)}))})},_=function(e){return C(e,e.rows.map((function(e){return e.id})))},D=function(e){return V(e,e.rows.map((function(e){return e.id})))},L=function(e,t){return C(e,[t])},N=function(e,t){return V(e,[t])},A=function(e,t){var n;return(0,a.Gg)((n={},(0,r.Z)(n,"GET_SYSTEMS_PENDING",(function(e){return b(b({},e),{},{rows:[],systems:void 0,systemsCount:void 0,columns:t,loaded:!1})})),(0,r.Z)(n,"GET_SYSTEMS_FULFILLED",(function(e,n){var r=n.systems,i=n.systemsCount;return b(b({},e),{},{systems:r,systemsCount:i,total:i,rows:F(r).map((function(t){return b(b({},t),{},{selected:x(t.id,e.selectedEntities)})})),columns:t,loaded:!0})})),(0,r.Z)(n,e.LOAD_ENTITIES_PENDING,(function(e){return b(b({},e),{},{total:e.systemsCount,rows:void 0!==e.systems?F(e.systems).map((function(t){return b(b({},t),{},{selected:x(t.id,e.selectedEntities)})})):[],columns:t,loaded:void 0!==e.systemsCount})})),(0,r.Z)(n,e.LOAD_ENTITIES_FULFILLED,(function(e){return b(b({},e),{},{total:e.systemsCount,rows:void 0!==e.systems?F(e.systems).map((function(t){return b(b({},t),{},{selected:x(t.id,e.selectedEntities)})})):[],columns:t,loaded:void 0!==e.systemsCount})})),(0,r.Z)(n,u.pr,(function(e,t){var n,r=t.payload,i=r.id,o=r.selected,s=r.clearAll;return(0===(n=0===i?o?_(e):D(e):o?L(e,i):N(e,i)).selectedEntities.length||s)&&(n.selectedEntities=void 0),n})),(0,r.Z)(n,"SELECT_ENTITIES",(function(e,t){return{selectedEntities:t.payload.ids}})),n))},M=function(e,t,n){var i;return(0,a.Gg)((i={},(0,r.Z)(i,"UPDATE_SYSTEMS",(function(e,t){var n=t.systems,r=t.systemsCount;return b(b({},e),{},{systems:n,systemsCount:r})})),(0,r.Z)(i,"UPDATE_ROWS",(function(e){return b(b({},e),{},{loaded:!0,rows:k(e.systems||[],e.rows||[],n,e.selectedEntities)})})),(0,r.Z)(i,e.LOAD_ENTITIES_FULFILLED,(function(e){return b(b({},e),{},{rows:k(e.systems||[],e.rows,n,e.selectedEntities),total:n?e.total:e.systemsCount,columns:e.total>0?t:[{title:""}]})})),(0,r.Z)(i,u.xM,(function(e,t){var n=t.payload.format;return(0,d.k6)(e,n),e})),(0,r.Z)(i,u.pr,(function(e,t){var n,r=t.payload,i=r.id,o=r.selected,s=r.clearAll;return(0===(n=0===i?o?_(e):D(e):o?L(e,i):N(e,i)).selectedEntities.length||s)&&(n.selectedEntities=void 0),n})),(0,r.Z)(i,"SELECT_ENTITIES",(function(e,t){return{selectedEntities:t.payload.ids}})),i))}}}]);
//# sourceMappingURL=EditPolicy.ebcb410d88417ab31a6a.js.map