"use strict";(self.webpackChunkcompliance_frontend=self.webpackChunkcompliance_frontend||[]).push([[7242],{44434:(e,t,n)=>{n.r(t),n.d(t,{ComplianceSystems:()=>v,default:()=>h});var r,o=n(30168),i=n(92950),s=n.n(i),a=n(67521),c=n(90570),l=n(14040),u=n(80123),p=n(39173),d=n(14748),m=n(69073),f=n(87242),y=n(27803),b=n(31499),g=(0,a.ZP)(r||(r=(0,o.Z)(['\n  {\n    profiles(search: "external = false and canonical = false") {\n      edges {\n        node {\n          id\n          name\n          refId\n          osMajorVersion\n        }\n      }\n    }\n  }\n']))),v=function(){var e,t=(0,c.a)(g),n=t.data,r=t.error,o=t.loading,i=null==n||null===(e=n.profiles)||void 0===e?void 0:e.edges.map((function(e){return e.node}));return s().createElement(s().Fragment,null,s().createElement(u.Z,{className:"page-header"},s().createElement(p.Z,{title:"Compliance systems"})),s().createElement(d.Z,null,s().createElement(m.tC,{stateValues:{error:r,data:n,loading:o}},s().createElement(m.K7,{stateKey:"data"},i&&s().createElement(f.r0,{columns:[b.Zw({showLink:!0}),b.MO("tags"),b.OS,b.rE,b.MO("updated",{props:{isStatic:!0},transforms:[l.nowrap]})],query:y.Tk,defaultFilter:"has_test_results = true or has_policy = true",systemProps:{isFullView:!0},showOsMinorVersionFilter:i.map((function(e){return e.osMajorVersion})),showComplianceSystemsInfo:!0,enableEditPolicy:!1,remediationsEnabled:!1,policies:i})))))};const h=v},32369:(e,t,n)=>{n.r(t),n.d(t,{CreatePolicyForm:()=>xe,default:()=>ke});var r=n(4942),o=n(70885),i=n(92950),s=n.n(i),a=n(334),c=n(46314),l=n(33766),u=n(28216),p=n(45697),d=n.n(p),m=n(89624),f=n(30168),y=n(67521),b=n(90570),g=n(97481),v=n(15113),h=n(97779),O=n(69073),E=n(14040),j=n(57672),P=n(79886),S=n(83237),T=function(e){var t=e.item.description,n=e.key;return s().createElement(m.Text,{key:n,style:{margin:"var(--pf-global--spacer--lg) 0"}},t)};T.propTypes={item:d().object,key:d().string};const I=T;function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var R=function(e){var t=e.name,n=e.disabled;return s().createElement(s().Fragment,null,t," ",n&&s().createElement(O.Nj,{compact:!0}))};R.propTypes={name:d().string,disabled:d().boolean};var C=function(e){var t=e.profiles,n=e.onChange,r=e.selectedProfile;return s().createElement(j.v,{items:t.map((function(e){return V(V({},e),{},{rowProps:{selected:e.id===(null==r?void 0:r.id),disableSelection:e.disabled}})})),filters:{filterConfig:[{type:S.Y.text,label:"Policy Name",filter:function(e,t){return e.filter((function(e){return null==e?void 0:e.name.toLowerCase().includes(t.toLowerCase())}))}}]},columns:[{title:"Policy name",key:"name",sortByProp:"name",renderFunc:(0,P.SO)(R)},{title:"Supported OS versions",transforms:[E.fitContent],sortByProp:"supportedOsVersions",renderFunc:function(e,t,n){return n.supportedOsVersions.join(", ")}}],options:{detailsComponent:I,onRadioSelect:function(e,r,o,i){var s=i.itemId;return n&&n(t.find((function(e){return e.id===s})))},sortBy:{index:2,direction:"asc",property:"name"}},variant:"compact"})};C.propTypes={profiles:d().array,onChange:d().func,selectedProfile:d().string};const x=C;var M=n(91290);const Z=function(){return s().createElement(m.Tooltip,{position:"right",content:"Policy types are OpenSCAP policies that are supported by RHEL. For each major version of RHEL, users can create one policy of each type."},s().createElement(M.ZP,{className:"grey-icon"}))};var k;function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $=(0,y.ZP)(k||(k=(0,f.Z)(['\n  query supportedProfilesByOSMajor {\n    osMajorVersions {\n      edges {\n        node {\n          osMajorVersion\n          profiles {\n            id\n            name\n            refId\n            description\n            complianceThreshold\n            supportedOsVersions\n            benchmark {\n              id\n              refId\n              osMajorVersion\n            }\n          }\n        }\n      }\n    }\n    profiles(search: "external = false and canonical = false") {\n      edges {\n        node {\n          id\n          refId\n          benchmark {\n            refId\n          }\n        }\n      }\n    }\n  }\n']))),L=function(e){var t,n=e.change,r=e.selectedProfile,o=e.selectedOsMajorVersion,i=(0,b.a)($,{fetchPolicy:"no-cache"}),a=i.data,c=i.error,l=i.loading,u=null==a||null===(t=a.osMajorVersions)||void 0===t?void 0:t.edges.map((function(e){return e.node})),p=null==u?void 0:u.find((function(e){return e.osMajorVersion===o})),d=null==p?void 0:p.profiles.map((function(e){return F(F({},e),{},{disabled:(t=e.refId,n=e.benchmark.refId,!(null==a||null===(r=a.profiles)||void 0===r||!r.edges.map((function(e){return e.node})).find((function(e){return e.refId===t&&n===e.benchmark.refId}))))});var t,n,r}));return s().createElement(O.tC,{stateValues:{error:c,data:a,loading:l}},s().createElement(O.K7,{stateKey:"loading"},s().createElement(g.Z,null)),s().createElement(O.K7,{stateKey:"data"},s().createElement(m.TextContent,null,s().createElement(m.Text,{component:m.TextVariants.h1,className:"pf-u-mb-md"},"Create SCAP policy"),s().createElement(m.Text,{className:"pf-u-mb-md"},"Select the operating system and policy type for this policy.")),s().createElement(m.Form,null,s().createElement(m.FormGroup,{label:"Operating system",isRequired:!0,fieldId:"benchmark"},u&&u.map((function(e){var t=e.osMajorVersion;return s().createElement(m.Tile,{key:"rhel".concat(t,"-select"),className:"pf-u-mr-md",title:"RHEL ".concat(t),onClick:function(){n("osMajorVersion",t)},isSelected:o===t,isStacked:!0})}))),o&&s().createElement(m.FormGroup,{isRequired:!0,labelIcon:s().createElement(Z,null),label:"Policy type",fieldId:"policy-type"},s().createElement(x,{"aria-label":"PolicyTypeTable",profiles:d,onChange:function(e){n("profile",e),n("benchmark",e.benchmark.id),n("selectedRuleRefIds",void 0),n("systems",[])},selectedProfile:r})))))};L.propTypes={change:v.ZP.change,selectedProfile:d().object,selectedOsMajorVersion:d().string};var B=(0,l.Z)("policyForm");const N=(0,h.qC)((0,u.$j)((function(e){return{selectedProfile:B(e,"profile"),selectedOsMajorVersion:B(e,"osMajorVersion")}})),(0,c.Z)({form:"policyForm",destroyOnUnmount:!1,forceUnregisterOnUnmount:!0}))(L);var q,_,A=n(58247),K=n(10530),U=n(94263);function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var z=(0,y.ZP)(q||(q=(0,f.Z)(["\n  query Profiles($filter: String!) {\n    profiles(search: $filter) {\n      edges {\n        node {\n          id\n          name\n          refId\n          osMinorVersion\n          osMajorVersion\n          policy {\n            id\n          }\n          policyType\n          benchmark {\n            id\n            refId\n            latestSupportedOsMinorVersions\n            osMajorVersion\n          }\n          ssgVersion\n          rules {\n            id\n            title\n            severity\n            rationale\n            refId\n            description\n            remediationAvailable\n            identifier\n          }\n        }\n      }\n    }\n  }\n"]))),W=(0,y.ZP)(_||(_=(0,f.Z)(["\n  query Benchmarks($filter: String!) {\n    benchmarks(search: $filter) {\n      nodes {\n        id\n        latestSupportedOsMinorVersions\n        profiles {\n          id\n          refId\n          osMajorVersion\n          ssgVersion\n        }\n      }\n    }\n  }\n"]))),Y=function(e){var t,n=e.policy,r=e.selectedRuleRefIds,o=e.change,a=e.osMajorVersion,c=e.osMinorVersionCounts,l=[U.VG,U.zb,U.uH],u=c.map((function(e){return e.osMinorVersion})).sort(),p="os_major_version = ".concat(a," ")+'and latest_supported_os_minor_version ^ "'.concat(u.join(","),'"'),d=(0,b.a)(W,{variables:{filter:p},skip:0===u.length}),f=d.data,y=d.error,v=d.loading,h=null==f||null===(t=f.benchmarks)||void 0===t?void 0:t.nodes,E=c.map((function(e){var t,r=e.osMinorVersion,o=e.count;if(r="".concat(r),h){var i=function(e,t){return e.find((function(e){var n;return null===(n=e.latestSupportedOsMinorVersions)||void 0===n?void 0:n.includes(t)}))}(h,r);i&&(t=function(e,t){return e.profiles.find((function(e){return e.refId===t}))}(i,n.refId),t&&(t=G(G({},t),{},{benchmark:i})))}return{profile:t,systemCount:o,newOsMinorVersion:r}}));E=E.filter((function(e){return!!e.profile}));var j=(0,K.b4)(E),P=Object.keys(j),S=P.map((function(e){return"id = ".concat(e)})).join(" OR "),T=v||0===S.length,I=(0,b.a)(z,{variables:{filter:S},skip:T}),w=I.data,V=I.error,R=I.loading,C=y||V,x=(null==P?void 0:P.length)>0?w:void 0,M=!(!R&&!v)||void 0,Z=!C&&!M&&0===(null==P?void 0:P.length),k=T?[]:null==w?void 0:w.profiles.edges.map((function(e){return e.node})),D=function(e){o("selectedRuleRefIds",e)};return(0,i.useLayoutEffect)((function(){if(!M){var e=(0,K.uU)(k,j),t=(0,K.TB)(e,r,{only:!0});D(t)}}),[JSON.stringify(k),M]),s().createElement(s().Fragment,null,s().createElement(m.TextContent,{className:"pf-u-pb-md"},s().createElement(m.Text,{component:m.TextVariants.h1},"Rules"),s().createElement(m.Text,null,"Customize your ",s().createElement("b",null,n.name)," SCAP policy by including and excluding rules."),s().createElement(m.Text,null,"Each release of RHEL is supported with a unique and specific version of the SCAP Security Guide (SSG). You must customize each version of SSG for each release of RHEL.")),s().createElement(O.tC,{stateValues:{error:C,data:x,loading:M,noRuleSets:Z}},s().createElement(O.K7,{stateKey:"noRuleSets"},s().createElement(m.EmptyState,null,s().createElement(m.Title,{headingLevel:"h1",size:"xl"},"No rules can be configured"),s().createElement(m.EmptyStateBody,null,"The policy type selected does not exist for the systems and OS versions selected in the previous steps."))),s().createElement(O.K7,{stateKey:"loading"},s().createElement(A.Z,null,s().createElement(g.Z,null))),s().createElement(O.K7,{stateKey:"data"},s().createElement(K.Hv,{tabsData:E,selectedRuleRefIds:r,columns:l,remediationsEnabled:!1,selectedFilter:!0,level:1,setSelectedRuleRefIds:D,ouiaId:"RHELVersions"}))))};Y.propTypes={policy:d().object,change:v.ZP.change,osMajorVersion:d().string,osMinorVersionCounts:d().arrayOf(d().shape({osMinorVersion:d().number,count:d().number})),selectedRuleRefIds:d().array};var J=(0,l.Z)("policyForm");const Q=(0,h.qC)((0,u.$j)((function(e){return{policy:J(e,"profile"),osMajorVersion:J(e,"osMajorVersion"),osMinorVersionCounts:J(e,"osMinorVersionCounts"),selectedRuleRefIds:J(e,"selectedRuleRefIds")}})),(0,c.Z)({form:"policyForm",destroyOnUnmount:!1,forceUnregisterOnUnmount:!0}))(Y);var X=n(87242),ee=n(27803),te=n(99030),ne=n(31499);function re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?re(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):re(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ie=function(e){var t=e.osMajorVersion;return s().createElement(s().Fragment,null,s().createElement(m.TextContent,{className:"pf-u-mb-md"},s().createElement(m.Text,null,"You do not have any ",s().createElement("b",null,"RHEL ",t)," systems connected to Insights and enabled for Compliance.",s().createElement("br",null),"Policies must be created with at least one system.")),s().createElement(m.TextContent,{className:"pf-u-mb-md"},s().createElement(m.Text,null,"Choose a different operating system, or connect"," ",s().createElement("b",null,"RHEL ",t)," systems to Insights.")),s().createElement(m.WizardContextConsumer,null,(function(e){var t=e.goToStepById;return s().createElement(m.Button,{onClick:function(){return t(1)}},"Choose a different operating system")})))};ie.propTypes={osMajorVersion:d().string};var se=function(e){var t=e.osMajorVersion;return s().createElement(s().Fragment,null,s().createElement(m.TextContent,{className:"pf-u-mb-md"},s().createElement(m.Text,null,"Select which of your ",s().createElement("b",null,"RHEL ",t)," systems should be included in this policy.",s().createElement("br",null),"Systems can be added or removed at any time.")))};se.propTypes={osMajorVersion:d().string};var ae=function(e){var t=e.policy,n=e.change,r=e.osMajorVersion,o=e.selectedSystems,i=t.supportedOsVersions.map((function(e){return e.split(".")[1]}));return s().createElement(s().Fragment,null,s().createElement(m.TextContent,{className:"pf-u-mb-md"},s().createElement(m.Text,{component:m.TextVariants.h1},"Systems")),s().createElement(m.Form,null,s().createElement(m.FormGroup,null,s().createElement(X.r0,{showOsMinorVersionFilter:[r],prependComponent:s().createElement(se,{osMajorVersion:r}),emptyStateComponent:s().createElement(ie,{osMajorVersion:r}),columns:[oe(oe({},ne.VG),{},{props:{width:40},sortBy:["name"]}),ne.MO("tags"),ne.U5],remediationsEnabled:!1,compact:!0,showActions:!1,query:ee.Y0,defaultFilter:r&&"os_major_version = ".concat(r," AND os_minor_version ^ (").concat(i.join(","),")"),enableExport:!1,preselectedSystems:o,onSelect:function(e){n("systems",e),n("osMinorVersionCounts",(0,te.Nw)(e))}}))))};ae.propTypes={osMajorVersion:d().string,policy:d().object,selectedSystems:d().array,change:v.ZP.change},ae.defaultProps={selectedSystems:[]};var ce=(0,l.Z)("policyForm");const le=(0,h.qC)((0,u.$j)((function(e){return{policy:ce(e,"profile"),osMajorVersion:ce(e,"osMajorVersion"),selectedSystems:ce(e,"systems")}})),(0,c.Z)({form:"policyForm",destroyOnUnmount:!1,forceUnregisterOnUnmount:!0}))(ae);var ue=n(6455),pe=n(74726),de=function(e){var t=e.change,n=e.policy,r=e.refId;return(0,i.useEffect)((function(){n&&n.refId!==r&&(t("name","".concat(n.name)),t("refId","".concat(n.refId)),t("description","".concat(n.description)))}),[n]),s().createElement(s().Fragment,null,s().createElement(m.TextContent,null,s().createElement(m.Text,{component:m.TextVariants.h1},"Details")),s().createElement("br",null),s().createElement(m.Form,{id:"editpolicydetails"},s().createElement(m.FormGroup,{label:"Policy name",isRequired:!0,fieldId:"name"},s().createElement(ue.Z,{component:pe._,type:"text",isRequired:!0,id:"name",name:"name","aria-describedby":"name"})),s().createElement(m.FormGroup,{label:"Reference ID",isRequired:!0,fieldId:"refId"},s().createElement(ue.Z,{type:"text",component:pe._,isDisabled:!0,id:"refId",name:"refId","aria-describedby":"refId"})),s().createElement(m.FormGroup,{label:"Description",fieldId:"description"},s().createElement(ue.Z,{type:"text",component:pe.d,id:"description",name:"description","aria-describedby":"description"})),s().createElement(m.FormGroup,{label:"Business objective",labelIcon:s().createElement(O.xB,null),fieldId:"businessObjective"},s().createElement(ue.Z,{type:"text",component:pe._,id:"businessObjective",name:"businessObjective","aria-describedby":"businessObjective",defaultValue:n.businessObjective})),s().createElement(O._z,{previousThreshold:n.complianceThreshold})))},me=(0,l.Z)("policyForm");de.propTypes={policy:d().object,refId:d().string,change:v.ZP.change};const fe=(0,h.qC)((0,u.$j)((function(e){var t=me(e,"profile");return{policy:t,refId:me(e,"refId"),initialValues:{name:"".concat(t.name),refId:"".concat(t.refId),description:"".concat(t.description),benchmark:me(e,"benchmark"),osMajorVersion:me(e,"osMajorVersion"),profile:me(e,"profile")}}})),(0,c.Z)({form:"policyForm",destroyOnUnmount:!1,forceUnregisterOnUnmount:!0}))(de);var ye,be=(0,y.ZP)(ye||(ye=(0,f.Z)(["\n  query review($benchmarkId: String!) {\n    benchmark(id: $benchmarkId) {\n      id\n      osMajorVersion\n    }\n  }\n"]))),ge=function(e){var t=e.benchmarkId,n=e.name,r=e.businessObjective,o=e.complianceThreshold,i=e.parentProfileName,a=e.osMinorVersionCounts,c=(0,b.a)(be,{variables:{benchmarkId:t}}),l=c.data,u=c.error,p=c.loading;if(u)return u;if(p)return s().createElement(g.Z,null);var d=l.benchmark.osMajorVersion;return s().createElement(m.TextContent,null,s().createElement(m.Text,{component:m.TextVariants.h1},"Review"),s().createElement(m.Text,null,"Review your SCAP policy before finishing."),s().createElement(m.Text,{component:m.TextVariants.h3,style:{marginTop:0}},n),s().createElement(m.TextList,{component:m.TextListVariants.dl},s().createElement(m.TextListItem,{component:m.TextListItemVariants.dt},"Policy type"),s().createElement(m.TextListItem,{component:m.TextListItemVariants.dd},i),s().createElement(m.TextListItem,{component:m.TextListItemVariants.dt},"Compliance threshold"),s().createElement(m.TextListItem,{component:m.TextListItemVariants.dd},o,"%"),r&&s().createElement(s().Fragment,null,s().createElement(m.TextListItem,{component:m.TextListItemVariants.dt},"Business objective"),s().createElement(m.TextListItem,{component:m.TextListItemVariants.dd},r)),s().createElement(m.TextListItem,{component:m.TextListItemVariants.dt},"Systems"),s().createElement(m.TextListItem,{component:m.TextListItemVariants.dd},s().createElement(m.TextList,{component:m.TextListVariants.dl},a.map((function(e){var t=e.osMinorVersion,n=e.count;return s().createElement(s().Fragment,{key:t},s().createElement(m.TextListItem,{component:m.TextListItemVariants.dt,style:{fontWeight:"normal"}},"RHEL ",d,".",t),s().createElement(m.TextListItem,{component:m.TextListItemVariants.dd},n," ",n>1?"systems":"system"))}))))))};ge.propTypes={benchmarkId:d().string,refId:d().string,name:d().string,businessObjective:d().string,complianceThreshold:d().number,parentProfileName:d().string,osMinorVersionCounts:d().arrayOf(d().shape({osMinorVersion:d().number,count:d().number}))};var ve=(0,l.Z)("policyForm");const he=(0,u.$j)((function(e){return{benchmarkId:ve(e,"benchmark"),refId:ve(e,"refId"),name:ve(e,"name"),businessObjective:ve(e,"businessObjective"),osMinorVersionCounts:ve(e,"osMinorVersionCounts"),complianceThreshold:parseFloat(ve(e,"complianceThreshold"))||100,parentProfileName:ve(e,"profile").name,rulesCount:ve(e,"selectedRuleRefIds").length}}))(ge);var Oe=n(5913),Ee=n(19398),je=n(84351),Pe=n(65811),Se=function(e){var t=e.errors;return t&&Array.isArray(t)&&t.length>0?s().createElement(m.EmptyStateBody,{className:"wizard-failed-errors"},s().createElement(m.List,null,t.map((function(e){return s().createElement(m.ListItem,{key:e},e)})))):null};Se.propTypes={errors:d().array};var Te=function(e){var t=e.onWizardFinish,n=e.cloneFromProfileId,r=e.description,c=e.name,l=e.complianceThreshold,u=e.businessObjective,p=e.refId,d=e.benchmarkId,f=e.systems,y=e.selectedRuleRefIds,b=(0,i.useState)(0),g=(0,o.Z)(b,2),v=g[0],h=g[1],E=(0,i.useState)("This usually takes a minute or two."),j=(0,o.Z)(E,2),P=j[0],S=j[1],T=(0,i.useState)(null),I=(0,o.Z)(T,2),w=I[0],V=I[1],R=(0,i.useState)(!1),C=(0,o.Z)(R,2),x=C[0],M=C[1],Z=(0,je.a7)(),k=function(e){h(100*e)};return(0,i.useEffect)((function(){Z(null,{cloneFromProfileId:n,description:r,name:c,complianceThreshold:l,businessObjective:{title:u},refId:p,benchmarkId:d,hosts:f,selectedRuleRefIds:y},k).then((function(e){var t=e.id;h(100),S(),(0,Pe.q)({variant:"success",title:'Created policy "'.concat(c,'"'),autoDismiss:!0,description:s().createElement("span",null,"From the ",s().createElement("strong",null,"SCAP Policies")," list, open"," ",s().createElement(a.Link,{to:"/scappolicies/".concat(t)},c),".")})})).catch((function(e){var t,n,r;S(null===(t=e.networkError)||void 0===t?void 0:t.message),V(null===(n=e.networkError)||void 0===n||null===(r=n.result)||void 0===r?void 0:r.errors),M(!0),(0,Pe.q)({variant:"danger",title:"Error creating policy",description:e.message})}))}),[]),s().createElement(m.Bullseye,null,s().createElement(m.EmptyState,{variant:m.EmptyStateVariant.full},s().createElement(m.EmptyStateIcon,{icon:Oe.ZP}),s().createElement("br",null),s().createElement(m.Title,{headingLevel:"h1",size:"lg"},"Creating policy"),s().createElement(m.EmptyStateBody,null,s().createElement(O.ko,{percent:v,failed:x})),s().createElement(m.EmptyStateBody,{className:x&&"wizard-failed-message"},P),s().createElement(Se,{error:w}),s().createElement(m.EmptyStateSecondaryActions,null,(100===v||x)&&s().createElement(m.Button,{variant:"primary",ouiaId:"ReturnToAppButton",onClick:function(){t()}},x?"Back":"Return to application"))))};Te.propTypes={benchmarkId:d().string.isRequired,businessObjective:d().object,cloneFromProfileId:d().string.isRequired,refId:d().string.isRequired,name:d().string.isRequired,description:d().string,systems:d().array,complianceThreshold:d().number,onWizardFinish:d().func,selectedRuleRefIds:d().arrayOf(d().string).isRequired};var Ie=(0,l.Z)("policyForm");const we=(0,h.qC)((0,u.$j)((function(e){return{benchmarkId:Ie(e,"benchmark"),businessObjective:Ie(e,"businessObjective"),cloneFromProfileId:Ie(e,"profile").id,refId:Ie(e,"refId"),name:Ie(e,"name"),description:Ie(e,"description"),complianceThreshold:parseFloat(Ie(e,"complianceThreshold"))||100,systems:Ie(e,"systems"),selectedRuleRefIds:Ie(e,"selectedRuleRefIds")}})),(0,c.Z)({form:"policyForm",destroyOnUnmount:!0,forceUnregisterOnUnmount:!0}),Ee.C)(Te);var Ve=n(70597);function Re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Re(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var xe=function(e){var t=e.benchmark,n=e.osMajorVersion,r=e.complianceThreshold,c=e.name,l=e.profile,u=e.refId,p=e.selectedRuleRefIds,d=e.systemIds,f=e.reset,y=(0,a.useHistory)(),b=(0,i.useState)(1),g=(0,o.Z)(b,2),v=g[0],h=g[1],O=function(){var e=y.location;e.hash&&y.push(Ce(Ce({},e),{},{hash:""}))},E=function(){f(),y.push("/scappolicies")},j=[{id:1,name:"Create SCAP policy",component:s().createElement(N,null),enableNext:(0,Ve.$H)(t,n,l)},{id:2,name:"Details",component:s().createElement(fe,null),canJumpTo:v>=2,enableNext:(0,Ve.Ay)(c,u,r)},{id:3,name:"Systems",component:s().createElement(le,null),canJumpTo:v>=3,enableNext:(0,Ve.Qy)(d)},{id:4,name:"Rules",component:s().createElement(Q,null),canJumpTo:(null==d?void 0:d.length)>0&&v>=4,enableNext:(0,Ve.hT)(p)},{id:5,name:"Review",component:s().createElement(he,null),nextButtonText:"Finish",canJumpTo:(0,Ve.hT)(p)&&(null==d?void 0:d.length)>0&&v>=5},{id:6,name:"Finished",component:s().createElement(we,{onWizardFinish:E}),isFinishedStep:!0,canJumpTo:(null==d?void 0:d.length)>0&&v>=6}];return s().createElement(s().Fragment,null,s().createElement(m.Wizard,{className:"compliance",isOpen:!0,onNext:function(e){var t=e.id;h(v<t?t:v),O()},onGoToStep:O,onBack:O,onClose:E,title:"Create SCAP policy",description:"Create a new policy for managing SCAP compliance",steps:j}))};xe.propTypes={benchmark:d().string,osMajorVersion:d().string,osMinorVersionCounts:d().arrayOf(d().shape({osMinorVersion:d().number,count:d().number})),complianceThreshold:d().string,businessObjective:d().object,dispatch:d().func,isOpen:d().bool,name:d().string,onWizardFinish:d().func,profile:d().string,refId:d().string,selectedRuleRefIds:d().arrayOf(d().string),systemIds:d().arrayOf(d().string),reset:d().func},xe.defaultProps={isOpen:!1};var Me=(0,c.Z)({form:"policyForm"})(xe),Ze=(0,l.Z)("policyForm");const ke=(0,u.$j)((function(e){return{benchmark:Ze(e,"benchmark"),osMajorVersion:Ze(e,"osMajorVersion"),osMinorVersionCounts:Ze(e,"osMinorVersionCounts"),businessObjective:Ze(e,"businessObjective"),complianceThreshold:Ze(e,"complianceThreshold")||100,name:Ze(e,"name"),profile:Ze(e,"profile"),refId:Ze(e,"refId"),selectedRuleRefIds:Ze(e,"selectedRuleRefIds"),systemIds:Ze(e,"systems")}}))(Me)},57481:(e,t,n)=>{n.r(t),n.d(t,{default:()=>b});var r=n(70885),o=n(89624),i=n(45697),s=n.n(i),a=n(92950),c=n.n(a),l=n(334),u=n(45442),p=n(84351),d=n(83215),m=n(69073),f=n(65811),y=function(){var e,t=(0,l.useHistory)(),n=(0,l.useLocation)(),i=(null===(e=n.state)||void 0===e?void 0:e.profile).id,s=function(){t.push(n.state.background)},a=(0,u.D)(p._M,{onCompleted:function(){(0,f.C)((0,d.wN)({variant:"success",title:"Report deleted",description:"Systems associated with this policy will upload reports on the next check-in."})),t.push("/reports")},onError:function(e){(0,f.C)((0,d.wN)({variant:"danger",title:"Error removing report",description:e.message})),s()}}),y=(0,r.Z)(a,1)[0];return c().createElement(m.C,{isOpen:!0,variant:o.ModalVariant.small,title:"Delete report",ouiaId:"DeleteReportModal",onClose:s,actions:[c().createElement(o.Button,{key:"destroy",ouiaId:"DeleteReportButton","aria-label":"delete",variant:"danger",onClick:function(){return y({variables:{input:{profileId:i}}})}},"Delete report"),c().createElement(o.Button,{key:"cancel",ouiaId:"DeleteReportCancelButton",variant:"secondary",onClick:function(){return s()}},"Cancel")]},c().createElement(o.TextContent,null,"Deleting a report is permanent and cannot be undone."))};y.propTypes={onClose:s().func,isModalOpen:s().bool,onDelete:s().func,policyId:s().string},y.defaultProps={onDelete:function(){},onClose:function(){}};const b=y},38879:(e,t,n)=>{n.r(t),n.d(t,{EditPolicy:()=>re,MULTIVERSION_QUERY:()=>ne,default:()=>oe});var r=n(4942),o=n(70885),i=n(30168),s=n(92950),a=n.n(s),c=n(45697),l=n.n(c),u=n(334),p=n(67521),d=n(90570),m=n(89624),f=n(7648),y=n(69073),b=n(70597);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h=function(e){var t,n=e.policy,r=e.updatedPolicy,i=e.setUpdatedPolicy,c=function(){var e=(0,s.useState)(!0),t=(0,o.Z)(e,2),n=t[0],r=t[1];return[n,function(e){var t=(0,b.KJ)(e);return r(t),t}]}(),l=(0,o.Z)(c,2),u=l[0],p=l[1];return a().createElement("div",{className:"pf-c-form"},a().createElement(m.FormGroup,{label:"Policy description",isRequired:!0,fieldId:"description"},a().createElement(m.TextArea,{style:{width:800,height:110},isRequired:!0,type:"text",id:"description",name:"description","aria-describedby":"description",defaultValue:n.description,onChange:function(e){i((function(t){return v(v({},t),{},{description:e})}))}})),a().createElement(m.FormGroup,{label:"Business objective",labelIcon:a().createElement(y.xB,null),fieldId:"business-objective"},a().createElement(m.TextInput,{type:"text",style:{width:300},id:"business-objective",name:"business-objective","aria-describedby":"business-objective",defaultValue:null==n||null===(t=n.businessObjective)||void 0===t?void 0:t.title,onChange:function(e){i((function(t){return v(v({},t),{},{businessObjective:v(v({},t.businessObjective),{},{title:e})})}))}})),a().createElement(m.FormGroup,{validated:u?"default":"error",label:"Compliance threshold (%)",labelIcon:a().createElement(y.w8,null),fieldId:"policy-threshold",helperTextInvalid:a().createElement(y.C$,{threshold:r?r.complianceThreshold:n.complianceThreshold}),helperText:"A value of 95% or higher is recommended"},a().createElement(m.TextInput,{type:"number",style:{width:150},name:"compliance-threshold",id:"compliance-threshold",defaultValue:n.complianceThreshold,"aria-describedby":"policy-threshold",onChange:function(e){i((function(t){return v(v({},t),{},{complianceThreshold:parseFloat(e),complianceThresholdValid:p(e)})}))}})))};h.propTypes={policy:l().shape({description:l().string,businessObjective:l().object,complianceThreshold:l().oneOfType([l().string,l().number])}),updatedPolicy:l().shape({description:l().string,businessObjective:l().object,complianceThreshold:l().number}),setUpdatedPolicy:l().func};const O=h;var E,j,P=n(58247),S=n(97481),T=n(10530),I=n(79886),w=n(94263);function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var C=(0,p.ZP)(E||(E=(0,i.Z)(["\n  query Profiles($filter: String!) {\n    profiles(search: $filter) {\n      edges {\n        node {\n          id\n          name\n          refId\n          osMinorVersion\n          osMajorVersion\n          policy {\n            id\n          }\n          policyType\n          benchmark {\n            id\n            refId\n            latestSupportedOsMinorVersions\n            osMajorVersion\n          }\n          ssgVersion\n          rules {\n            id\n            title\n            severity\n            rationale\n            refId\n            description\n            remediationAvailable\n            identifier\n          }\n        }\n      }\n    }\n  }\n"]))),x=(0,p.ZP)(j||(j=(0,i.Z)(["\n  query Benchmarks($filter: String!) {\n    benchmarks(search: $filter) {\n      nodes {\n        id\n        latestSupportedOsMinorVersions\n        profiles {\n          id\n          refId\n          ssgVersion\n        }\n      }\n    }\n  }\n"]))),M=function(){return a().createElement(m.EmptyState,null,a().createElement(m.Title,{headingLevel:"h5",size:"lg"},"No rules can be configured"),a().createElement(m.EmptyStateBody,null,"This policy has no associated systems, and therefore no rules can be configured."),a().createElement(m.EmptyStateBody,null,"Add at least one system to configure rules for this policy."))},Z=function(e){var t,n=e.policy,r=e.selectedRuleRefIds,o=e.setSelectedRuleRefIds,i=e.osMinorVersionCounts,c=e.setNewRuleTabs,l=null==n?void 0:n.osMajorVersion,u=Object.keys(i).sort(),p="os_major_version = ".concat(l," ")+'and latest_supported_os_minor_version ^ "'.concat(u.join(","),'"'),f=(0,d.a)(x,{variables:{filter:p},skip:0===u.length}),b=f.data,g=f.error,v=f.loading,h=null==b||null===(t=b.benchmarks)||void 0===t?void 0:t.nodes,O=function(e,t,n){return Object.values(t).sort((0,I.Sj)("osMinorVersion","desc")).map((function(t){var r=t.osMinorVersion,o=t.count;r="".concat(r);var i=e.policy.profiles.find((function(e){return e.osMinorVersion===r})),s=e.osMajorVersion;if(!i&&n){var a=function(e,t){return e.find((function(e){var n;return null===(n=e.latestSupportedOsMinorVersions)||void 0===n?void 0:n.includes(t)}))}(n,r);if(a){var c=function(e,t){return e.profiles.find((function(e){return e.refId===t}))}(a,e.refId);c&&(i=e.policy.profiles.find((function(e){return e.parentProfileId===c.id&&e.osMinorVersion===r})),i=R(R({},c),{},{benchmark:a,osMajorVersion:s},i))}}return{profile:i,systemCount:o,newOsMinorVersion:r}})).filter((function(e){var t=e.profile,n=e.newOsMinorVersion;return!!t&&n}))}(n,i,h),E=(0,T.b4)(O),j=Object.keys(E).map((function(e){return"id = ".concat(e)})).join(" OR "),V=(0,d.a)(C,{variables:{filter:j},skip:0===j.length}),Z=V.data,k=V.error,D=!(!V.loading&&!v)||void 0,F=!D&&(null==O?void 0:O.length)>0?Z:void 0;D||c(!!O.find((function(e){return n.policy.profiles.find((function(t){return t.osMinorVersion!==e.newOsMinorVersion}))}))),(0,s.useLayoutEffect)((function(){if(Z){var e=(null==Z?void 0:Z.profiles.edges.map((function(e){return e.node})))||[],t=(0,T.uU)(e,E);o((function(e){return(0,T.TB)(t,e)}))}}),[Z]);var $=g||k;return a().createElement(y.tC,{stateValues:{error:$,data:!$&&F,loading:D,empty:!D&&!F&&!$}},a().createElement(y.K7,{stateKey:"loading"},a().createElement(P.Z,null,a().createElement(S.Z,null))),a().createElement(y.K7,{stateKey:"data"},a().createElement(m.TextContent,null,a().createElement(m.Text,null,"Different release versions of RHEL are associated with different versions of the SCAP Security Guide (SSG), therefore each release must be customized independently.")),a().createElement(T.Hv,{columns:[w.VG,w.zb,w.uH],tabsData:O,selectedRuleRefIds:r,setSelectedRuleRefIds:o,remediationsEnabled:!1,selectedFilter:!0,level:1,ouiaId:"RHELVersions"})),a().createElement(y.K7,{stateKey:"empty"},a().createElement(M,null)))};Z.propTypes={setNewRuleTabs:l().func,policy:l().object,osMinorVersionCounts:l().shape({osMinorVersion:l().shape({osMinorVersion:l().number,count:l().number})}),selectedRuleRefIds:l().array,setSelectedRuleRefIds:l().func};const k=Z;var D=n(87242),F=n(27803),$=n(31499);function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var N=function(e){var t=e.osMajorVersion;return a().createElement(a().Fragment,null,a().createElement(m.TextContent,{className:"pf-u-mb-md"},a().createElement(m.Text,null,"You do not have any ",a().createElement("b",null,"RHEL ",t)," systems connected to Insights and enabled for Compliance.")),a().createElement(m.TextContent,{className:"pf-u-mb-md"},a().createElement(m.Text,null,"Connect RHEL ",t," systems to Insights.")))};N.propTypes={osMajorVersion:l().string};var q=function(e){var t=e.osMajorVersion;return a().createElement(a().Fragment,null,a().createElement(m.TextContent,{className:"pf-u-mb-md"},a().createElement(m.Text,null,"Select which of your ",a().createElement("b",null,"RHEL ",t)," systems should be included in this policy.")))};q.propTypes={osMajorVersion:l().string};var _=function(e){var t=e.policy,n=e.newRuleTabs,r=e.onSystemSelect,o=e.selectedSystems,i=(0,u.useHistory)(),s=i.push,c=i.location,l=t.id,p=t.osMajorVersion,d=t.supportedOsVersions.map((function(e){return e.split(".")[1]})),f=p&&"os_major_version = ".concat(p," AND os_minor_version ^ (").concat(d.join(","),")"),y=f?"".concat(f," or policy_id = ").concat(l):"policy_id = ".concat(l);return a().createElement(a().Fragment,null,a().createElement(D.r0,{columns:[$.VG,$.MO("tags"),$.U5],showOsMinorVersionFilter:[p],prependComponent:a().createElement(q,{osMajorVersion:p}),emptyStateComponent:a().createElement(N,{osMajorVersion:p}),compact:!0,showActions:!1,query:F.Y0,defaultFilter:y,enableExport:!1,remediationsEnabled:!1,preselectedSystems:o,onSelect:r}),n&&a().createElement(m.Alert,{variant:"info",isInline:!0,title:"You selected a system that has a release version previously not included in this policy.",actionLinks:a().createElement(m.AlertActionLink,{onClick:function(){return s(B(B({},c),{},{hash:"#rules"}))}},"Open rule editing")},a().createElement("p",null,"If you have edited any rules for this policy, you will need to do so for this release version as well.")))};_.propTypes={policy:l().object,newRuleTabs:l().bool,onSystemSelect:l().func,selectedSystems:l().array};const A=_;var K=n(99030);function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var G=function(e){var t,n=e.policy,r=e.updatedPolicy,i=e.setUpdatedPolicy,c=e.selectedRuleRefIds,l=e.setSelectedRuleRefIds,u=e.selectedSystems,p=e.setSelectedSystems,d=(null==n||null===(t=n.policy)||void 0===t?void 0:t.profiles)||[],f=(0,s.useState)({}),g=(0,o.Z)(f,2),v=g[0],h=g[1],E=(0,s.useState)(!1),j=(0,o.Z)(E,2),P=j[0],S=j[1],I=function(e){var t;p(e),h((t=e,(d||[]).reduce((function(e,t){var n;return""!==t.osMinorVersion&&(e[n=t.osMinorVersion]||(e[n]={osMinorVersion:t.osMinorVersion,count:0})),e}),(0,K.UP)(t||[]))))};return(0,s.useEffect)((function(){if(n){var e=(0,b.KJ)(n.complianceThreshold);i(H(H({},n),{},{complianceThresholdValid:e})),function(){if(n){var e=d.filter((function(e){return!!e.osMinorVersion}));l((0,T.TB)(e))}}(),I(n.hosts)}}),[n]),a().createElement(m.Form,null,a().createElement(y.tn,{ouiaId:"EditPolicy",defaultTab:"details"},a().createElement(m.Tab,{eventKey:"details",ouiaId:"Details",title:a().createElement(m.TabTitleText,null,"Details")},a().createElement(O,{policy:n,updatedPolicy:r,setUpdatedPolicy:i})),a().createElement(m.Tab,{eventKey:"rules",ouiaId:"Rules",title:a().createElement(m.TabTitleText,null,"Rules")},a().createElement(k,{policy:n,setNewRuleTabs:S,setSelectedRuleRefIds:l,selectedRuleRefIds:c,osMinorVersionCounts:v})),a().createElement(m.Tab,{eventKey:"systems",ouiaId:"Systems",title:a().createElement(m.TabTitleText,null,"Systems")},a().createElement(A,{policy:n,newRuleTabs:P,selectedSystems:u,onSystemSelect:I}))))};G.propTypes={policy:l().object,updatedPolicy:l().object,setUpdatedPolicy:l().func,selectedRuleRefIds:l().arrayOf(l().object),setSelectedRuleRefIds:l().func,setSelectedSystems:l().func,selectedSystems:l().array};const z=G;var W,Y=n(84351),J=n(52710),Q=n(65811),X=function(){var e=(0,J.Wb)(),t=(0,J.C3)("/scappolicies");return function(){t({hash:e})}};function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ne=(0,p.ZP)(W||(W=(0,i.Z)(["\n  query Profile($policyId: String!) {\n    profile(id: $policyId) {\n      id\n      name\n      refId\n      external\n      description\n      totalHostCount\n      compliantHostCount\n      complianceThreshold\n      osMajorVersion\n      osMajorVersion\n      supportedOsVersions\n      lastScanned\n      policyType\n      policy {\n        id\n        name\n        refId\n        profiles {\n          id\n          ssgVersion\n          parentProfileId\n          name\n          refId\n          osMinorVersion\n          osMajorVersion\n          benchmark {\n            id\n            title\n            latestSupportedOsMinorVersions\n            osMajorVersion\n          }\n          rules {\n            title\n            severity\n            rationale\n            refId\n            description\n            remediationAvailable\n            identifier\n          }\n        }\n      }\n      businessObjective {\n        id\n        title\n      }\n      hosts {\n        id\n        osMinorVersion\n        osMajorVersion\n      }\n    }\n  }\n"]))),re=function(e){var t=e.route,n=(0,u.useParams)().policy_id,r=(0,d.a)(ne,{variables:{policyId:n}}),i=r.data,c=r.loading,l=r.error,p=null==i?void 0:i.profile,b=X(),g=(0,s.useState)(null),v=(0,o.Z)(g,2),h=v[0],O=v[1],E=(0,s.useState)([]),j=(0,o.Z)(E,2),P=j[0],S=j[1],T=(0,s.useState)([]),I=(0,o.Z)(T,2),w=I[0],V=I[1],R=h&&!h.complianceThresholdValid,C=function(e,t){var n=(0,Y.a7)(),r=X(),i=(0,s.useState)(!1),a=(0,o.Z)(i,2),c=a[0],l=a[1];return[c,function(){if(c)return Promise.resolve({});l(!0),n(e,t).then((function(){l(!1),(0,Q.q)({variant:"success",title:"Policy updated",autoDismiss:!0}),r()})).catch((function(e){l(!1),(0,Q.q)({variant:"danger",title:"Error updating policy",description:e.message}),r()}))}]}(p,te(te({},h),{},{selectedRuleRefIds:P,hosts:w})),x=(0,o.Z)(C,2),M=x[0],Z=x[1],k=[a().createElement(m.Button,{isDisabled:R,key:"save",ouiaId:"EditPolicySaveButton",variant:"primary",spinnerAriaValueText:"Saving",isLoading:M,onClick:Z},"Save"),a().createElement(m.Button,{key:"cancel",ouiaId:"EditPolicyCancelButton",variant:"link",onClick:function(){return b()}},"Cancel")];return(0,f.a)(t,null==p?void 0:p.name),a().createElement(y.C,{isOpen:!0,position:"top",style:{minHeight:"350px"},variant:"large",ouiaId:"EditPolicyModal",title:"Edit ".concat(p?p.name:""),onClose:function(){return b()},actions:k},a().createElement(y.tC,{stateValues:{policy:p,loading:c,error:l}},a().createElement(y.K7,{stateKey:"loading"},a().createElement(m.Spinner,null)),a().createElement(y.K7,{stateKey:"policy"},a().createElement(z,{policy:p,updatedPolicy:h,setUpdatedPolicy:O,selectedRuleRefIds:P,setSelectedRuleRefIds:S,selectedSystems:w,setSelectedSystems:V}))))};re.propTypes={route:l().object};const oe=re},31499:(e,t,n)=>{n.d(t,{OF:()=>_,ll:()=>q,Hc:()=>A,VG:()=>$,OS:()=>U,U5:()=>K,rE:()=>N,hN:()=>B,Zw:()=>L,MO:()=>H});var r=n(4942),o=n(45987),i=n(92950),s=n.n(i),a=n(14040),c=n(89624),l=n(69073),u=n(82176),p=n(79886),d=n(87462),m=n(45697),f=n.n(m),y=n(334),b=n(69957),g=n(62410),v=n(19535),h=function(e){var t=e.id,n=e.children;return s().createElement(y.Link,{to:{pathname:"/systems/".concat(t)}},n)};h.propTypes={id:f().string,children:f().node};var O=function(e){var t=e.id,n=e.name,r=e.osMajorVersion,o=e.osMinorVersion,i=e.showOsInfo,a=void 0!==i&&i,l=e.showLink,u=void 0!==l&&l;return s().createElement(c.TextContent,null,u?s().createElement(h,{id:t},n):n,function(e,t){return!!e&&!!t&&a}(r,o)&&s().createElement(c.Text,{component:c.TextVariants.small},"RHEL ",r,".",o))};O.propTypes={id:f().string,name:f().string,osMajorVersion:f().string,osMinorVersion:f().string,showOsInfo:f().bool,showLink:f().bool};var E=function(e){var t=e.ssgVersion,n=void 0===t?"Not available":t;return e.supported?n:s().createElement(l.cT,{messageVariant:"singular"},n)};E.propTypes={supported:f().bool,ssgVersion:f().string};var j=function(e){var t=e.testResultProfiles,n=void 0===t?[]:t;return 0!==n.length?n.map((function(e){return s().createElement(E,(0,d.Z)({key:"ssgversion-".concat(e.id)},e))})):"Unknown"};j.propTypes={testResultProfiles:f().array};var P=function(e){var t=e.id,n=e.testResultProfiles;return(void 0===n?[]:n).length>0?s().createElement(h,{id:t},"View Report"):""};P.propTypes={id:f().string,testResultProfiles:f().array};var S=function(e){var t=e.policies;return(t||[]).length>0&&s().createElement(v.Z,{inline:!0,text:t.map((function(e){return e.name})).join(", "),length:215})};S.propTypes={policies:f().array};var T=function(e){var t=e.id,n=e.testResultProfiles,r=(0,u.T4)(n).length;return s().createElement(h,{id:t},n.length>0?r:"N/A")};T.propTypes={id:f().string,testResultProfiles:f().array};var I=function(e){var t=e.testResultProfiles;return t.length>0?(0,l.OF)((0,u.RT)(t)):"N/A"};I.propTypes={testResultProfiles:f().array};var w=function(){return s().createElement(c.Tooltip,{position:"right",content:s().createElement(i.Fragment,null,"This system has never returned a report for this policy. This may be because it is disconnected, or the insights-client on this system is not configured to use Compliance.")},s().createElement(b.ZP,{color:"var(--pf-global--warning-color--100)"})," "+u.C4)},V=function(e){var t=e.map((function(e){return new Date(e.lastScanned)})),n=new Date(Math.max.apply(null,t.filter((function(e){return isFinite(e)}))));return n instanceof Date&&isFinite(n)?n:s().createElement(w,null)},R=function(e){var t=e.testResultProfiles,n=V(t||[]);return n instanceof Date?s().createElement(g.Z,{date:Date.parse(n),type:"relative"}):n};R.propTypes={testResultProfiles:f().array};var C=function(e){var t=e.osMinorVersion,n=e.osMajorVersion;return"RHEL ".concat(n,".").concat(t)},x=function(e){return C(e)},M=["cell"];function Z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var D={isStatic:!0},F=function(e){var t=e.cell,n=(0,o.Z)(e,M);return k(k({},n),{},{renderFunc:(0,p.SO)(t,n.props)})},$=F({key:"name",title:"Name",sortBy:["name"],props:{width:40},renderExport:function(e){return"".concat(e.name," (").concat(C(e),")")},cell:O}),L=function(e){return k(k({},$),{},{props:k(k({},$.props),e),renderFunc:(0,p.SO)(O,e)})},B={title:"SSG version",transforms:[a.nowrap],exportKey:"testResultProfiles",sortBy:["ssg_version"],key:"ssg_version",renderExport:function(e){return e.map((function(e){var t=e.supported,n=e.ssgVersion;return"".concat(t?"":"!").concat(n)})).join(", ")},renderFunc:(0,p.SO)(j)},N={title:"Policies",transforms:[a.nowrap],exportKey:"policies",renderExport:function(e){return e.map((function(e){return e.name})).join(", ")},props:k({width:40},D),renderFunc:(0,p.SO)(S)},q=(k({width:20},D),(0,p.SO)(P),{title:"Failed rules",exportKey:"testResultProfiles",transforms:[a.nowrap],props:k({width:5},D),renderExport:function(e){return(0,u.T4)(e).length},renderFunc:(0,p.SO)(T)}),_={title:"Compliance score",exportKey:"testResultProfiles",transforms:[a.nowrap],props:k({width:5},D),renderExport:function(e){return(0,l.Oq)((0,u.RT)(e)).trim()},renderFunc:(0,p.SO)(I)},A={title:"Last scanned",transforms:[a.nowrap],exportKey:"testResultProfiles",props:k({width:10},D),renderExport:function(e){return V(e)},renderFunc:(0,p.SO)(R)},K=F({title:"Operating system",key:"operatingSystem",sortBy:["osMajorVersion","osMinorVersion"],transforms:[a.nowrap],renderExport:function(e){return C(e)},cell:x}),U=F({title:s().createElement(c.Tooltip,{content:s().createElement("span",null,"Operating System")},s().createElement("span",null,"OS")),original:"Operating System",key:"operatingSystem",dataLabel:"OS",transforms:[a.nowrap],sortBy:["osMajorVersion","osMinorVersion"],props:{width:10},renderExport:function(e){return C(e)},cell:x}),H=function(e,t){return k({key:e},t)}},27803:(e,t,n)=>{n.d(t,{Tk:()=>v,Ep:()=>h,Y0:()=>O,D3:()=>E,B1:()=>j,u5:()=>P,UD:()=>S,F4:()=>T,B4:()=>I,tn:()=>w});var r,o,i,s,a,c,l=n(4942),u=n(42982),p=n(30168),d=n(67521),m=(n(35937),n(72971)),f=n(67336),y=n(83237),b=n(99030);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var v=(0,d.ZP)(r||(r=(0,p.Z)(["\n  query getSystems(\n    $filter: String!\n    $policyId: ID\n    $perPage: Int\n    $page: Int\n    $sortBy: [String!]\n    $tags: [String!]\n  ) {\n    systems(\n      search: $filter\n      limit: $perPage\n      offset: $page\n      sortBy: $sortBy\n      tags: $tags\n    ) {\n      totalCount\n      edges {\n        node {\n          id\n          name\n          osMajorVersion\n          osMinorVersion\n          culledTimestamp\n          staleWarningTimestamp\n          staleTimestamp\n          insightsId\n          updated\n          policies(policyId: $policyId) {\n            id\n            name\n          }\n          tags {\n            namespace\n            key\n            value\n          }\n        }\n      }\n    }\n  }\n"]))),h=(0,d.ZP)(o||(o=(0,p.Z)(["\n  query getSystems(\n    $filter: String!\n    $policyId: ID\n    $perPage: Int\n    $page: Int\n    $sortBy: [String!]\n    $tags: [String!]\n  ) {\n    systems(\n      search: $filter\n      limit: $perPage\n      offset: $page\n      sortBy: $sortBy\n      tags: $tags\n    ) {\n      totalCount\n      edges {\n        node {\n          id\n          name\n          osMajorVersion\n          osMinorVersion\n          culledTimestamp\n          staleWarningTimestamp\n          staleTimestamp\n          insightsId\n          lastScanned\n          updated\n          testResultProfiles(policyId: $policyId) {\n            id\n            name\n            refId\n            lastScanned\n            compliant\n            external\n            score\n            supported\n            ssgVersion\n            osMajorVersion\n            rules {\n              refId\n              title\n              compliant\n              remediationAvailable\n              precedence\n            }\n          }\n          policies(policyId: $policyId) {\n            id\n            name\n          }\n          tags {\n            namespace\n            key\n            value\n          }\n        }\n      }\n    }\n  }\n"]))),O=(0,d.ZP)(i||(i=(0,p.Z)(["\n  query getSystems(\n    $filter: String!\n    $policyId: ID\n    $perPage: Int\n    $page: Int\n    $sortBy: [String!]\n    $tags: [String!]\n  ) {\n    systems(\n      search: $filter\n      limit: $perPage\n      offset: $page\n      sortBy: $sortBy\n      tags: $tags\n    ) {\n      totalCount\n      edges {\n        node {\n          id\n          name\n          osMajorVersion\n          osMinorVersion\n          culledTimestamp\n          staleWarningTimestamp\n          staleTimestamp\n          insightsId\n          lastScanned\n          updated\n          testResultProfiles(policyId: $policyId) {\n            id\n            name\n            lastScanned\n            external\n            compliant\n            score\n            supported\n            ssgVersion\n            policy {\n              id\n            }\n          }\n          policies(policyId: $policyId) {\n            id\n            name\n          }\n          tags {\n            namespace\n            key\n            value\n          }\n        }\n      }\n    }\n  }\n"]))),E=(0,d.ZP)(s||(s=(0,p.Z)(["\n  query getSystems(\n    $filter: String!\n    $perPage: Int\n    $page: Int\n    $sortBy: [String!]\n    $tags: [String!]\n  ) {\n    systems(\n      search: $filter\n      limit: $perPage\n      offset: $page\n      sortBy: $sortBy\n      tags: $tags\n    ) {\n      totalCount\n      edges {\n        node {\n          id\n          name\n          osMajorVersion\n          osMinorVersion\n          culledTimestamp\n          staleWarningTimestamp\n          staleTimestamp\n          insightsId\n          lastScanned\n          updated\n        }\n      }\n    }\n  }\n"]))),j=(0,d.ZP)(a||(a=(0,p.Z)(["\n  query getSystems($filter: String!, $limit: Int) {\n    systems(search: $filter, limit: $limit) {\n      tags {\n        namespace\n        key\n        value\n      }\n    }\n  }\n"]))),P=(0,d.ZP)(c||(c=(0,p.Z)(["\n  query getSystems($filter: String!) {\n    systems(search: $filter) {\n      osVersions {\n        name\n        major\n        minor\n      }\n    }\n  }\n"]))),S=function(e,t){return[].concat((0,u.Z)((0,m.RM)(e)),(0,u.Z)(t?(0,m.iz)(e):[]))},T=function(){return m.n3.apply(void 0,arguments)},I=function(e){return function(t){var n=t.INVENTORY_ACTION_TYPES,r=t.mergeWithEntities;return(0,f.JH)().register(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r((0,b.zw)(n,e))))}},w=function(e){return[{type:y.Y.checkbox,label:"SSG Version",filterString:function(e){return"ssg_version = ".concat(e)},items:e.map((function(e){return{label:e,value:e}}))}]}},87242:(e,t,n)=>{n.d(t,{Ey:()=>O,r0:()=>oe}),n(44434);var r,o=n(4942),i=n(15671),s=n(43144),a=n(60136),c=n(82963),l=n(61120),u=n(92950),p=n.n(u),d=n(45697),m=n.n(d),f=n(35664),y=n(67336),b=n(38775),g=n(6363);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var h=(0,y.gu)()(r=function(e){(0,a.Z)(u,e);var t,n,r=(t=u,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,l.Z)(t);if(n){var o=(0,l.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,c.Z)(this,e)});function u(e){return(0,i.Z)(this,u),r.call(this,e)}return(0,s.Z)(u,[{key:"render",value:function(){var e=this;return p().createElement(b.Z,{onLoad:function(t){var n=t.mergeWithDetail;return e.getRegistry().register(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n()))}},p().createElement(g.Z,{fallback:p().createElement(f.Z,{size:f.i.md}),hideBack:!0}))}}]),u}(p().Component))||r;h.propTypes={entity:m().object};const O=function(e){return p().createElement(h,e)};n(32369),n(57481),n(38879),n(89671);var E=n(87462),j=n(42982),P=n(70885),S=n(89624),T=n(14040),I=n(76450),w=n(72971),V=n(69073),R=n(37948),C=n(33739),x=n(27803),M=n(15861),Z=n(45987),k=n(87757),D=n.n(k),F=n(90570),$=n(26075),L=n(28216),B=n(43917),N=n(82176),q=n(76316),_=n(65115),A=n(65811),K=["culledTimestamp","staleWarningTimestamp","staleTimestamp","insightsId"],U=["tagFilters"];function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=function(e){return!(t.length>0)||t.map(String).includes(String(e))};return e.reduce((function(e,t){return n(t.major)&&(e[String(t.major)]=(0,j.Z)(new Set([].concat((0,j.Z)(e[t.major]||[]),[t.minor])))),e}),[])},W=function(e){var t=e.culledTimestamp,n=e.staleWarningTimestamp,r=e.staleTimestamp,o=e.insightsId;return G(G({},(0,Z.Z)(e,K)),{},{insights_id:o,culled_timestamp:t,stale_warning_timestamp:n,stale_timestamp:r})},Y=function(e){var t=e.query,n=e.onComplete,r=e.variables,o=void 0===r?{}:r,i=e.onError,s=(0,$.x)();return function(e,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s.query({query:t,fetchResults:!0,fetchPolicy:"no-cache",variables:G(G({perPage:e,page:r},o),a)}).then((function(e){var t,r,o,i=e.data,s=(null==i||null===(t=i.systems)||void 0===t||null===(r=t.edges)||void 0===r?void 0:r.map((function(e){return e.node})))||[],c={entities:(0,N.qN)(s).map(W),meta:G(G({},a.tags&&{tags:a.tags}),{},{totalCount:(null==i||null===(o=i.systems)||void 0===o?void 0:o.totalCount)||0})};return n&&n(c),c})).catch((function(e){if(i)return i(e),{entities:[],meta:{totalCount:0}};throw e}))}},J=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,o=Math.ceil(t/r)||1;return Promise.all((0,j.Z)(new Array(o)).map((function(t,o){return e(r,o+1,n)})))},Q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.tagFilters,n=(0,Z.Z)(e,U),r=t?{tags:t.flatMap((function(e){return e.values.map((function(t){return"".concat(encodeURIComponent(e.key),"/").concat(encodeURIComponent(t.tagKey),"=").concat(encodeURIComponent(t.value))}))}))}:{};return G(G({},n),r)},X=function(e){return(null==e?void 0:e.length)>0?"id ^ (".concat(e.join(","),")"):void 0},ee=function(e,t){return t.filter((function(t){return!e&&""!==e||-1!==(null==t?void 0:t.key.indexOf(e))}))};function te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?te(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var re=function(e){var t=e.columns,n=e.showAllSystems,r=e.policyId,o=e.query,i=e.showActions,s=e.enableExport,a=e.compliantFilter,c=e.policies,l=e.showOnlySystemsWithTestResults,d=e.showOsFilter,m=e.error,f=e.showComplianceSystemsInfo,y=e.compact,b=e.remediationsEnabled,g=e.systemProps,v=e.defaultFilter,h=e.emptyStateComponent,O=e.prependComponent,Z=e.showOsMinorVersionFilter,k=e.preselectedSystems,N=e.onSelect,K=e.noSystemsTable,U=e.tableProps,H=e.ssgVersions,W=(0,u.useRef)(null),te=(0,u.useState)(!1),re=(0,P.Z)(te,2),oe=re[0],ie=re[1],se=(0,u.useState)(!1),ae=(0,P.Z)(se,2),ce=ae[0],le=ae[1],ue=(0,u.useState)([]),pe=(0,P.Z)(ue,2),de=pe[0],me=pe[1],fe=(0,u.useState)(0),ye=(0,P.Z)(fe,2),be=ye[0],ge=ye[1],ve=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(0,F.a)(x.u5,G({skip:!e},t)).data,r=((null==n?void 0:n.systems)||{}).osVersions;return e?(0,x.F4)(z(r,e)):[]}(Z,{variables:ne({filter:v},r&&{policyId:r})}),he=(0,R.Z)({filters:{filterConfig:[].concat((0,j.Z)(w.qo),(0,j.Z)(a?w.rN:[]),(0,j.Z)((null==c?void 0:c.length)>0?(0,x.UD)(c,d):[]),(0,j.Z)(H?(0,x.tn)(H):[]),(0,j.Z)(ve))}}),Oe=he.toolbarProps,Ee=he.filterString,je=he.activeFilterValues,Pe=function(e,t,n){var r=[].concat((0,j.Z)(t?["has_test_results = true"]:[]),(0,j.Z)((null==e?void 0:e.length)>0?[e]:[])).join(" and ");return n?"(".concat(n,")")+(r?" and (".concat(r,")"):""):r}(Ee(),l,v),Se=function(e){var t,n=(0,u.useState)(),r=(0,P.Z)(n,2),o=r[0],i=r[1],s=(t=(0,$.x)(),function(){var e=(0,M.Z)(D().mark((function e(n,r,o,i){var s,a,c;return D().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.query(G({query:x.B1},i)).then((function(e){var t=e.data.systems.tags;return ee(o,t).map((function(e){return{tag:e}}))}));case 2:return s=e.sent,c=(a=r*n-r)+r,e.abrupt("return",{total:s.length,results:s.slice(a,c)});case 6:case"end":return e.stop()}}),e)})));return function(t,n,r,o){return e.apply(this,arguments)}}()),a=function(){var t=(0,M.Z)(D().mark((function t(n,r){var o,i,a,c,l,u;return D().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=r.pagination||{perPage:10,page:1},i=o.page,a=o.perPage,t.next=3,s(i,a,n,e);case 3:return c=t.sent,l=c.total,u=c.results,t.abrupt("return",{page:i,per_page:a,total:l,results:u});case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}();return{props:{hideFilters:{name:!0,tags:!1,registeredWith:!0,operatingSystem:!0,stale:!0},showTags:!0},currentTags:o,setCurrentTags:i,getTags:a}}({variables:ne({filter:Pe},r&&{policyId:r})}),Te=Se.props,Ie=Se.currentTags,we=Se.setCurrentTags,Ve=Se.getTags,Re={query:o,variables:ne({tags:Ie,filter:Pe},r&&{policyId:r})},Ce=function(e){var t=e.total,n=e.onSelect,r=e.preselected,o=e.fetchArguments,i=e.currentPageIds,s=e.systemsCache,a=void 0===s?[]:s,c=(0,u.useState)([]),l=(0,P.Z)(c,2),p=l[0],d=l[1],m=Y(G(G({},o),{},{query:x.D3,onError:function(e){(0,A.q)({variant:"danger",title:"Error selecting systems",description:e.message})}})),f=function(){var e=(0,M.Z)(D().mark((function e(t){var n,r;return D().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",[]);case 2:return n=X(t),e.next=5,J(m,t.length,G({},n&&{filter:n}));case 5:return r=e.sent,e.abrupt("return",r.flatMap((function(e){return e.entities})));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=(0,M.Z)(D().mark((function e(t){var n,r,o,i;return D().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.filter((function(e){var n=e.id;return t.includes(n)})),r=n.map((function(e){return e.id})),o=t.filter((function(e){return!r.includes(e)})),e.next=5,f(o);case 5:return i=e.sent,e.abrupt("return",[].concat((0,j.Z)(n),(0,j.Z)(i)));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=(0,M.Z)(D().mark((function e(t){var r;return D().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(t);case 2:r=e.sent,d(r),n&&n(r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=(0,M.Z)(D().mark((function e(){var n;return D().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J(m,t);case 2:return n=e.sent,e.abrupt("return",n.flatMap((function(e){return e.entities.map((function(e){return e.id}))})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return G({selectedSystems:p},(0,_.Z)({total:t,onSelect:b,preselected:r,itemIdsInTable:g,itemIdsOnPage:function(){return i}}))}({total:be,onSelect:N,preselected:(0,u.useMemo)((function(){return k.map((function(e){return e.id}))}),[k]),fetchArguments:Re,currentPageIds:de.map((function(e){return e.id})),systemsCache:de}),xe=Ce.selectedIds,Me=Ce.selectedSystems,Ze=Ce.tableProps,ke=Ce.toolbarProps;!function(e,t,n){var r=(0,L.I0)();(0,u.useLayoutEffect)((function(){r({type:"INVENTORY_INIT"})}),[]),(0,u.useEffect)((function(){r({type:"SELECT_ENTITIES",payload:{selected:t}})}),[t]);var o=(0,B.Z)((function(){Promise.resolve(r({type:"RESET_PAGE"})).then((function(){var t;return null==e||null===(t=e.current)||void 0===t?void 0:t.onRefreshData()}))}),50);(0,u.useEffect)((function(){o()}),[n])}(W,xe,je);var De=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.selected,r=t.columns,o=function(e,t){return e.map((function(e){return"".concat(e,":").concat(t)}))},i=function(e){return(r||[]).find((function(t){return t.key===e}))};return function(){var t=(0,M.Z)(D().mark((function t(r,s){var a,c,l,u,p,d,m,f,y,b,g,v,h;return D().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=s.page,c=void 0===a?1:a,l=s.per_page,u=s.orderBy,p=s.orderDirection,d=s.filters,m=i(u),f=m&&m.sortBy?o(m.sortBy,p):void 0,y=Q(d),t.next=6,e(l,c,G(G({},y),{},{sortBy:f}));case 6:return b=t.sent,v=(g=b||{}).entities,h=g.meta.totalCount,t.abrupt("return",{results:v.map((function(e){return G(G({},e),{},{selected:(n||[]).map((function(e){return e})).includes(e.id)})})),orderBy:u,orderDirection:p,total:h});case 9:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}(Y(ne(ne({},Re),{},{onComplete:function(e){var t,n;ge(e.meta.totalCount),me(e.entities),le(!0),we&&we(e.meta.tags),h&&0===e.meta.totalCount&&0===je.length&&0===(null==e||null===(t=e.meta)||void 0===t||null===(n=t.tags)||void 0===n?void 0:n.length)&&ie(!0)}})),{selected:xe,columns:t}),Fe=function(e){var t=e.columns,n=e.selected,r=e.total,o=e.fetchArguments,i=n?X(n):void 0,s=Y({query:o.query,variables:G(G(G({},o.variables),o.tags&&{tags:o.tags}),{},{filter:i?"".concat(o.variables.filter," and (").concat(i,")"):o.variables.filter}),onError:function(){(0,A.q)({variant:"danger",title:"Couldnt download export",description:"Reinitiate this export to try again."})}}),a=function(){var e=(0,M.Z)(D().mark((function e(){var t;return D().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J(s,r,(null==n?void 0:n.length)>0?X(n):void 0);case 2:return t=e.sent,e.abrupt("return",t.flatMap((function(e){return e.entities})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,q.ZP)({exporter:a,columns:t,isDisabled:0===r,onStart:function(){(0,A.q)({variant:"info",title:"Preparing export",description:"Once complete, your download will start automatically."})},onComplete:function(){(0,A.q)({variant:"success",title:"Downloading export"})}}).toolbarProps.exportConfig}({columns:t,filter:Pe,selected:xe,total:be,fetchArguments:ne({tags:Ie},Re)});return p().createElement(V.Se,{stateValues:{error:m,noError:void 0===m&&!oe,empty:oe}},p().createElement(V.K7,{stateKey:"error"},!!O&&O,p().createElement(V.mf,{error:m})),p().createElement(V.K7,{stateKey:"empty"},h),p().createElement(V.K7,{stateKey:"noError"},!!O&&ce&&O,f&&p().createElement(S.Alert,{isInline:!0,variant:"info",ouiaId:"SystemsListIsDifferentAlert",title:"The list of systems in this view is different than those that appear in the Inventory. Only systems currently associated with or reporting against compliance policies are displayed."}),p().createElement(C.Z,(0,E.Z)({},g,Te,{disableDefaultColumns:!0,columns:function(e){return t.map((function(t){var n="string"==typeof t,r=n?t:t.key,o=e.find((function(e){return e.key===r}));return ne(ne(ne({},o),n?{key:t}:t),{},{props:ne(ne({},null==o?void 0:o.props),null==t?void 0:t.props)})}))},noSystemsTable:K,ref:W,getEntities:De,getTags:Ve,onLoad:(0,x.B4)(t),tableProps:ne(ne({},Ze),{},{isStickyHeader:!0},U),fallback:p().createElement(S.Spinner,null),variant:y?T.TableVariant.compact:""},ke,!n&&ne(ne({},Oe),b&&{dedicatedAction:p().createElement(I.Z,{allSystems:Me,selectedRules:[]})}),s&&{exportConfig:Fe},i&&{actions:[{title:"View in inventory",onClick:function(e,t,n){var r=n.id,o="beta"===window.location.pathname.split("/")[1];window.location.href="".concat(window.location.origin).concat(o?"/beta":"","/insights/inventory/").concat(r)}}]}))))};re.propTypes={columns:m().arrayOf(m().oneOfType([m().shape({}),m().string])),policies:m().arrayOf(m().shape({})),showAllSystems:m().bool,policyId:m().string,query:m().oneOfType([m().string,m().object]),showActions:m().bool,enableExport:m().bool,compliantFilter:m().bool,showOnlySystemsWithTestResults:m().bool,showOsFilter:m().bool,showComplianceSystemsInfo:m().bool,error:m().object,compact:m().bool,remediationsEnabled:m().bool,defaultFilter:m().string,systemProps:m().shape({isFullView:m().bool}),emptyStateComponent:m().node,prependComponent:m().node,showOsMinorVersionFilter:m().oneOfType([m().bool,m().arrayOf(m().string)]),preselectedSystems:m().array,onSelect:m().func,noSystemsTable:m().node,tableProps:m().object,ssgVersions:m().array},re.defaultProps={policyId:"",showActions:!0,enableExport:!0,compliantFilter:!1,showOnlySystemsWithTestResults:!1,showComplianceSystemsInfo:!1,compact:!1,remediationsEnabled:!0,preselectedSystems:[]};const oe=re},99030:(e,t,n)=>{n.d(t,{zw:()=>l,UP:()=>u,Nw:()=>p});var r=n(4942),o=n(18546),i=n(79886);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var c=function(e,t){return e.map((function(e){return a(a({},e),{},{selected:t.includes(e.id)})}))},l=function(){var e;return(0,o.Gg)((e={},(0,r.Z)(e,"INVENTORY_INIT",(function(){return{rows:[],total:0}})),(0,r.Z)(e,"RESET_PAGE",(function(e){return a(a({},e),{},{page:1})})),(0,r.Z)(e,"SELECT_ENTITIES",(function(e,t){var n=t.payload.selected;return a(a({},e),{},{rows:c(e.rows,n)})})),e))},u=function(e){return e?e.reduce((function(e,t){var n=t.osMinorVersion;return null!=n&&(e[n]=e[n]||{osMinorVersion:n,count:0}).count++,e}),{}):{}},p=function(e){return Object.values(u(e)).sort((0,i.Sj)("osMinorVersion","desc"))}}}]);
//# sourceMappingURL=../sourcemaps/7242.4c9dd507954ef198b6ce60dbb7d966b2.js.map