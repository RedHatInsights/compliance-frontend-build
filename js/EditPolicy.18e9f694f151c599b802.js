(self.webpackChunkcompliance_frontend=self.webpackChunkcompliance_frontend||[]).push([[8402],{82813:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ComplianceSystems:()=>I,default:()=>S});var r=n(59713),i=n.n(r),o=n(28655),s=n.n(o),c=n(77865),a=n.n(c),l=n(44119),u=n.n(l),p=n(46829),d=n(35115),m=n(37311),f=n(93188),y=n(55186),h=n(49690),b=n(42564);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function E(){var e=s()(['\n{\n    profiles(search: "external = false and canonical = false") {\n        edges {\n            node {\n                id\n                name\n                refId\n                majorOsVersion\n            }\n        }\n    }\n}\n']);return E=function(){return e},e}var O=u()(E()),I=function(){var e,t=(0,b.Z)("newInventory"),n=(0,p.useQuery)(O),r=n.data,i=n.error,o=n.loading,s=[g({key:"facts.compliance.display_name",title:"Name",props:{width:40,isStatic:!0}},t&&{key:"display_name",renderFunc:h.B3}),g({key:"facts.compliance.policies",title:"Policies",props:{width:40,isStatic:!0}},t&&{key:"policyNames",renderFunc:function(e){return((0,h.ek)({policyNames:e})||{title:""}).title}}),g({key:"facts.compliance.details_link",title:"",props:{width:20,isStatic:!0}},t&&{key:"testResultProfiles",renderFunc:function(e,t){return((0,h.rI)({testResultProfiles:e,id:t})||{title:""}).title}})],c=null==r||null===(e=r.profiles)||void 0===e?void 0:e.edges.map((function(e){return e.node})),l=t?f.e_:f.r0;return a().createElement(a().Fragment,null,a().createElement(d.PageHeader,{className:"page-header"},a().createElement(d.PageHeaderTitle,{title:"Systems"})),a().createElement(d.Main,null,a().createElement(m.tC,{stateValues:{error:i,data:r,loading:o}},a().createElement(m.K7,{stateKey:"data"},c&&a().createElement(l,{query:y.Ep,systemProps:{isFullView:!0},showOsFilter:!0,showComplianceSystemsInfo:!0,enableEditPolicy:!1,remediationsEnabled:!1,columns:s,policies:c})))))};const S=I},92428:(e,t,n)=>{"use strict";n.r(t),n.d(t,{CreatePolicy:()=>Te,default:()=>we});var r=n(63038),i=n.n(r),o=n(77865),s=n.n(o),c=n(47194),a=n(33766),l=n(87016),u=n(45697),p=n.n(u),d=n(98627),m=n(59713),f=n.n(m),y=n(28655),h=n.n(y),b=n(55795),v=n(37311),g=n(44119),E=n.n(g),O=n(46829),I=n(35115),S=n(15113),T=n(46314),P=n(32065);function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function x(){var e=h()(['\nquery benchmarksAndProfiles {\n    latestBenchmarks {\n        id\n        title\n        refId\n        version\n        profiles {\n            id\n            name\n            refId\n            description\n            complianceThreshold\n        }\n    }\n    profiles(search: "external = false and canonical = false") {\n        edges {\n            node {\n                id\n                refId\n                benchmark {\n                    refId\n                }\n            }\n        }\n    }\n}\n']);return x=function(){return e},e}var R=E()(x()),k=function(e){var t=e.change,n=e.selectedBenchmarkId,r=(0,O.useQuery)(R,{fetchPolicy:"no-cache"}),i=r.data,o=r.error,c=r.loading;if(o)return o;if(c)return s().createElement(I.Spinner,null);var a,l,u,p,m=i.latestBenchmarks;if(n){a=m.find((function(e){return e.id===n}));var f=(u=i.profiles.edges,p=a,u.filter((function(e){return p.refId===e.node.benchmark.refId})).map((function(e){return e.node.refId})));l=a.profiles.map((function(e){return j(j({},e),{},{disabled:f.includes(e.refId)})}))}return s().createElement(s().Fragment,null,s().createElement(d.TextContent,null,s().createElement(d.Text,{component:d.TextVariants.h1},"Create SCAP policy"),s().createElement(d.Text,{component:d.TextVariants.h4},"Select the operating system and policy type")),s().createElement(d.Form,null,s().createElement(d.FormGroup,{label:"Operating system",isRequired:!0,fieldId:"benchmark"},s().createElement("br",null),m&&m.sort((function(e,t){return e.refId.localeCompare(t.refId)})).map((function(e){var r=e.refId,i=e.id;return s().createElement(d.Button,{key:i,onClick:function(){t("benchmark",i)},className:"wizard-os-button ".concat(n===i?"active-wizard-os-button":""),variant:"tertiary"},r&&r.split("xccdf_org.ssgproject.content_benchmark_")[1].replace("-"," "))}))),a&&s().createElement(d.Text,{component:d.TextVariants.small},"SCAP Security Guide (SSG): ",a.title," - ",a.version,s().createElement(d.Tooltip,{position:d.TooltipPosition.right,content:"Policies configured in the Compliance services use\n                                                                        the latest version of the SSG packaged with RHEL."},s().createElement("span",null," ",s().createElement(b.ZP,{className:"grey-icon"})))),s().createElement(d.FormGroup,{label:"Policy type",isRequired:!0,fieldId:"policy-type"},s().createElement(v.yL,{profiles:a&&l,onClick:function(){t("selectedRuleRefIds",null)}}))))};k.propTypes={selectedBenchmarkId:p().string,change:S.ZP.change};var F=(0,a.Z)("policyForm");const C=(0,P.compose)((0,l.connect)((function(e){return{selectedBenchmarkId:F(e,"benchmark")}})),(0,T.Z)({form:"policyForm",destroyOnUnmount:!1,forceUnregisterOnUnmount:!0}))(k);var _=n(22744);function D(){var e=h()(["\nquery benchmarkAndProfile($benchmarkId: String!, $profileId: String!){\n    benchmark(id: $benchmarkId) {\n        id\n        rules {\n            id\n            title\n            severity\n            rationale\n            refId\n            description\n            remediationAvailable\n            identifier\n        }\n    }\n    profile(id: $profileId) {\n        id\n        name\n        refId\n        rules {\n            id\n            refId\n        }\n    }\n}\n"]);return D=function(){return e},e}var V=E()(D()),L=function(e){var t,n,r=e.profileId,c=e.benchmarkId,a=e.selectedRuleRefIds,l=e.change,u=(0,_.re)(["Rule","Severity","Ansible"]),p=(0,O.useQuery)(V,{variables:{profileId:r,benchmarkId:c}}),m=p.data,f=p.error,y=p.loading,h=(0,o.useState)(null),b=i()(h,2),g=b[0],E=b[1],S=m&&[{profile:{refId:m.profile.refId,name:m.profile.name},rules:m.benchmark.rules}];return(0,o.useEffect)((function(){if(m){var e=m.profile.rules.map((function(e){return e.refId}));E(e),a||l("selectedRuleRefIds",e)}}),[m]),s().createElement(v.tC,{stateValues:{error:f,data:m,loading:y}},s().createElement(v.K7,{stateKey:"loading"},s().createElement(I.EmptyTable,null,s().createElement(I.Spinner,null))),s().createElement(v.K7,{stateKey:"data"},s().createElement(d.TextContent,null,s().createElement(d.Text,{component:d.TextVariants.h1},"Rules")),s().createElement(d.TextContent,null,s().createElement(d.Text,null,"Edit your policy by including and excluding rules."),s().createElement(d.Text,null,"Selected policy type ",s().createElement("strong",null,null==m?void 0:m.profile.name)," has ",null==g?void 0:g.length," rules. ",a&&(n=null==(t=a)?void 0:t.filter((function(e){return null==g?void 0:g.includes(e)})),!(t&&g&&n.length===g.length))&&s().createElement(d.Button,{variant:"link",isInline:!0,onClick:function(){return l("selectedRuleRefIds",g)}},"Reset to default selection"))),s().createElement(_.QB,{remediationsEnabled:!1,tailoringEnabled:!0,selectedFilter:!0,columns:u,loading:y,handleSelect:function(e){return l("selectedRuleRefIds",e)},profileRules:S,selectedRefIds:a||[]})))};L.propTypes={profileId:p().string,benchmarkId:p().string,change:S.ZP.change,selectedRuleRefIds:p().array};var A=(0,a.Z)("policyForm");const N=(0,P.compose)((0,l.connect)((function(e){return{benchmarkId:A(e,"benchmark"),profileId:JSON.parse(A(e,"profile")).id,selectedRuleRefIds:A(e,"selectedRuleRefIds")}})),(0,T.Z)({form:"policyForm",destroyOnUnmount:!1,forceUnregisterOnUnmount:!0}))(L);var M=n(93188),$=n(42564);function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var B=function(e){var t=e.change,n=e.selectedSystemIds,r=(0,$.Z)("newInventory"),i=[U({composed:["facts.os_release","display_name"],key:"facts.compliance.display_name",title:"Name",props:{width:40,isStatic:!0}},r&&{key:"display_name"}),U({key:"facts.compliance.policies",title:"Policies",props:{width:40,isStatic:!0}},r&&{key:"policies"})];(0,o.useEffect)((function(){n&&t("systems",n)}),[n]);var c=r?M.e_:M.r0;return s().createElement(s().Fragment,null,s().createElement(d.TextContent,null,s().createElement(d.Text,{component:d.TextVariants.h1},"Systems"),s().createElement(d.Text,{component:d.TextVariants.h4},"Choose systems to scan with this policy. You can add and remove systems later.")),s().createElement(d.Form,null,s().createElement(d.FormGroup,null,s().createElement(c,{columns:i,remediationsEnabled:!1,compact:!0,showActions:!1,showAllSystems:!0,enableExport:!1}))))};B.propTypes={selectedSystemIds:p().array,change:S.ZP.change},B.defaultProps={selectedSystemIds:[]};const Z=(0,P.compose)((0,l.connect)((function(e){var t=e.entities;return{selectedSystemIds:((null==t?void 0:t.selectedEntities)||[]).map((function(e){return e.id}))}})),(0,T.Z)({form:"policyForm",destroyOnUnmount:!1,forceUnregisterOnUnmount:!0}))(B);var z=n(6455),J=n(53426),K=function(e){var t=e.profile;return s().createElement(s().Fragment,null,s().createElement(d.TextContent,null,s().createElement(d.Text,{component:d.TextVariants.h1},"Details")),s().createElement("br",null),s().createElement(d.Form,{id:"editpolicydetails"},s().createElement(d.FormGroup,{label:"Policy name",isRequired:!0,fieldId:"name"},s().createElement(z.Z,{component:J._c,type:"text",isRequired:!0,id:"name",name:"name","aria-describedby":"name"})),s().createElement(d.FormGroup,{label:"Reference ID",isRequired:!0,fieldId:"refId"},s().createElement(z.Z,{type:"text",component:J._c,isDisabled:!0,id:"refId",name:"refId","aria-describedby":"refId"})),s().createElement(d.FormGroup,{label:"Description",fieldId:"description"},s().createElement(z.Z,{type:"text",component:J.do,id:"description",name:"description","aria-describedby":"description"})),s().createElement(d.FormGroup,{label:"Business objective",fieldId:"businessObjective"},s().createElement(z.Z,{type:"text",component:J._c,id:"businessObjective",name:"businessObjective","aria-describedby":"businessObjective",defaultValue:t.businessObjective})),s().createElement(v._z,{showTitle:!1,previousThreshold:t.complianceThreshold})))},W=(0,a.Z)("policyForm");K.propTypes={profile:p().object,dispatch:p().func};const G=(0,P.compose)((0,l.connect)((function(e){return{profile:JSON.parse(W(e,"profile")),initialValues:{name:"".concat(JSON.parse(W(e,"profile")).name),refId:"".concat(JSON.parse(W(e,"profile")).refId),description:"".concat(JSON.parse(W(e,"profile")).description),benchmark:W(e,"benchmark"),profile:W(e,"profile")}}})),(0,T.Z)({form:"policyForm",destroyOnUnmount:!1,forceUnregisterOnUnmount:!0}))(K);function Y(){var e=h()(["\nquery review($benchmarkId: String!) {\n    benchmark(id: $benchmarkId) {\n        id\n        title\n        refId\n        version\n    }\n}\n"]);return Y=function(){return e},e}var H=E()(Y()),Q=function(e){var t=e.benchmarkId,n=e.name,r=e.refId,i=e.businessObjective,o=e.systemsCount,c=e.rulesCount,a=e.complianceThreshold,l=e.parentProfileName,u=(0,O.useQuery)(H,{variables:{benchmarkId:t}}),p=u.data,m=u.error,f=u.loading;if(m)return m;if(f)return s().createElement(I.Spinner,null);var y=p.benchmark;return s().createElement(d.TextContent,null,s().createElement(d.Text,{component:d.TextVariants.h1},"Review"),s().createElement(d.Text,{component:d.TextVariants.h4},"Review your policy before finishing."),s().createElement(d.TextList,{component:d.TextListVariants.dl},s().createElement(d.TextListItem,{component:d.TextListItemVariants.dt},"Operating system"),s().createElement(d.TextListItem,{component:d.TextListItemVariants.dd},y.refId.split("xccdf_org.ssgproject.content_benchmark_")[1].replace("-"," ")),s().createElement(d.TextListItem,{component:d.TextListItemVariants.dt},"Security guide"),s().createElement(d.TextListItem,{component:d.TextListItemVariants.dd}," ".concat(y.title," - ").concat(y.version)),s().createElement(d.TextListItem,{component:d.TextListItemVariants.dt},"Policy type"),s().createElement(d.TextListItem,{component:d.TextListItemVariants.dd},l),s().createElement(d.TextListItem,{component:d.TextListItemVariants.dt},"Policy name"),s().createElement(d.TextListItem,{component:d.TextListItemVariants.dd},n),s().createElement(d.TextListItem,{component:d.TextListItemVariants.dt},"Reference ID"),s().createElement(d.TextListItem,{component:d.TextListItemVariants.dd},r),s().createElement(d.TextListItem,{component:d.TextListItemVariants.dt},"Compliance threshold"),s().createElement(d.TextListItem,{component:d.TextListItemVariants.dd},a,"%"),i&&s().createElement(s().Fragment,null,s().createElement(d.TextListItem,{component:d.TextListItemVariants.dt},"Business objective"),s().createElement(d.TextListItem,{component:d.TextListItemVariants.dd},i)),s().createElement(d.TextListItem,{component:d.TextListItemVariants.dt},"No. of rules"),s().createElement(d.TextListItem,{component:d.TextListItemVariants.dd},c),s().createElement(d.TextListItem,{component:d.TextListItemVariants.dt},"No. of systems"),s().createElement(d.TextListItem,{component:d.TextListItemVariants.dd},o>0?o:s().createElement(v.UN,{variant:"compact",count:o}))))};Q.propTypes={benchmarkId:p().string,refId:p().string,name:p().string,businessObjective:p().string,systemsCount:p().number,rulesCount:p().number,complianceThreshold:p().number,parentProfileName:p().string};var X=(0,a.Z)("policyForm");const ee=(0,l.connect)((function(e){return{benchmarkId:X(e,"benchmark"),refId:X(e,"refId"),name:X(e,"name"),businessObjective:X(e,"businessObjective"),systemsCount:X(e,"systems").length,complianceThreshold:parseFloat(X(e,"complianceThreshold"))||100,parentProfileName:JSON.parse(X(e,"profile")).name,rulesCount:X(e,"selectedRuleRefIds").length}}))(Q);var te=n(87757),ne=n.n(te),re=n(48926),ie=n.n(re),oe=n(34575),se=n.n(oe),ce=n(93913),ae=n.n(ce),le=n(81506),ue=n.n(le),pe=n(2205),de=n.n(pe),me=n(78585),fe=n.n(me),ye=n(29754),he=n.n(ye),be=n(2112),ve=n(98467),ge=n(13173);var Ee=function(e){de()(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=he()(t);if(n){var i=he()(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return fe()(this,e)});function i(){var e;se()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),f()(ue()(e),"state",{percent:0,message:"This usually takes a minute or two.",errors:null,failed:!1}),f()(ue()(e),"createProfile",ie()(ne().mark((function t(){var n,r,i,o,s,c,a,l,u,p,d,m;return ne().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.props,r=n.businessObjective,i=n.benchmarkId,o=n.cloneFromProfileId,s=n.refId,c=n.name,a=n.description,l=n.complianceThreshold,u=n.selectedRuleRefIds,p=n.client,d={benchmarkId:i,cloneFromProfileId:o,complianceThreshold:l,description:a,name:c,refId:s,selectedRuleRefIds:u},!r){t.next=7;break}return t.next=5,p.mutate({mutation:ge.Jd,variables:{input:{title:r}}});case 5:m=t.sent,d.businessObjectiveId=m.data.createBusinessObjective.businessObjective.id;case 7:return t.abrupt("return",p.mutate({mutation:ge.nT,variables:{input:d}}));case 8:case"end":return t.stop()}}),t)})))),f()(ue()(e),"associateSystems",(function(){var t=e.props,n=t.systemIds,r=t.client,i=e.state.profileId;return r.mutate({mutation:ge.oI,variables:{input:{id:i,systemIds:n}}}).then((function(){e.setState((function(e){return{percent:e.percent+50,message:""}}))})).catch((function(t){e.setState({message:t.networkError.message,errors:t.networkError.result.errors,failed:!0})}))})),e}return ae()(i,[{key:"componentDidMount",value:function(){var e=this;this.createProfile().then((function(t){e.setState((function(e){return{percent:e.percent+50,profileId:t.data.createProfile.profile.id}}),e.associateSystems)})).catch((function(t){e.setState({message:t.networkError.message,errors:t.networkError.result.errors,failed:!0})}))}},{key:"render",value:function(){var e,t=this.state,n=t.percent,r=t.message,i=t.failed,o=t.errors,c=this.props.onWizardFinish;return o&&Array.isArray(o)&&o.length>0&&(e=o.map((function(e){return s().createElement(d.ListItem,{key:e},e)}))),s().createElement(d.Bullseye,null,s().createElement(d.EmptyState,{variant:d.EmptyStateVariant.full},s().createElement(d.EmptyStateIcon,{icon:be.ZP}),s().createElement("br",null),s().createElement(d.Title,{headingLevel:"h1",size:"lg"},"Creating policy"),s().createElement(d.EmptyStateBody,null,s().createElement(v.ko,{percent:n,failed:i})),s().createElement(d.EmptyStateBody,{className:i&&"wizard-failed-message"},r),e&&s().createElement(d.EmptyStateBody,{className:"wizard-failed-errors"},s().createElement(d.List,null,e)),s().createElement(d.EmptyStateSecondaryActions,null,100===n?s().createElement(d.Button,{variant:"primary",onClick:function(){c()}},"Return to application"):"")))}}]),i}(s().Component);Ee.propTypes={benchmarkId:p().string.isRequired,client:p().object.isRequired,businessObjective:p().object,cloneFromProfileId:p().string.isRequired,refId:p().string.isRequired,name:p().string.isRequired,description:p().string,systemIds:p().array,complianceThreshold:p().number,onWizardFinish:p().func,selectedRuleRefIds:p().arrayOf(p().string).isRequired};var Oe=(0,a.Z)("policyForm");const Ie=(0,P.compose)((0,l.connect)((function(e){return{benchmarkId:Oe(e,"benchmark"),businessObjective:Oe(e,"businessObjective"),cloneFromProfileId:JSON.parse(Oe(e,"profile")).id,refId:Oe(e,"refId"),name:Oe(e,"name"),description:Oe(e,"description"),complianceThreshold:parseFloat(Oe(e,"complianceThreshold"))||100,systemIds:Oe(e,"systems"),selectedRuleRefIds:Oe(e,"selectedRuleRefIds")}})),(0,T.Z)({form:"policyForm",destroyOnUnmount:!0,forceUnregisterOnUnmount:!0}),ve.withApollo)(Ee);var Se=n(62560),Te=function(e){var t=e.benchmark,n=e.complianceThreshold,r=e.name,a=e.profile,l=e.refId,u=e.selectedRuleRefIds,p=(0,c.useHistory)(),m=(0,o.useState)(1),f=i()(m,2),y=f[0],h=f[1],b=function(){p.push("/scappolicies")},v=[{id:1,name:"Create SCAP policy",component:s().createElement(C,null),enableNext:(0,Se.qH)(t,a)},{id:2,name:"Details",component:s().createElement(G,null),canJumpTo:y>=2,enableNext:(0,Se.ZP)(r,l,n)},{id:3,name:"Rules",component:s().createElement(N,null),canJumpTo:y>=3,enableNext:(0,Se.qB)(u)},{id:4,name:"Systems",component:s().createElement(Z,null),canJumpTo:y>=4},{id:5,name:"Review",component:s().createElement(ee,null),nextButtonText:"Finish",canJumpTo:y>=5},{id:6,name:"Finished",component:s().createElement(Ie,{onWizardFinish:b}),isFinishedStep:!0,canJumpTo:y>=6}];return s().createElement(s().Fragment,null,s().createElement(d.Wizard,{isOpen:!0,onClose:b,title:"Create SCAP policy",description:"Create a new policy for managing SCAP compliance",steps:v,onNext:function(e){var t=e.id;h(y<t?t:y)}}))};Te.propTypes={benchmark:p().string,complianceThreshold:p().string,businessObjective:p().object,dispatch:p().func,isOpen:p().bool,name:p().string,onWizardFinish:p().func,profile:p().string,refId:p().string,selectedRuleRefIds:p().arrayOf(p().string)},Te.defaultProps={isOpen:!1};var Pe=(0,a.Z)("policyForm");const we=(0,l.connect)((function(e){return{benchmark:Pe(e,"benchmark"),businessObjective:Pe(e,"businessObjective"),complianceThreshold:Pe(e,"complianceThreshold")||100,name:Pe(e,"name"),profile:Pe(e,"profile"),refId:Pe(e,"refId"),selectedRuleRefIds:Pe(e,"selectedRuleRefIds")}}))(Te)},59354:(e,t,n)=>{"use strict";n.r(t),n.d(t,{EditPolicy:()=>D,default:()=>V});var r=n(59713),i=n.n(r),o=n(63038),s=n.n(o),c=n(77865),a=n.n(c),l=n(45697),u=n.n(l),p=n(47194),d=n(87016),m=n(98627),f=n(37311),y=n(93188),h=n(50437),b=n(52998),v=n(62560);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O=function(e){var t,n=e.policy,r=e.setUpdatedPolicy,i=function(){var e=(0,c.useState)(!0),t=s()(e,2),n=t[0],r=t[1];return[n,function(e){var t=(0,v.KJ)(e);return r(t),t}]}(),o=s()(i,2),l=o[0],u=o[1];return a().createElement(a().Fragment,null,a().createElement(m.FormGroup,{label:"Policy description",isRequired:!0,fieldId:"description"},a().createElement(m.TextArea,{style:{width:800,height:110},isRequired:!0,type:"text",id:"description",name:"description","aria-describedby":"description",defaultValue:n.description,onChange:function(e){r((function(t){return E(E({},t),{},{description:e})}))}})),a().createElement(m.FormGroup,{label:"Business objective",fieldId:"business-objective"},a().createElement(m.TextInput,{type:"text",style:{width:300},id:"business-objective",name:"business-objective","aria-describedby":"business-objective",defaultValue:null==n||null===(t=n.businessObjective)||void 0===t?void 0:t.title,onChange:function(e){r((function(t){return E(E({},t),{},{businessObjective:E(E({},t.businessObjective),{},{title:e})})}))}})),a().createElement(m.FormGroup,{validated:l?"default":"error",label:"Compliance threshold (%)",fieldId:"policy-threshold",helperTextInvalid:"Threshold has to be a number between 0 and 100",helperText:"A value of 95% or higher is recommended"},a().createElement(m.TextInput,{type:"number",style:{width:150},name:"compliance-threshold",id:"compliance-threshold",defaultValue:n.complianceThreshold,"aria-describedby":"policy-threshold",onChange:function(e){r((function(t){return E(E({},t),{},{complianceThreshold:e,complianceThresholdValid:u(e)})}))}})))};O.propTypes={policy:u().shape({description:u().string,businessObjective:u().object,complianceThreshold:u().oneOfType([u().string,u().number])}),setUpdatedPolicy:u().func};const I=O;var S=n(87757),T=n.n(S),P=n(48926),w=n.n(P),j=n(46829),x=n(13173);var R=n(42564),k=n(49690),F=n(55186);function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var D=function(e){var t,n,r,i,o,l,u,v,g=e.route,E=(0,R.Z)("newInventory"),O=(0,p.useLocation)(),S=(0,d.useDispatch)(),P=null==O||null===(t=O.state)||void 0===t?void 0:t.policy,C=(0,h.Wb)(),D=(0,c.useState)(null),V=s()(D,2),L=V[0],A=V[1],N=(n=(0,j.useMutation)(x.Jd),r=s()(n,1)[0],i=function(){var e=w()(T().mark((function e(t,n){var i,o,s;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((null==t||null===(i=t.businessObjective)||void 0===i?void 0:i.title)!==(null==n?void 0:n.title)){e.next=4;break}return e.abrupt("return",null==t||null===(o=t.businessObjective)||void 0===o?void 0:o.id);case 4:if(""!==(null==n?void 0:n.title)){e.next=8;break}return e.abrupt("return",null);case 8:return e.next=10,r({variables:{input:{title:n.title}}});case 10:return s=e.sent,e.abrupt("return",s.data.createBusinessObjective.businessObjective.id);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),o=(0,j.useMutation)(x.r0),l=s()(o,1)[0],u=(0,j.useMutation)(x.oI),v=s()(u,1)[0],function(){var e=w()(T().mark((function e(t,n){var r;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.id,e.t1=n.name,e.t2=n.description,e.t3=parseFloat(n.complianceThreshold),e.next=6,i(t,null==n?void 0:n.businessObjective);case 6:return e.t4=e.sent,r={id:e.t0,name:e.t1,description:e.t2,complianceThreshold:e.t3,businessObjectiveId:e.t4},v({variables:{input:{id:t.id,systemIds:n.hosts.map((function(e){return e.id}))}}}),e.next=11,l({variables:{input:r}});case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),M=(0,h.C3)("/scappolicies"),$=(0,d.useSelector)((function(e){var t;return null==e||null===(t=e.entities)||void 0===t?void 0:t.selectedEntities})),q=L&&!L.complianceThresholdValid,U=function(){E&&S({type:"SELECT_ENTITIES",payload:{ids:[]}}),M({hash:C})},B=[a().createElement(m.Button,{isDisabled:q,key:"save",variant:"primary",onClick:function(){return N(P,L).then((function(){return U()}))}},"Save"),a().createElement(m.Button,{key:"cancel",variant:"secondary",onClick:function(){return U()}},"Cancel")];(0,c.useEffect)((function(){A(_(_({},L),{},{hosts:$||[]}))}),[$]),(0,c.useEffect)((function(){var e,t=P.complianceThreshold<101&&P.complianceThreshold>0;A(_(_({},P),{},{complianceThresholdValid:t})),S({type:"SELECT_ENTITIES",payload:{ids:(null==P||null===(e=P.hosts)||void 0===e?void 0:e.map((function(e){return{id:e.id}})))||[]}})}),[P]);var Z=E?y.e_:y.r0;return(0,b.a)(g,null==P?void 0:P.name),P&&a().createElement(m.Modal,{isOpen:!0,style:{height:"400px"},width:1e3,title:"Edit ".concat(P.name),onClose:function(){return U()},actions:B},a().createElement(m.Form,null,a().createElement(f.tn,{defaultTab:"details"},a().createElement(m.Tab,{eventKey:"details",title:a().createElement(m.TabTitleText,null,"Details")},a().createElement(I,{policy:P,setUpdatedPolicy:A})),a().createElement(m.Tab,{eventKey:"rules",title:a().createElement(m.TabTitleText,null,"Rules")},"Rule editing coming soon"),a().createElement(m.Tab,{eventKey:"systems",title:a().createElement(m.TabTitleText,null,"Systems")},a().createElement(Z,{compact:!0,showActions:!1,enableExport:!1,showAllSystems:!0,remediationsEnabled:!1,policyId:P.id,query:F.Y0,defaultFilter:"policy_id = ".concat(P.id),columns:[_({key:"facts.compliance.display_name",title:"Name",props:{width:40,isStatic:!0}},E&&{key:"display_name",renderFunc:function(e,t,n){return null!=n&&n.lastScanned?(0,k.B3)(e,t,n):e}})],preselectedSystems:(null==P?void 0:P.hosts.map((function(e){return{id:e.id}})))||[]})))))};D.propTypes={route:u().object};const V=D},21157:(e,t,n)=>{"use strict";n.d(t,{n1:()=>K,ZP:()=>ce});var r=n(67154),i=n.n(r),o=n(6479),s=n.n(o),c=n(34575),a=n.n(c),l=n(93913),u=n.n(l),p=n(81506),d=n.n(p),m=n(2205),f=n.n(m),y=n(78585),h=n.n(y),b=n(29754),v=n.n(b),g=n(59713),E=n.n(g),O=n(319),I=n.n(O),S=n(28655),T=n.n(S),P=n(35937),w=n.n(P),j=n(77865),x=n.n(j),R=n(45697),k=n.n(R),F=n(98467),C=n(87016),_=n(44119),D=n.n(_),V=n(35115),L=n(22744),A=n(75061),N=n(37311),M=n(59088),$=n(33660),q=n(49690),U=n(31222),B=n(27668),Z=n(98627),z=n(58135),J=function(e){var t=e.supported,n=e.ssgVersion;return n||(n="Not available"),t?n:x().createElement(N.cT,{messageVariant:"singular"},n)};J.propTypes={supported:k().bool,ssgVersion:k().string};const K={SSGVersion:J};var W;function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){E()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function H(){var e=T()(["\nquery getSystems($filter: String!, $policyId: ID, $perPage: Int, $page: Int) {\n    systems(search: $filter, limit: $perPage, offset: $page) {\n        totalCount\n        edges {\n            node {\n                id\n                name\n                osMajorVersion\n                osMinorVersion\n                testResultProfiles(policyId: $policyId) {\n                    id\n                    name\n                    lastScanned\n                    external\n                    compliant\n                    score\n                    supported\n                    ssgVersion\n                    policy {\n                        id\n                    }\n                }\n                policies(policyId: $policyId) {\n                    id\n                    name\n                }\n            }\n        }\n    }\n}\n"]);return H=function(){return e},e}function Q(){var e=T()(["\nquery getSystems($filter: String!, $policyId: ID, $perPage: Int, $page: Int) {\n    systems(search: $filter, limit: $perPage, offset: $page) {\n        totalCount\n        edges {\n            node {\n                id\n                name\n                osMajorVersion\n                osMinorVersion\n                testResultProfiles(policyId: $policyId) {\n                    id\n                    name\n                    refId\n                    lastScanned\n                    compliant\n                    external\n                    score\n                    supported\n                    ssgVersion\n                    rules {\n                        refId\n                        title\n                        compliant\n                        remediationAvailable\n                    }\n                }\n                policies(policyId: $policyId) {\n                    id\n                    name\n                }\n            }\n        }\n    }\n}\n"]);return Q=function(){return e},e}var X=D()(Q()),ee=D()(H()),te=function(e){return w()(e.initialDefaultState(),(function(e){return!!e}))},ne={page:1},re=function(e,t){return[].concat(I()((0,U.RM)(e)),I()(t?(0,U.iz)(e):[]))},ie=(0,A.ZP)()(W=function(e){f()(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=v()(t);if(n){var i=v()(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return h()(this,e)});function o(){var e;a()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),E()(d()(e),"inventory",x().createRef()),E()(d()(e),"filterConfig",new L.CN([].concat(I()(U.qo),I()(e.props.compliantFilter?U.rN:[]),I()(e.props.policies&&e.props.policies.length>0?re(e.props.policies,e.props.showOsFilter):[])))),E()(d()(e),"chipBuilder",e.filterConfig.getChipBuilder()),E()(d()(e),"filterBuilder",e.filterConfig.getFilterBuilder()),E()(d()(e),"state",Y(Y({},ne),{},{policyId:e.props.policyId,perPage:50,totalCount:0,activeFilters:te(e.filterConfig)})),E()(d()(e),"componentDidMount",(function(){var t=e.props,n=t.clearAll,r=t.selectedEntities;r&&r.length>0&&n(),(e.props.preselectedSystems?Promise.resolve(e.props.selectEntities(e.props.preselectedSystems)):Promise.resolve()).then((function(){e.updateSystems()}))})),E()(d()(e),"componentDidUpdate",(function(t){t.complianceThreshold!==e.props.complianceThreshold&&e.updateSystems()})),E()(d()(e),"onRefresh",(function(t){var n=t.page,r=t.per_page,i=s()(t,["page","per_page"]);e.props.showAllSystems&&e.inventory&&e.inventory.current?e.setState({page:n,perPage:r},(function(){e.inventory.current.onRefreshData(Y(Y({page:n,perPage:r},i),{},{per_page:r}))})):e.setState({page:n,perPage:r},(function(){return e.updateSystems().then((function(){e.inventory&&e.inventory.current&&e.inventory.current.onRefreshData(Y(Y({page:n,perPage:r},i),{},{per_page:r}))}))}))})),E()(d()(e),"fetchSystems",(function(){var t=e.props,n=t.defaultFilter,r=t.client,i=t.showOnlySystemsWithTestResults,o=t.remediationsEnabled,s=e.state,c=s.policyId,a=s.perPage,l=s.page,u=s.activeFilters,p={filter:[n,i&&"has_test_results = true",e.filterBuilder.buildFilterString(u)].filter((function(e){return!!e})).join(" and "),perPage:a,page:l,policyId:c};return r.query({query:o?X:ee,fetchResults:!0,fetchPolicy:"no-cache",variables:p})})),E()(d()(e),"updateSystems",(function(){var t=e.props.systems.map((function(e){return e.node.id})).sort();return e.fetchSystems().then((function(t){return e.props.updateSystems({systems:t.data.systems.edges,systemsCount:t.data.systems.totalCount})})).then((function(){var n=e.props.systems.map((function(e){return e.node.id})).sort();JSON.stringify(n)===JSON.stringify(t)&&e.props.updateRows()})).catch((function(t){e.setState((function(e){return Y(Y({},e),{},{error:t})}))}))})),E()(d()(e),"onExportSelect",(function(t,n){return e.props.exportFromState(n)})),E()(d()(e),"onFilterUpdate",(function(t,n){e.props.updateSystems({systems:[],systemsCount:0}),e.setState(Y(Y({},ne),{},{activeFilters:Y(Y({},e.state.activeFilters),{},E()({},t,n))}),e.updateSystems)})),E()(d()(e),"deleteFilter",(function(t){var n=e.filterConfig.removeFilterWithChip(t,e.state.activeFilters);e.setState(Y(Y({},ne),{},{activeFilters:n}),e.updateSystems)})),E()(d()(e),"clearAllFilter",(function(){e.setState(Y(Y({},ne),{},{activeFilters:te(e.filterConfig)}),e.updateSystems)})),E()(d()(e),"onFilterDelete",(function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r?e.clearAllFilter():e.deleteFilter(n[0])})),E()(d()(e),"onBulkSelect",(function(){var t=e.props,n=t.selectedEntities,r=t.selectAll,i=t.clearSelection,o=t.allSelectedOnPage;0===n.length||n.length>0&&!o?r():i()})),E()(d()(e),"isExportDisabled",(function(){var t=e.props,n=t.total,r=t.selectedEntities;return 0===(n||0)&&0===r.length})),e}return u()(o,[{key:"render",value:function(){var e,t=this,n=this.props,r=n.remediationsEnabled,o=n.compact,s=n.enableExport,c=n.showAllSystems,a=n.showActions,l=n.showComplianceSystemsInfo,u=n.selectedEntities,p=n.selectedEntitiesIds,d=n.systems,m=n.total,f=n.policyId,y=n.systemProps,h=n.columns,b=this.state,v=b.page,g=b.perPage,E=b.activeFilters,O=b.error,I=this.filterConfig.buildConfiguration(this.onFilterUpdate,E,{hideLabel:!0}),S=this.chipBuilder.chipsFor(this.state.activeFilters),T=s?{isDisabled:this.isExportDisabled(),onSelect:this.onExportSelect}:{},P=Y(Y({},y),{},{onRefresh:this.onRefresh,ref:this.inventory,page:v,perPage:g,exportConfig:T,tableProps:{canSelectAll:!1},bulkSelect:{checked:u.length>0&&(!!this.props.allSelectedOnPage||null),onSelect:this.onBulkSelect,count:u.length,label:u.length>0?"".concat(u.length," Selected"):void 0}});return a&&(P.actions=[{title:"View in inventory",onClick:function(e,t,n){var r=n.id,i="beta"===window.location.pathname.split("/")[1];window.location.href="".concat(window.location.origin).concat(i?"/beta":"","/insights/inventory/").concat(r)}}]),c||(P.total=m,P.items=d.map((function(e){return e.node.id})),P.filterConfig=I,P.activeFiltersConfig={filters:S,onDelete:this.onFilterDelete}),o&&(P.variant=B.TableVariant.compact),void 0===O&&(e=!0),f&&0===m&&0===Object.keys(E).length&&(P.tableProps.rows=[{cells:[{title:x().createElement(N.zT,null)}]}],P.tableProps.columns=[],P.hasItems=!1,P.hasCheckbox=!1),!c&&r&&(P.dedicatedAction=x().createElement(L.x1,{allSystems:(0,$.qN)(d.filter((function(e){return p.includes(e.node.id)})).map((function(e){return e.node}))),selectedRules:[]})),x().createElement(N.Se,{stateValues:{error:O,noError:e}},x().createElement(N.K7,{stateKey:"error"},x().createElement(N.mf,{error:O})),x().createElement(N.K7,{stateKey:"noError"},l&&x().createElement(Z.Alert,{isInline:!0,variant:"info",title:"The list of systems in this view is different than those that appear in the Inventory. Only systems previously or currently associated with compliance policies are displayed."}),x().createElement(z.e_,i()({},P,{fallback:x().createElement(V.SkeletonTable,{colSize:2,rowSize:15}),onLoad:function(e){var n=e.INVENTORY_ACTION_TYPES,r=e.mergeWithEntities;t.getRegistry().register(Y({},r((0,q.zw)(n,h,c))))}}))))}}]),o}(x().Component))||W;ie.propTypes={allSelectedOnPage:k().bool,clearAll:k().func,clearInventoryFilter:k().func,clearSelection:k().func,client:k().object,columns:k().array,compact:k().bool,complianceThreshold:k().number,compliantFilter:k().bool,enableExport:k().bool,error:k().object,exportFromState:k().func,policies:k().array,policyId:k().string,defaultFilter:k().string,preselectedSystems:k().array,remediationsEnabled:k().bool,selectAll:k().func,selectEntities:k().func,selectedEntities:k().array,selectedEntitiesIds:k().array,showActions:k().bool,showAllSystems:k().bool,showOnlySystemsWithTestResults:k().bool,showOsFilter:k().bool,systems:k().array,total:k().number,updateRows:k().func,updateSystems:k().func,systemProps:k().shape({isFullView:k().bool}),showComplianceSystemsInfo:k().bool},ie.defaultProps={remediationsEnabled:!0,compact:!1,enableExport:!0,showAllSystems:!1,complianceThreshold:0,showOnlySystemsWithTestResults:!1,showActions:!0,compliantFilter:!1,selectedEntities:[],selectedEntitiesIds:[],systems:[],clearAll:function(){return{}},exportFromState:function(){return{}},systemProps:{},showComplianceSystemsInfo:!1};var oe=(0,j.memo)((function(e){return x().createElement(ie,e)})),se=(0,F.withApollo)(oe);const ce=(0,C.connect)((function(e){return void 0===e.entities||void 0===e.entities.rows?{selectedEntities:[],systems:[]}:{allSelectedOnPage:0===e.entities.rows.filter((function(t){return!(e.entities.selectedEntities||[]).map((function(e){return e.id})).includes(t.id)})).length,selectedEntities:e.entities.selectedEntities,selectedEntitiesIds:(e.entities.selectedEntities||[]).map((function(e){return e.id})),systems:e.entities.systems,total:e.entities.total}}),(function(e){return{clearInventoryFilter:function(){return e({type:"CLEAR_FILTERS"})},exportFromState:function(t){return e((0,M.k6)(t))},updateSystems:function(t){e(Y({type:"UPDATE_SYSTEMS"},t))},updateRows:function(){return e({type:"UPDATE_ROWS"})},selectAll:function(){return e((0,M.td)())},clearSelection:function(){return e((0,M.MO)())},clearAll:function(){return e({type:M.pr,payload:{clearAll:!0}})},selectEntities:function(t){return e({type:"SELECT_ENTITIES",payload:{ids:t}})}}}))(se)},55186:(e,t,n)=>{"use strict";n.d(t,{Ep:()=>d,Y0:()=>m,UD:()=>f});var r=n(319),i=n.n(r),o=n(28655),s=n.n(o),c=n(44119),a=n.n(c),l=(n(35937),n(31222));function u(){var e=s()(["\nquery getSystems($filter: String!, $policyId: ID, $perPage: Int, $page: Int) {\n    systems(search: $filter, limit: $perPage, offset: $page) {\n        totalCount\n        edges {\n            node {\n                id\n                name\n                osMajorVersion\n                osMinorVersion\n                testResultProfiles(policyId: $policyId) {\n                    id\n                    name\n                    lastScanned\n                    external\n                    compliant\n                    score\n                    supported\n                    ssgVersion\n                    policy {\n                        id\n                    }\n                }\n                policies(policyId: $policyId) {\n                    id\n                    name\n                }\n            }\n        }\n    }\n}\n"]);return u=function(){return e},e}function p(){var e=s()(["\nquery getSystems($filter: String!, $policyId: ID, $perPage: Int, $page: Int) {\n    systems(search: $filter, limit: $perPage, offset: $page) {\n        totalCount\n        edges {\n            node {\n                id\n                name\n                osMajorVersion\n                osMinorVersion\n                testResultProfiles(policyId: $policyId) {\n                    id\n                    name\n                    refId\n                    lastScanned\n                    compliant\n                    external\n                    score\n                    supported\n                    ssgVersion\n                    rules {\n                        refId\n                        title\n                        compliant\n                        remediationAvailable\n                    }\n                }\n                policies(policyId: $policyId) {\n                    id\n                    name\n                }\n            }\n        }\n    }\n}\n"]);return p=function(){return e},e}var d=a()(p()),m=a()(u()),f=function(e,t){return[].concat(i()((0,l.RM)(e)),i()(t?(0,l.iz)(e):[]))}},93188:(e,t,n)=>{"use strict";n.d(t,{Ey:()=>P,e_:()=>H,r0:()=>w.ZP}),n(82813);var r,i=n(59713),o=n.n(i),s=n(34575),c=n.n(s),a=n(93913),l=n.n(a),u=n(2205),p=n.n(u),d=n(78585),m=n.n(d),f=n(29754),y=n.n(f),h=n(77865),b=n.n(h),v=n(45697),g=n.n(v),E=n(35115),O=n(75061),I=n(58135);function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var T=(0,O.gu)()(r=function(e){p()(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=y()(t);if(n){var i=y()(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return m()(this,e)});function i(e){return c()(this,i),r.call(this,e)}return l()(i,[{key:"render",value:function(){var e=this;return b().createElement(I.c0,{onLoad:function(t){var n=t.mergeWithDetail;return e.getRegistry().register(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n()))}},b().createElement(I.mQ,{fallback:b().createElement(E.Skeleton,{size:E.SkeletonSize.md}),hideBack:!0}))}}]),i}(b().Component))||r;T.propTypes={entity:g().object};const P=function(e){return b().createElement(T,e)};var w=n(21157),j=(n(92428),n(5499),n(59354),n(62103),n(67154)),x=n.n(j),R=n(319),k=n.n(R),F=n(63038),C=n.n(F),_=n(98467),D=n(87016),V=n(55186),L=n(49690),A=n(59088),N=n(83194),M=n(31222),$=n(23279),q=n.n($),U=n(37311),B=n(98627),Z=n(27668),z=n(22744),J=n(33660),K=n(39303);function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Y=function(e){var t=e.columns,n=e.showAllSystems,r=e.policyId,i=e.query,o=e.client,s=e.showActions,c=e.enableExport,a=e.compliantFilter,l=e.policies,u=e.showOnlySystemsWithTestResults,p=e.showOsFilter,d=e.error,m=e.showComplianceSystemsInfo,f=e.compact,y=e.remediationsEnabled,v=e.systemProps,g=e.defaultFilter,S=(0,D.useStore)(),T=(0,D.useDispatch)(),P=(0,h.useRef)(null),w=(0,h.useState)({perPage:50,page:1}),j=C()(w,2),R=j[0],F=j[1],_=(0,h.useState)(!1),$=C()(_,2),W=$[0],Y=$[1],H=(0,K.Z)([].concat(k()(M.qo),k()(a?M.rN:[]),k()((null==l?void 0:l.length)>0?(0,V.UD)(l,p):[]))),Q=H.conditionalFilter,X=H.activeFilters,ee=H.buildFilterString,te=(0,D.useSelector)((function(e){var t=e.entities;return null==t?void 0:t.systemsCount}))||0,ne=(0,D.useSelector)((function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.entities;return(null==n||null===(e=n.systems)||void 0===e?void 0:e.map((function(e){var t;return null==e||null===(t=e.node)||void 0===t?void 0:t.id})))||[]}),D.shallowEqual),re=(0,D.useSelector)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.entities;return(null==t?void 0:t.selectedEntities)||[]}),D.shallowEqual),ie=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;Y(!1);var n=ee();return o.query({query:i,fetchResults:!0,fetchPolicy:"no-cache",variables:G({filter:[].concat(k()(g?[g]:[]),k()(u?["has_test_results = true"]:[]),k()((null==n?void 0:n.length)>0?[n]:[])).join(" and "),perPage:e,page:t},r&&{policyId:r})}).then((function(n){var r=n.data,i=n.loading;return T({type:"UPDATE_SYSTEMS",systems:r.systems.edges,systemsCount:r.systems.totalCount}),Y(!0),F((function(){return{page:t,perPage:e}})),{data:r,loading:i}}))},oe=(0,h.useCallback)(q()(ie,800),[Q.activeFiltersConfig.filters]);return(0,h.useEffect)((function(){Q.activeFiltersConfig.filters&&oe(R.perPage,1)}),[X]),b().createElement(U.Se,{stateValues:{error:d,noError:void 0===d}},b().createElement(U.K7,{stateKey:"error"},b().createElement(U.mf,{error:d})),b().createElement(U.K7,{stateKey:"noError"},m&&b().createElement(B.Alert,{isInline:!0,variant:"info",title:"The list of systems in this view is different than those that appear in the Inventory. Only systems previously or currently associated with compliance policies are displayed."}),b().createElement(I.e_,x()({},v,{onLoad:function(e){var i=e.INVENTORY_ACTION_TYPES,o=e.mergeWithEntities;(0,O.JH)().register(G({},o((0,L.Q_)(i,t,n,r))))},fallback:b().createElement(E.SkeletonTable,{colSize:2,rowSize:15}),tableProps:{canSelectAll:!1},variant:f?Z.TableVariant.compact:"",ref:P,onRefresh:function(e,t){i&&ie(e.per_page,e.page),!t&&P&&P.current?P.current.onRefreshData(e):t&&t(e)},bulkSelect:{checked:re.length>0&&(!(null==ne||!ne.every((function(e){return null==re?void 0:re.find((function(t){return(null==t?void 0:t.id)===e}))})))||null),onSelect:function(e){return T(e?(0,A.td)():(0,A.MO)())},count:re.length,label:re.length>0?"".concat(re.length," Selected"):void 0}},!n&&G(G(G({},R),{},{isLoaded:W,items:ne,total:te},Q),y&&{dedicatedAction:b().createElement(z.x1,{allSystems:(0,J.qN)(re),selectedRules:[]})}),c&&{exportConfig:{isDisabled:0===te&&0===re.length,onSelect:function(e,t){var n;return(0,N.k6)(null===(n=S.getState())||void 0===n?void 0:n.entities,t)}}},s&&{actions:[{title:"View in inventory",onClick:function(e,t,n){var r=n.id,i="beta"===window.location.pathname.split("/")[1];window.location.href="".concat(window.location.origin).concat(i?"/beta":"","/insights/inventory/").concat(r)}}]}))))};Y.propTypes={columns:g().arrayOf(g().shape({})),policies:g().arrayOf(g().shape({})),client:g().object,showAllSystems:g().bool,policyId:g().string,query:g().string,showActions:g().bool,enableExport:g().bool,compliantFilter:g().bool,showOnlySystemsWithTestResults:g().bool,showOsFilter:g().bool,showComplianceSystemsInfo:g().bool,error:g().object,compact:g().bool,remediationsEnabled:g().bool,defaultFilter:g().string,systemProps:g().shape({isFullView:g().bool})},Y.defaultProps={policyId:"",showActions:!0,enableExport:!0,compliantFilter:!1,showOnlySystemsWithTestResults:!1,showComplianceSystemsInfo:!1,compact:!1,remediationsEnabled:!0};const H=(0,_.withApollo)(Y)},83194:(e,t,n)=>{"use strict";n.d(t,{k6:()=>c});var r=n(50008),i=n.n(r),o=function(e,t){return t.split(".").reduce((function(e,t){return e&&"undefined"!==e[t]?e[t]:void 0}),e)},s=function(e,t){var n=o(e,t);return n.exportValue&&(n=n.exportValue),"object"===i()(n)&&(n=o(e,t+"_text")),"string"==typeof n&&n.includes(",")&&(n='"'+n+'"'),n},c=function(e,t){var n;"csv"===t?n=function(e){var t=e.rows,n=e.columns,r=e.selectedEntities;if(t){var i=[n.map((function(e){return e.title})).join(",")];return i=i.concat((r||t).map((function(t){return e.columns.map((function(e){return e.noExport?"":s(t,e.key)})).join(",")}))),encodeURI("data:text/csv;charset=utf-8,"+i.join("\n"))}}(e):"json"===t&&(n=function(e){var t,n=e.rows,r=e.columns,i=e.selectedEntities;if(n)return t=(i||n).map((function(e){var t={};return r.forEach((function(n){var r=n.key.split("."),i=r[r.length-1];t[i]=s(e,n.key)})),t})),encodeURI("data:application/json;charset=utf-8,"+JSON.stringify(t))}(e)),function(e,t){if(e){var n=document.createElement("a");n.setAttribute("href",e),n.setAttribute("download",t),n.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}))}}(n,function(e){return"compliance-export-"+(new Date).toISOString()+"."+e}(t))}},33660:(e,t,n)=>{"use strict";n.d(t,{T4:()=>c,TU:()=>a,qN:()=>u});var r=n(59713),i=n.n(r);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var c=function(e){return e.flatMap((function(e){return e.rules&&e.rules.filter((function(e){return!e.compliant}))}))},a=function(e){return e.flatMap((function(e){return e.rules&&e.rules.filter((function(e){return e.compliant}))}))},l=function(e){return e.testResultProfiles?c(e.testResultProfiles):[]},u=function(e){return e.map((function(e){return s(s({},e),{},{ruleObjectsFailed:l(e),profiles:e.testResultProfiles})}))}},59088:(e,t,n)=>{"use strict";n.d(t,{xM:()=>r,pr:()=>i,k6:()=>o,td:()=>s,MO:()=>c});var r="@@COMPLIANCE/EXPORT",i="SELECT_ENTITY",o=function(e){return{type:r,payload:{format:e}}},s=function(){return{type:i,payload:{id:0,selected:!0}}},c=function(){return{type:i,payload:{id:0,selected:!1}}}},49690:(e,t,n)=>{"use strict";n.d(t,{ek:()=>j,rI:()=>x,B3:()=>F,Q_:()=>q,zw:()=>U});var r=n(59713),i=n.n(r),o=n(319),s=n.n(o),c=n(77865),a=n.n(c),l=n(87446),u=n(35115),p=n(47194),d=n(59088),m=n(83194),f=n(37311),y=n(98627),h=n(33660),b=n(50500),v=n(20909);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O="Never",I=function(e){var t=e.testResultProfiles,n=(void 0===t?[]:t).map((function(e){return new Date(e.lastScanned)})),r=new Date(Math.max.apply(null,n.filter((function(e){return isFinite(e)}))));return r instanceof Date&&isFinite(r)?r:O},S=function(e){var t=e.testResultProfiles;return(void 0===t?[]:t).every((function(e){return e.lastScanned===O||!0===e.compliant}))},T=function(e){var t=e.testResultProfiles,n=void 0===t?[]:t,r=n.reduce((function(e,t){return e+t.score}),0),i=n.reduce((function(e,t){return(0,h.TU)([t]).length+(0,h.T4)([t]).length>0?e+1:e}),0);return i?r/i:0},P=function(e){var t=e.testResultProfiles;return(void 0===t?[]:t).reduce((function(e,t){return e&&t.supported}),!0)},w=function(e){if(e==={})return"";var t=e.policies.map((function(e){return e.name})),n=e.testResultProfiles.filter((function(e){return!e.policy})).map((function(e){var t=e.name;return"(External) ".concat(t)}));return[].concat(s()(t),s()(n)).join(", ")},j=function(e){var t=e.policyNames;return{title:t?a().createElement(y.Tooltip,{content:t},a().createElement(b.Z,{lines:2,width:540},t)):a().createElement(y.Text,{className:"grey-icon"},"No policies"),exportValue:t}},x=function(e){if(e.testResultProfiles&&e.testResultProfiles.length>0)return{title:a().createElement(p.Link,{to:{pathname:"/systems/".concat(e.id)}},"View report")}},R=function(e){return void 0!==e.osMajorVersion&&void 0!==e.osMinorVersion&&null!==e.osMajorVersion&&null!==e.osMinorVersion&&!(0===e.osMajorVersion&&0===e.osMinorVersion)},k=function(e,t){return{title:a().createElement(y.TextContent,null,t.name?a().createElement(p.Link,{to:{pathname:"/systems/".concat(t.id)}},t.name):e.display_name,R(t)&&a().createElement(y.Text,{component:y.TextVariants.small},"RHEL ",t.osMajorVersion,".",t.osMinorVersion)),exportValue:e.display_name||t.name}},F=function(e,t,n){var r=n.osMajorVersion,i=n.osMinorVersion,o=n.name;return a().createElement(y.TextContent,null,a().createElement(p.Link,{to:{pathname:"/systems/".concat(t)}},e||o),R({osMajorVersion:r,osMinorVersion:i})&&a().createElement(y.Text,{component:y.TextVariants.small},"RHEL ",r,".",i))},C=function(e,t){return!!(t||[]).find((function(t){return t.id===e}))},_=function(e){var t=e.testResultProfiles;return(void 0===t?[]:t).map((function(e){return e.ssgVersion})).filter((function(e){return!!e})).join(", ")},D=function(e,t,n,r){return t.map((function(t){void 0===t.facts&&(t.facts={});var i=e.map((function(e){return e.node})).find((function(e){return t.id===e.id}));if(void 0===i){if(!n)return;i={testResultProfiles:[],policies:[]}}return i.policyNames=w(i),i.rulesPassed=(0,h.TU)(i.testResultProfiles).length,i.rulesFailed=(0,h.T4)(i.testResultProfiles).length,i.lastScanned=I(i),i.compliant=S(i),i.score=T(i),i.supported=P(i),{id:t.id,selected:C(t.id,r),account:t.account,bios_uuid:t.bios_uuid,created:t.created,display_name:t.display_name||i.name,fqdn:t.fqdn,insights_id:t.insights_id,ip_addresses:t.ip_addresses,mac_addresses:t.mac_addresses,rhel_machine_id:t.rhel_machine_id,satellite_id:t.satellite_id,subscription_manager_id:t.subscription_manager_id,tags:t.tags,updated:t.updated,facts:{inventory:{hostname:void 0!==t.facts.inventory?t.facts.inventory.hostname:t.facts.hostname,machine_id:void 0!==t.facts.inventory?t.facts.inventory.machine_id:t.facts.machine_id,release:void 0!==t.facts.inventory?t.facts.inventory.release:t.facts.release},compliance:{display_name:k(t,i),policies:j(i),details_link:x(i),rules_passed:i.rulesPassed,rules_failed:{title:a().createElement(p.Link,{to:{pathname:"/systems/".concat(i.id),query:{hidePassed:!0}}},i.rulesFailed)},rules_failed_text:i.rulesFailed,compliance_score:(0,f.OF)(i),compliance_score_text:(0,f.Oq)(i),last_scanned:i.lastScanned instanceof Date?{title:a().createElement(u.DateFormat,{date:Date.parse(i.lastScanned),type:"relative"})}:i.lastScanned,last_scanned_text:i.lastScanned,ssg_version:_(i),supported:i.supported}}}})).filter((function(e){return!!e}))},V=function(e,t){var n=e.rows.filter((function(n){return t.includes(n.id)&&!(e.selectedEntities||[]).map((function(e){return e.id})).includes(n.id)}));return E(E({},e),{},{selectedEntities:(e.selectedEntities||[]).concat(n)})},L=function(e,t){return E(E({},e),{},{selectedEntities:(e.selectedEntities||[]).filter((function(e){return!t.includes(e.id)}))})},A=function(e){return V(e,e.rows.map((function(e){return e.id})))},N=function(e){return L(e,e.rows.map((function(e){return e.id})))},M=function(e,t){return V(e,[t])},$=function(e,t){return L(e,[t])},q=function(e,t,n){var r;return(0,l.Gg)((r={},i()(r,"UPDATE_SYSTEMS",(function(e,t){var n=t.systems,r=t.systemsCount;return E(E({},e),{},{systems:n,systemsCount:r})})),i()(r,e.LOAD_ENTITIES_FULFILLED,(function(e){var r;return E(E({},e),{},{total:n?e.total:e.systemsCount,rows:(0,v.r0)([e.rows.map((function(t){return E(E({},t),{},{selected:C(t.id,e.selectedEntities)})})),null===(r=e.systems)||void 0===r?void 0:r.map((function(e){var t=e.node;return E(E(E({},t),n&&{testResultProfiles:[],policies:[]}),{},{policyNames:w({policies:null==t?void 0:t.policies,testResultProfiles:[]}),rulesPassed:(0,h.TU)(t.testResultProfiles).length,rulesFailed:(0,h.T4)(t.testResultProfiles).length,lastScanned:I(t),compliant:S(t),score:T(t),supported:P(t),ssgVersion:_(t),detailsLink:x(t)})}))]),columns:e.total>0?t:[{title:""}]})})),i()(r,d.pr,(function(e,t){var n,r=t.payload,i=r.id,o=r.selected,s=r.clearAll;return(0===(n=0===i?o?A(e):N(e):o?M(e,i):$(e,i)).selectedEntities.length||s)&&(n.selectedEntities=void 0),n})),i()(r,"SELECT_ENTITIES",(function(e,t){return{selectedEntities:t.payload.ids}})),r))},U=function(e,t,n){var r;return(0,l.Gg)((r={},i()(r,"UPDATE_SYSTEMS",(function(e,t){var n=t.systems,r=t.systemsCount;return E(E({},e),{},{systems:n,systemsCount:r})})),i()(r,"UPDATE_ROWS",(function(e){return E(E({},e),{},{loaded:!0,rows:D(e.systems||[],e.rows||[],n,e.selectedEntities)})})),i()(r,e.LOAD_ENTITIES_FULFILLED,(function(e){return E(E({},e),{},{rows:D(e.systems||[],e.rows,n,e.selectedEntities),total:n?e.total:e.systemsCount,columns:e.total>0?t:[{title:""}]})})),i()(r,d.xM,(function(e,t){var n=t.payload.format;return(0,m.k6)(e,n),e})),i()(r,d.pr,(function(e,t){var n,r=t.payload,i=r.id,o=r.selected,s=r.clearAll;return(0===(n=0===i?o?A(e):N(e):o?M(e,i):$(e,i)).selectedEntities.length||s)&&(n.selectedEntities=void 0),n})),i()(r,"SELECT_ENTITIES",(function(e,t){return{selectedEntities:t.payload.ids}})),r))}}}]);
//# sourceMappingURL=EditPolicy.18e9f694f151c599b802.js.map